var AQ;(function(){"use strict";function P(e){var t;t=typeof e;if(t==="number"){if(isNaN(e)){t="NaN"}}else if(t==="object"){if(e){if(e instanceof Array){t="array"}}else{t="null"}}return t}function H(e){if(e.stopPropagation){e.stopPropagation()}else{e.cancelBubble=true}e.returnValue=false;return false}function B(e){var t;t=E;if(t&&typeof t==="function"){try{t(e+"\n")}catch(n){window.alert("AQ DEBUG: "+e+" ["+n.message+"]\n")}}}function j(e){var t,n,r;t="";if(e.search(".js")!==-1){n=e.lastIndexOf("/")+1;r=e.substr(n).replace(/^[\s\(\)]+|[\s\(\)]+$/g,"");if(r.split(":").length===3){r=r.substr(0,r.lastIndexOf(":"))}if(r!==""){t+="    "+r+"\n"}}return t}function F(e){var t,n,r,i;if(console&&console.log){console.log(e)}if(!e.split){return e}t=e.split("\n");r="";i=t.length;for(n=0;n<i;n+=1){r+=j(t[n])}return r}function I(e,t){var n;if(typeof e!=="string"||e.length<1){e="???"}e="AQ ERROR: "+e+"\n";if(S&&t){e+=F(t.stack)+"\n"}n=E;if(n&&typeof n==="function"){try{n(e)}catch(r){window.alert(e+" ["+t.message+"]\n")}}return AQ.ERROR}function q(e){try{throw new Error("AQ ERROR")}catch(t){return I(e,t)}}function R(e,t){var n,r,i,s,o,a;n=P(t);if(n==="undefined"||t===null||t===AQ.DEFAULT){return u.filetypes}if(n!=="array"){return q(e+".fileTypes not an array")}r=t.length;if(r<1){return q(e+".fileTypes array empty")}s=[];for(i=0;i<r;i+=1){o=t[i];if(!o||typeof o!=="string"||o.length<1){return q(e+"Invalid .fileType entry @ "+i)}o=o.toLowerCase();a=C[o];if(a&&a.ok){if(s.indexOf(o)<0){s.push(o)}}}if(s.length<1){return q(e+"No playable audio types listed")}return s}function U(e,t,n){var r,i;r=P(n);if(!n||r==="undefined"){return AQ.DONE}if(r!=="object"){return q(e+"params not an object")}i=n.path;r=P(i);if(r!=="undefined"){if(i===AQ.DEFAULT){i=u.path}else if(r!=="string"||i.length<1){return q(e+".path property not a valid string")}t.path=i}i=R(e,n.fileTypes);if(i===AQ.ERROR){return AQ.ERROR}if(i){t.fileTypes=i}i=n.autoplay;r=P(i);if(r!=="undefined"){if(i!==true&&i!==false){if(i===AQ.DEFAULT){i=u.autoplay}else if(i===null){i=false}else if(r==="number"){i=i!==0}else{return q(e+".autoplay property invalid")}}t.autoplay=i}i=n.lock;r=P(i);if(r!=="undefined"){if(i!==true&&i!==false){if(i===AQ.DEFAULT){i=u.lock}else if(i===null){i=false}else if(r==="number"){i=i!==0}else{return q(e+".lock property invalid")}}t.lock=i}i=n.volume;r=P(i);if(r!=="undefined"){if(i===AQ.DEFAULT){i=u.volume}else{if(r!=="number"){return q(e+".volume property not a number")}if(i>s){i=s}else if(i<0){i=0}}t.volume=i}i=n.loop;r=P(i);if(r!=="undefined"){if(i!==true&&i!==false){if(i===AQ.DEFAULT){i=u.loop}else if(i===null){i=false}else if(r==="number"){i=i!==0}else{return q(e+".loop property invalid")}}t.loop=i}i=n.start;r=P(i);if(r!=="undefined"){if(i===AQ.DEFAULT){i=u.start}else{if(r!=="number"){return q(e+".start property not a number")}i=Math.floor(i);if(i<0){i=0}}t.start=i}i=n.end;r=P(i);if(r!=="undefined"){if(i===AQ.DEFAULT){i=u.end}else{if(r!=="number"){return q(e+".end property not a number")}i=Math.floor(i);if(i<0){i=0}}t.end=i}i=n.onLoad;r=P(i);if(r!=="undefined"){if(i===AQ.DEFAULT){i=u.onLoad}else if(r!=="function"){return q(e+".onLoad property not a function")}t.onLoad=i}i=n.onPlay;r=P(i);if(r!=="undefined"){if(i===AQ.DEFAULT){i=u.onPlay}else if(r!=="function"){return q(e+".onPlay property not a function")}t.onPlay=i}i=n.onEnd;r=P(i);if(r!=="undefined"){if(i===AQ.DEFAULT){i=u.onEnd}else if(r!=="function"){return q(e+".onEnd property not a function")}t.onEnd=i}i=n.data;r=P(i);if(r!=="undefined"){if(i===AQ.DEFAULT){i=u.data}t.data=i}return AQ.DONE}function z(e){return{name:e,path:w,fileTypes:N,lock:u.loop,volume:u.volume,start:u.start,end:u.end,loop:u.loop,autoplay:u.autoplay,onLoad:u.onLoad,onPlay:u.onPlay,onEnd:u.onEnd,data:u.data}}var e="AQ";var t=1;var n=0;var r=3;var i=false;var s=1;var o=32;var u={path:"",filetypes:["ogg","mp3","wav"],autoplay:false,volume:.5,start:0,end:-1,loop:false,lock:false,onLoad:null,onPlay:null,onEnd:null,data:0};var a="bf_";var f="ch_";var l="EMPTY";var c="LOADING";var h="READY";var p="PLAYING";var d="PAUSED";var v=0;var m=1;var g=2;var y=3;var b=false;var w="";var E=null;var S=false;var x=false;var T=false;var N=null;var C={ogg:{ok:false,type:'audio/ogg; codecs="vorbis"'},mp3:{ok:false,type:"audio/mpeg;"},wav:{ok:false,type:'audio/wav; codecs="1"'},aac:{ok:false,type:'audio/mp4; codecs="mp4a.40.2"'},webm:{ok:false,type:'audio/webm; codecs="vorbis"'},opus:{ok:false,type:'audio/ogg; codecs="opus"'}};var k=[];var L=0;var A=0;var O=[];var M=0;var _=null;var D=null;var W={stopChannel:function(e){var t,n,r;t="[AQ._web.stopChannel] ";if(i){B(t+e.id)}n=e.source;if(n&&n.playbackState!==y){if(e.thandle){window.clearTimeout(e.thandle)}r=P(n.stop);if(r!=="undefined"){n.stop(0)}else{n.noteOff(0)}e.status=h}return AQ.DONE},assignChannel:function(){var e;A+=1;e=f+A;return e},playBuffer:function(e,t){var n,r,s,o,u,a,f,l,c,h,d;n="[AQ._web.playBuffer] ";r=_;s=r.createBufferSource();if(!s){return q(n+"Invalid bufferSource")}s.buffer=e.audio;if(r.createGain!==undefined){o=r.createGain()}else{o=r.createGainNode()}if(!o){return q(n+"Invalid gainNode")}s.connect(o);o.connect(r.destination);o.gain.value=e.params.volume;if(t===undefined){t=0}u=e.audio.duration-t;a=Math.floor(u*1e3);if(!e.channel_id){e.channel_id=W.assignChannel()}f=e.channel_id;l={id:f,buffer:e,source:s,gainNode:o,startTime:r.currentTime-t,pauseTime:0,endTime:-1,status:p};l.thandle=window.setTimeout(function(){var e,t,r;e=k.length;for(t=0;t<e;t+=1){l=k[t];if(l.id===f){if(i){B(n+"Ending "+f+": "+h.pathname)}r=l.buffer;h=r.params;d=h.onEnd;if(d&&typeof d==="function"){if(i){B(n+"Calling user .onEnd on "+f+": "+h.pathname)}try{d({channel:r.channel_id,name:h.name,path:h.pathname,duration:r.duration,data:h.data})}catch(s){I(n+"User .onEnd failed on "+f+": "+h.pathname+" ["+s.message+"]",s)}}W.stopChannel(l);k.splice(t,1);if(h.loop){W.playBuffer(r,0)}return}}q(n+"Channel "+f+" not found")},a);k.push(l);c=P(s.start);if(c!=="undefined"){s.start(0,t,u)}else{s.noteGrainOn(0,t,u)}h=e.params;d=h.onPlay;if(d&&typeof d==="function"){if(i){B(n+"Calling user .onPlay for "+e.channel_id+": "+h.pathname)}try{d({channel:e.channel_id,name:h.name,path:h.pathname,duration:e.duration,data:h.data})}catch(v){I(n+"User .onPlay failed on "+e.channel_id+": "+h.pathname+" ["+v.message+"]",v)}}return f},load:function(e){var t,n,r,s,o,u;t="[AQ._web.load] ";n=O.length;for(r=0;r<n;r+=1){s=O[r];if(s.params.pathname===e.pathname){if(i){B(t+e.pathname+" found in "+s.id)}return s.channel_id}}M+=1;o=a+M;s={id:o,channel_id:W.assignChannel(),audio:null,duration:0,params:e};if(i){B(t+"Creating "+s.id+" for "+e.pathname)}u=new XMLHttpRequest;if(!u){return q(t+"XMLHttpRequest error")}u.open("GET",e.pathname,true);u.responseType="arraybuffer";u.onload=function(){if(i){B(t+"Loaded "+e.pathname+" into "+s.id)}_.decodeAudioData(u.response,function(n){var r;s.audio=n;s.duration=Math.floor(n.duration*1e3);O.push(s);if(i){B(t+"Decoded "+e.pathname+" in "+s.id+" ("+s.duration+" ms)")}r=e.onLoad;if(r&&typeof r==="function"){e.onLoad=null;if(i){B(t+"Calling user .onLoad for "+s.channel_id+": "+e.pathname)}try{r({channel:s.channel_id,name:e.name,path:e.pathname,duration:s.duration,data:e.data})}catch(o){I(t+"User .onLoad failed on "+s.channel_id+": "+e.pathname+" ["+o.message+"]",o)}}if(s.params.autoplay){if(i){B(t+"Autoplaying "+s.id+" :"+e.pathname)}W.playBuffer(s)}},function(){q(t+"Error loading "+e.pathname)})};try{u.send()}catch(f){return I(t+"XMLHttpRequest failed: "+e.pathname+" ["+f.message+"]",f)}return s.channel_id},play:function(e){var t,n,r,s;t="[AQ._web.play] ";n=O.length;for(r=0;r<n;r+=1){s=O[r];if(s.params.pathname===e.pathname){if(i){B(t+"Found "+e.pathname)}return W.playBuffer(s)}}if(i){B(t+e.pathname+" unavailable; loading")}e.autoplay=true;return W.load(e)},playChannel:function(e){var t,n,r,i;t="[AQ._web.playChannel] ";n=O.length;for(r=0;r<n;r+=1){i=O[r];if(i.channel_id===e){return W.playBuffer(i)}}return q(t+e+" not found")},pause:function(e){var t,n,r,s,o,u,a,f;t="[AQ._web.pause] ";n=k.length;for(r=0;r<n;r+=1){s=k[r];if(s.id===e){o=s.buffer;u=s.source;a=s.pauseTime;if(a>0&&s.status===d){k.splice(r,1);return W.playBuffer(o,a)}if(s.thandle){window.clearTimeout(s.thandle);s.thandle=null}if(u&&u.playbackState!==y){a=_.currentTime-s.startTime;a=a%o.audio.duration;s.pauseTime=a;s.status=d;f=P(u.stop);if(f!=="undefined"){u.stop(0)}else{u.noteOff(0)}}else{k.splice(r,1)}return e}}if(i){B(t+e+" not found")}return AQ.ERROR},stop:function(e){var t,n,r,s;t="[AQ._web.stop] ";n=k.length;for(r=0;r<n;r+=1){s=k[r];if(s.id===e){W.stopChannel(s);k.splice(r,1);return AQ.DONE}}if(i){B(t+e+" not found")}return AQ.ERROR},init:function(){return AQ.WEB_AUDIO}};var X={onError:function(e){var t,n,r,i,s,o;t="[AQ._html.onError] ";n=e.currentTarget;r=n.getAttribute("data-channel");r=parseInt(r,10);i=k[r];s=e.target.error.code;switch(s){case 1:o="Playback aborted";break;case 2:o="Network failure";break;case 3:o="Source decode failed";break;case 4:o="Invalid source file";break;default:o="Unknown";break}q(t+o+" @ "+i.id+": "+i.params.pathname);return H(e)},onStalled:function(e){var t,n,r,s;t="[AQ._html.onStalled] ";if(i){n=e.currentTarget;r=n.getAttribute("data-channel");r=parseInt(r,10);s=k[r];B(t+s.id+": "+s.params.pathname)}return H(e)},startChannel:function(e,t){var n,r,s,o;n="[AQ._html.startChannel] ";if(i){B(n+"Playing "+e.id)}e.status=p;r=e.audio;o=P(t);if(o==="object"){s=t.volume;o=P(s);if(o!=="undefined"){e.params.volume=s;r.volume=s}s=t.loop;o=P(s);if(o!=="undefined"){e.params.loop=s;r.loop=s}s=t.onDone;o=P(s);if(o!=="undefined"){e.params.onDone=s}s=t.userData;o=P(s);if(o!=="undefined"){e.params.userData=s}s=t.lock;o=P(s);if(o!=="undefined"){e.params.lock=s}}r.play()},onLoad:function(e){var t,n,r,s,o,u;t="[AQ._html.onLoad] ";n=e.currentTarget;r=n.getAttribute("data-channel");r=parseInt(r,10);s=k[r];s.status=h;o=s.params;if(i){B(t+s.id+": "+o.pathname)}s.audio.removeEventListener("canplaythrough",X.onLoad,false);u=o.onLoad;if(u&&typeof u==="function"){o.onLoad=null;if(i){B(t+"Calling user .onLoad on "+s.id+": "+o.pathname)}try{u({channel:s.id,name:o.name,path:o.pathname,duration:s.duration,data:o.data})}catch(a){I(t+"User .onLoad failed on "+s.id+": "+o.pathname+" ["+a.message+"]",a);return H(e)}}if(o.autoplay){if(i){B(t+"Autoplaying "+s.id)}o.autoplay=false;X.startChannel(s,o)}return H(e)},onPlay:function(e){var t,n,r,s,o,u;t="[AQ._html.onPlay] ";n=e.currentTarget;r=n.getAttribute("data-channel");r=parseInt(r,10);s=k[r];o=s.params;if(i){B(t+s.id+": "+o.pathname+" ("+s.duration+"ms)")}u=o.onPlay;if(u&&typeof u==="function"){if(i){B(t+"Calling user .onPlay on "+s.id+": "+o.pathname)}try{u({channel:s.id,name:o.name,path:o.pathname,duration:s.duration,data:o.data})}catch(a){I(t+"User .onPlay failed on "+s.id+": "+o.pathname+" ["+a.message+"]",a)}}return H(e)},onEnd:function(e){var t,n,r,s,o,u;t="[AQ._html.onEnd] ";n=e.currentTarget;r=n.getAttribute("data-channel");r=parseInt(r,10);s=k[r];o=s.params;if(i){B(t+s.id+": "+o.pathname)}s.status=h;u=o.onEnd;if(u&&typeof u==="function"){if(i){B(t+"Calling user .onEnd on "+s.id+": "+o.pathname)}try{u({channel:s.id,name:o.name,path:o.pathname,duration:s.duration,data:o.data})}catch(a){I(t+"User .onEnd failed on "+s.id+": "+o.pathname+" ["+a.message+"]",a)}}return H(e)},loadChannel:function(e,t){var n,r;n="[AQ._html.loadChannel] ";e.params=t;e.status=c;r=e.audio;e.duration=Math.floor(r.duration*1e3);r.addEventListener("canplaythrough",X.onLoad,false);r.preload="auto";r.volume=t.volume;r.loop=t.loop;if(i){B(n+e.id+": "+t.filepath+" ("+e.duration+"ms)")}r.setAttribute("src",t.pathname)},load:function(e){var t,n,r,s;t="[AQ._html.load] ";for(n=0;n<L;n+=1){r=k[n];if(r.params.pathname===e.pathname&&r.status===h){if(i){B(t+r.id+" ready: "+e.pathname)}r.audio.currentTime=0;if(e.autoplay){X.startChannel(r,e)}return r.id}}for(n=0;n<o;n+=1){r=k[n];if(r.status===l){if(i){B(t+r.id+" unused: "+e.pathname)}s=n+1;if(s>L){L=s}X.loadChannel(r,e);return r.id}}for(n=0;n<L;n+=1){r=k[n];if(!r.params.lock&&r.status===h){if(i){B(t+r.id+" hijacked: "+e.pathname)}r.audio.currentTime=0;X.loadChannel(r,e);return r.id}}if(i){B(t+"No channel available: "+e.pathname)}return AQ.ERROR},play:function(e){var t,n,r;t="[AQ._html.play] ";for(n=0;n<L;n+=1){r=k[n];if(r.params.pathname===e.pathname&&r.status===h){if(i){B(t+r.id+" ready: "+e.pathname)}r.audio.currentTime=0;X.startChannel(r,e);return r.id}}if(i){B(t+e.pathname+" unavailable; loading")}e.autoplay=true;return X.load(e)},playChannel:function(e){var t,n,r;t="[AQ._html.playChannel] ";for(n=0;n<L;n+=1){r=k[n];if(r.id===e){if(i){B(t+"Found "+e)}if(r.status!==h){return q(t+e+" not ready")}r.audio.currentTime=0;X.startChannel(r);return r.id}}return q(t+e+" not found")},pause:function(e){var t,n,r;t="[AQ._html.pause] ";for(n=0;n<L;n+=1){r=k[n];if(r.id===e){if(r.status===d){X.startChannel(r)}else if(r.status===p){r.status=d;r.audio.pause()}return e}}if(i){B(t+e+" not found")}return AQ.ERROR},stop:function(e){var t,n,r,s;t="[AQ._html.stop] ";for(n=0;n<L;n+=1){r=k[n];if(r.id===e){r.params.autoplay=false;s=r.status;if(s===p||s===d){r.status=h;r.audio.pause();r.audio.currentTime=0}return AQ.DONE}}if(i){B(t+e+" not found")}return AQ.ERROR},init:function(){var e,t,n;e="[AQ._html.init] ";k.length=o;for(t=0;t<o;t+=1){n=document.createElement("audio");if(!n){return q(e+"element init failed")}n.setAttribute("data-channel",t.toString());n.addEventListener("error",X.onError,false);n.addEventListener("stalled",X.onStalled,false);n.addEventListener("play",X.onPlay,false);n.addEventListener("ended",X.onEnd,false);document.body.appendChild(n);k[t]={id:f+(t+1),audio:n,duration:0,params:null,status:l}}return AQ.HTML5_AUDIO}};AQ={ERROR:"AQ.ERROR",DONE:"AQ.DONE",DEFAULT:"AQ.DEFAULT",HTML5_AUDIO:"AQ.HTML5_AUDIO",WEB_AUDIO:"AQ.WEB_AUDIO",init:function(s){var o,a,f,l,c,h,p,d,v;o="[AQ.init] ";b=false;w=u.path;N=u.filetypes;E=null;S=false;T=false;a=document.createElement("audio");if(!a.canPlayType){window.alert(o+"Audio codec testing not available\n");return AQ.ERROR}for(f in C){if(C.hasOwnProperty(f)){l=C[f];c=a.canPlayType(l.type);if(c==="probably"){l.ok=true}}}a=null;if(s){if(typeof s!=="object"){window.alert(o+"Invalid parameter\n");return AQ.ERROR}h=s.onAlert;p=P(h);if(p!=="undefined"){if(h===null||h===AQ.DEFAULT){h=null}else if(p!=="function"){window.alert(o+".onAlert property not a function");return AQ.ERROR}E=h}h=s.stack;p=P(h);if(p!=="undefined"){if(!h||h===AQ.DEFAULT){h=false}else if(h===true||p!=="number"){h=true}else{window.alert(o+".stack property not a boolean");return AQ.ERROR}S=h}h=s.forceHTML5;p=P(h);if(p!=="undefined"){if(h!==true&&h!==false){if(h===AQ.DEFAULT){h=false}else if(p==="number"){h=h!==0}else{return q(o+".forceHTML5 property invalid")}}if(i){B("_forceHTML5 = "+h)}T=h}h=s.defaultPath;p=P(h);if(p!=="undefined"){if(h===null||h===AQ.DEFAULT){h=u.path}else if(p!=="string"){return q(o+".defaultPath property not a valid string")}w=h}h=R(o,s.defaultFileTypes);if(h===AQ.ERROR){return AQ.ERROR}if(h){N=h}}k.length=0;L=0;A=0;O.length=0;M=0;_=null;x=false;if(!T){v=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.oAudioContext||window.msAudioContext;if(v){_=new v;if(!_){return q(o+"AudioContext init failed")}x=true}}if(!x){if(!document.createElement("audio").canPlayType){return q(o+"HTML5 Audio not supported")}D=X}else{D=W}d=D.init();if(d!==AQ.ERROR){b=true}if(i){B(o+"status = "+d)}return{name:e,major:t,minor:n,revision:r,status:d}},load:function(e,t){var n,r,s;if(!b){return AQ.ERROR}n="[AQ.load] ";if(!e||typeof e!=="string"||e.length<1){return q(n+"name parameter invalid")}r=z(e);if(U(n,r,t)===AQ.ERROR){return AQ.ERROR}r.pathname=r.path+r.name+"."+r.fileTypes[0];s=D.load(r);if(i){B(n+"Loaded "+r.pathname+", result = "+s)}return s},play:function(e,t){var n,r,s;if(!b){return AQ.ERROR}n="[AQ.play] ";if(!e||typeof e!=="string"||e.length<1){return q(n+"name parameter invalid")}r=z(e);if(U(n,r,t)===AQ.ERROR){return AQ.ERROR}r.pathname=r.path+r.name+"."+r.fileTypes[0];s=D.play(r);if(i){B(n+"Played "+r.pathname+", result = "+s)}return s},playChannel:function(e){var t,n;if(!b){return AQ.ERROR}t="[AQ.playChannel] ";if(!e||typeof e!=="string"||e.length<1){return q(t+"Invalid channel id")}n=D.playChannel(e);if(i){B(t+"Played "+e+", result = "+n)}return n},pause:function(e){var t,n;if(!b){return AQ.ERROR}t="[AQ.pause] ";if(!e||typeof e!=="string"||e.length<1){return q(t+"Invalid channel id")}n=D.pause(e);if(i){B(t+"Paused "+e+", result = "+n)}return n},stop:function(e){var t,n;if(!b){return AQ.ERROR}t="[AQ.stop] ";if(!e||typeof e!=="string"||e.length<1){return q(t+"Invalid channel id")}n=D.stop(e);if(i){B(t+"Stopped "+e+", result = "+n)}return n}}})()
