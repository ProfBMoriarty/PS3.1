PS={VERSION:"2.2.6",ERROR:"ERROR",DEFAULT:"DEFAULT",CURRENT:"CURRENT",ALL:"ALL",EMPTY:"EMPTY",CANVAS_SIZE:480,GRID_MAX:32,GRID_DEFAULT_WIDTH:8,GRID_DEFAULT_HEIGHT:8,DEFAULT_BEAD_COLOR:0,DEFAULT_BEAD_RED:0,DEFAULT_BEAD_GREEN:0,DEFAULT_BEAD_BLUE:0,DEFAULT_BG_COLOR:16777215,DEFAULT_BG_RED:255,DEFAULT_BG_GREEN:255,DEFAULT_BG_BLUE:255,DEFAULT_BORDER_COLOR:8421504,DEFAULT_BORDER_RED:128,DEFAULT_BORDER_GREEN:128,DEFAULT_BORDER_BLUE:128,DEFAULT_BORDER_WIDTH:1,DEFAULT_GLYPH_COLOR:16777215,DEFAULT_GLYPH_RED:255,DEFAULT_GLYPH_GREEN:255,DEFAULT_GLYPH_BLUE:255,DEFAULT_FLASH_COLOR:16777215,DEFAULT_FLASH_RED:255,DEFAULT_FLASH_GREEN:255,DEFAULT_FLASH_BLUE:255,DEFAULT_ALPHA:100,DEFAULT_FPS:17,REDSHIFT:256*256,GREENSHIFT:256,FLASH_STEP:10,STATUS_FLASH_STEP:5,FLASH_INTERVAL:5,DEFAULT_TEXT_COLOR:0,AUDIO_PATH_DEFAULT:"http://users.wpi.edu/~bmoriarty/ps/audio/",MAX_VOLUME:1,DEFAULT_VOLUME:0.5,DEFAULT_LOOP:false,AudioCurrentPath:"",AUDIO_MAX_CHANNELS:32,CHANNEL_EMPTY:0,CHANNEL_LOADING:1,CHANNEL_READY:2,CHANNEL_PLAYING:3,CHANNEL_PAUSED:4,AudioChannels:[],CHROME_UNSCHEDULED_STATE:0,CHROME_SCHEDULED_STATE:1,CHROME_PLAYING_STATE:2,CHROME_FINISHED_STATE:3,AudioContext:null,AudioID:0,ChromeChannels:[],ChromeBuffers:[],ChromeChannelCnt:0,ChromeBufferCnt:0,COLOR_BLACK:0,COLOR_WHITE:16777215,COLOR_GRAY_LIGHT:12632256,COLOR_GRAY:8421504,COLOR_GRAY_DARK:4210752,COLOR_RED:16711680,COLOR_ORANGE:16744448,COLOR_YELLOW:16776960,COLOR_GREEN:65280,COLOR_BLUE:255,COLOR_INDIGO:4194559,COLOR_VIOLET:8388863,COLOR_MAGENTA:16711935,COLOR_CYAN:65535,ARROW_LEFT:37,ARROW_RIGHT:39,ARROW_UP:38,ARROW_DOWN:40,KEYPAD_0:96,KEYPAD_1:97,KEYPAD_2:98,KEYPAD_3:99,KEYPAD_4:100,KEYPAD_5:101,KEYPAD_6:102,KEYPAD_7:103,KEYPAD_8:104,KEYPAD_9:105,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,FORWARD:1,BACKWARD:-1,Grid:null,DebugWindow:null,ImageCanvas:null,MouseX:-1,MouseY:-1,LastX:-1,LastY:-1,OverCanvas:false,FlashDelay:0,UserDelay:0,UserClock:0,Status:"Perlenspiel",StatusHue:0,StatusRed:0,StatusGreen:0,StatusBlue:0,StatusPhase:0,StatusFading:true};PS.TypeOf=function(b){var a;a=typeof b;if(a==="object"){if(b){if(b instanceof Array){a="array";}}else{a="null";}}return a;};PS.Context=function(){var b,a;a=null;b=document.getElementById("screen");if(b&&b.getContext){a=b.getContext("2d");}return a;};PS.ValidRGB=function(a,b){if(typeof a!=="number"){PS.Oops(b+"rgb parameter not a number");return -1;}a=Math.floor(a);if(a<0){PS.Oops(b+"rgb parameter negative");return -1;}if(a>16777215){PS.Oops(b+"rgb parameter out of range");return -1;}return a;};PS.RGBString=function(f,e,c,d){var h;if(d===undefined){h="rgb("+f+","+e+","+c+")";}else{h="rgba("+f+","+e+","+c+","+d+")";}return h;};PS.UnmakeRGB=function(b){var c,g,d,a,f,e;c="[PS.DecodeRGB] ";if(typeof b!=="number"){return PS.Oops(c+"RGB parameter not a number");}b=Math.floor(b);if(b<0){return PS.Oops(c+"RGB parameter negative");}if(b>16777215){return PS.Oops(c+"RGB parameter out of range");}g=b/PS.REDSHIFT;g=Math.floor(g);f=g*PS.REDSHIFT;d=(b-f)/PS.GREENSHIFT;d=Math.floor(d);e=d*PS.GREENSHIFT;a=b-f-e;return{r:g,g:d,b:a};};PS.ValidColorParams=function(k,j,h,l){var a,i,c,m,e,f,d;a=false;i=PS.TypeOf(j);if(i==="number"){if(h===undefined){if((j<0)||(j>16777215)){PS.Oops(k+"multiplexed rgb value out of range");return null;}j=Math.floor(j);c=j/PS.REDSHIFT;c=Math.floor(c);f=c*PS.REDSHIFT;e=(j-f)/PS.GREENSHIFT;e=Math.floor(e);d=e*PS.GREENSHIFT;m=j-f-d;a=true;}else{c=j;e=h;m=l;if(m===undefined){PS.Oops(k+"b parameter missing in rgb triplet");return null;}}}else{if(i==="object"){c=j.r;if(c===undefined){PS.Oops(k+"r element missing in rgb table");return null;}e=j.g;if(e===undefined){PS.Oops(k+"g element missing in rgb table");return null;}m=j.b;if(m===undefined){PS.Oops(k+"b element missing in rgb table");return null;}}else{if(i==="array"){if(j.length<3){PS.Oops(k+"rgb array length invalid");return null;}c=j[0];e=j[1];m=j[2];}else{PS.Oops(k+"Invalid color parameter");return null;}}}if(!a){if(typeof c!=="number"){PS.Oops(k+"red value is not a number");return null;}c=Math.floor(c);if((c<0)&&(c>255)){PS.Oops(k+"red value out of range ["+c+"]");return null;}if(typeof e!=="number"){PS.Oops(k+"green value is not a number");return null;}e=Math.floor(e);if((e<0)&&(e>255)){PS.Oops(k+"green value out of range ["+e+"]");return null;}if(typeof m!=="number"){PS.Oops(k+"blue value is not a number");return null;}m=Math.floor(m);if((m<0)&&(m>255)){PS.Oops(k+"blue value out of range ["+m+"]");return null;}}return{r:c,g:e,b:m};};PS.Dissolve=function(c,b,a){var d;if((a<=0)||(c===b)){return c;}if(a>=100){return b;}if(c>b){d=c-b;d=(a*d)/100;d=Math.floor(d);return(c-d);}d=b-c;d=(a*d)/100;d=Math.floor(d);return(c+d);};PS.InitBead=function(c,e,d,b){var a;a={};a.left=c;a.right=c+d;a.top=e;a.bottom=e+d;a.size=d;a.visible=true;a.empty=true;a.red=PS.DEFAULT_BEAD_RED;a.green=PS.DEFAULT_BEAD_GREEN;a.blue=PS.DEFAULT_BEAD_BLUE;a.color=PS.RGBString(a.red,a.green,a.blue);a.colorNow=a.color;a.alpha=PS.DEFAULT_ALPHA;a.alphaRed=PS.DEFAULT_BEAD_RED;a.alphaGreen=PS.DEFAULT_BEAD_GREEN;a.alphaBlue=PS.DEFAULT_BEAD_BLUE;a.glyph=0;a.glyphStr="";a.glyphRed=PS.DEFAULT_GLYPH_RED;a.glyphGreen=PS.DEFAULT_GLYPH_GREEN;a.glyphBlue=PS.DEFAULT_GLYPH_BLUE;a.glyphColor=PS.RGBString(PS.DEFAULT_GLYPH_RED,PS.DEFAULT_GLYPH_GREEN,PS.DEFAULT_GLYPH_BLUE);a.flash=true;a.flashPhase=0;a.flashRed=PS.DEFAULT_FLASH_RED;a.flashGreen=PS.DEFAULT_FLASH_GREEN;a.flashBlue=PS.DEFAULT_FLASH_BLUE;a.flashColor=PS.RGBString(PS.DEFAULT_FLASH_RED,PS.DEFAULT_FLASH_GREEN,PS.DEFAULT_FLASH_BLUE);a.borderWidth=PS.DEFAULT_BORDER_WIDTH;a.borderRed=PS.DEFAULT_BORDER_RED;a.borderGreen=PS.DEFAULT_BORDER_GREEN;a.borderBlue=PS.DEFAULT_BORDER_BLUE;a.borderAlpha=PS.DEFAULT_ALPHA;a.borderColor=PS.RGBString(PS.DEFAULT_BORDER_RED,PS.DEFAULT_BORDER_GREEN,PS.DEFAULT_BORDER_BLUE);a.data=0;a.audio=null;a.volume=PS.DEFAULT_VOLUME;a.loop=PS.DEFAULT_LOOP;a.exec=null;a.off=document.createElement("canvas");a.off.width=d;a.off.height=d;a.off.backgroundColor=b;a.offContext=a.off.getContext("2d");a.offContext.font=Math.floor(d/2)+"pt sans-serif";a.offContext.textAlign="center";a.offContext.textBaseline="middle";return a;};PS.DrawBead=function(b){var c,a,g,f,d,e;c=PS.Grid.context;g=0;f=0;d=b.size;a=b.offContext;e=b.borderWidth;if(e>0){a.fillStyle=b.borderColor;a.fillRect(0,0,d,d);g+=e;f+=e;d-=(e+e);}if(b.empty){a.fillStyle=PS.Grid.bgColor;}else{a.fillStyle=b.colorNow;}a.fillRect(g,f,d,d);if(b.glyph>0){a.fillStyle=b.glyphColor;a.fillText(b.glyphStr,PS.Grid.glyphX,PS.Grid.glyphY);}c.drawImage(b.off,b.left,b.top);};PS.EraseBead=function(a){var b,c,f,e,d;b=PS.Grid.context;f=a.left;e=a.top;c=a.size;d=a.borderWidth;if(d>0){b.fillStyle=a.borderColor;b.fillRect(f,e,c,c);f+=d;e+=d;c-=(d+d);}b.fillStyle=PS.Grid.bgColor;b.fillRect(f,e,c,c);};PS.InitGrid=function(a,h){var f,e,c,d,b,g;f={};f.context=PS.Context();if(!f.context){return null;}f.x=a;f.y=h;f.count=a*h;if(a>=h){f.beadSize=d=Math.floor(PS.CANVAS_SIZE/a);f.width=d*a;f.height=d*h;f.left=0;}else{f.beadSize=d=Math.floor(PS.CANVAS_SIZE/h);f.width=d*a;f.height=d*h;f.left=Math.floor((PS.CANVAS_SIZE-f.width)/2);}f.top=0;f.right=f.left+f.width;f.bottom=f.top+f.height;f.bgRed=PS.DEFAULT_BG_RED;f.bgGreen=PS.DEFAULT_BG_GREEN;f.bgBlue=PS.DEFAULT_BG_BLUE;f.bgColor=PS.RGBString(f.bgRed,f.bgGreen,f.bgBlue);f.borderRed=PS.DEFAULT_BORDER_RED;f.borderGreen=PS.DEFAULT_BORDER_GREEN;f.borderBlue=PS.DEFAULT_BORDER_BLUE;f.borderColor=PS.RGBString(f.borderRed,f.borderGreen,f.borderBlue);f.borderMax=Math.floor((d-8)/2);f.pointing=-1;f.flash=true;f.flashList=[];f.glyphX=Math.floor(d/2);f.glyphY=Math.floor((d/7)*4);f.beads=[];g=f.top;for(c=0;c<h;c+=1){b=f.left;for(e=0;e<a;e+=1){f.beads.push(PS.InitBead(b,g,d,f.bgColor));b+=d;}g+=d;}return f;};PS.DrawGrid=function(){var b,d,c,a;b=PS.Grid.beads;d=PS.Grid.count;for(c=0;c<d;c+=1){a=b[c];if(a.visible){PS.DrawBead(a);}else{PS.EraseBead(a);}}};PS.CheckX=function(a,b){if(typeof a!=="number"){PS.Oops(b+"x parameter not a number");return false;}a=Math.floor(a);if(a<0){PS.Oops(b+"x parameter negative");return false;}if(a>=PS.Grid.x){PS.Oops(b+"x parameter exceeds grid width");return false;}return true;};PS.CheckY=function(b,a){if(typeof b!=="number"){PS.Oops(a+"y parameter not a number");return false;}b=Math.floor(b);if(b<0){PS.Oops(a+"y parameter negative");return false;}if(b>=PS.Grid.y){PS.Oops(a+"y parameter exceeds grid height");return false;}return true;};PS.GridSize=function(a,g){var f,e,d,c,b;f="[PS.GridSize] ";if(typeof a!=="number"){return PS.Oops(f+"Width param not a number");}if(typeof g!=="number"){return PS.Oops(f+"Height param not a number");}a=Math.floor(a);if(a===PS.DEFAULT){a=PS.GRID_DEFAULT_WIDTH;}else{if(a<1){PS.Oops(f+"Width parameter < 1");a=1;}else{if(a>PS.GRID_MAX){PS.Oops(f+"Width parameter > "+PS.GRID_MAX);a=PS.GRID_MAX;}}}g=Math.floor(g);if(g===PS.DEFAULT){g=PS.GRID_DEFAULT_HEIGHT;}else{if(g<1){PS.Oops(f+"Height parameter < 1");g=1;}else{if(g>PS.GRID_MAX){PS.Oops(f+"Height parameter > "+PS.GRID_MAX);g=PS.GRID_MAX;}}}if(PS.Grid){c=PS.Grid.beads;if(c){d=PS.Grid.count;for(e=0;e<d;e+=1){c[e]=null;}}PS.Grid.beads=null;PS.Grid.flashList=null;PS.Grid=null;}PS.Grid=PS.InitGrid(a,g);if(!PS.Grid){return PS.Oops(f+"Grid initialization failed");}PS.MouseX=-1;PS.MouseY=-1;PS.LastX=-1;PS.LastY=-1;if(PS.Grid){b=document.getElementById("screen");if(b){b.height=PS.Grid.height;PS.DrawGrid();}}return true;};PS.GridBGColor=function(j,f,l){var k,i,a,c,d,m,h;k="[PS.GridBGColor] ";i=(PS.Grid.bgRed*PS.REDSHIFT)+(PS.Grid.bgGreen*256)+PS.Grid.bgBlue;if((j===undefined)||(j===PS.CURRENT)){return i;}if(j===PS.DEFAULT){j=PS.DEFAULT_BG_COLOR;c=PS.DEFAULT_BG_RED;d=PS.DEFAULT_BG_GREEN;m=PS.DEFAULT_BG_BLUE;}else{a=PS.ValidColorParams(k,j,f,l);if(!a){return PS.ERROR;}c=a.r;d=a.g;m=a.b;}PS.Grid.bgRed=c;PS.Grid.bgGreen=d;PS.Grid.bgBlue=m;PS.Grid.bgColor=PS.RGBString(c,d,m);h=document.body;h.style.backgroundColor=PS.Grid.bgColor;h=document.getElementById("status");if(h){h.style.backgroundColor=PS.Grid.bgColor;}h=document.getElementById("screen");if(h){h.width=PS.CANVAS_SIZE;PS.DrawGrid();}return j;};PS.MakeRGB=function(f,e,a){var d,c;d="[PS.MakeRGB] ";if(typeof f!=="number"){return PS.Oops(d+"R parameter not a number");}f=Math.floor(f);if(f<0){f=0;}else{if(f>255){f=255;}}if(typeof e!=="number"){return PS.Oops(d+"G parameter not a number");}e=Math.floor(e);if(e<0){e=0;}else{if(e>255){e=255;}}if(typeof a!=="number"){return PS.Oops(d+"B parameter not a number");}a=Math.floor(a);if(a<0){a=0;}else{if(a>255){a=255;}}c=(f*PS.REDSHIFT)+(e*256)+a;return c;};PS.DoBeadShow=function(b,e,c){var d,a;d=b+(e*PS.Grid.x);a=PS.Grid.beads[d];if((c===undefined)||(c===PS.CURRENT)||(c===a.visible)){return a.visible;}a.visible=c;if(c){if(PS.Grid.flash&&a.flash){PS.FlashStart(b,e);}else{a.colorNow=a.color;PS.DrawBead(a);}}else{PS.EraseBead(a);}return c;};PS.BeadShow=function(a,f,b){var e,d,c;e="[PS.BeadShow] ";if((b!==undefined)&&(b!==PS.CURRENT)){if((b===PS.DEFAULT)||b){b=true;}else{b=false;}}if(a===PS.ALL){if(f===PS.ALL){for(c=0;c<PS.Grid.y;c+=1){for(d=0;d<PS.Grid.x;d+=1){b=PS.DoBeadShow(d,c,b);}}}else{if(!PS.CheckY(f,e)){b=PS.ERROR;}else{for(d=0;d<PS.Grid.x;d+=1){b=PS.DoBeadShow(d,f,b);}}}}else{if(f===PS.ALL){if(!PS.CheckX(a,e)){return PS.ERROR;}for(c=0;c<PS.Grid.y;c+=1){b=PS.DoBeadShow(a,c,b);}}else{if(!PS.CheckX(a,e)||!PS.CheckY(f,e)){b=PS.ERROR;}else{b=PS.DoBeadShow(a,f,b);}}}return b;};PS.DoBeadColor=function(d,k,e,j,h,c){var f,a;f=d+(k*PS.Grid.x);a=PS.Grid.beads[f];if((e===undefined)||(e===PS.CURRENT)){if(a.empty){return PS.EMPTY;}return(a.red*PS.REDSHIFT)+(a.green*256)+a.blue;}if(e===PS.EMPTY){a.empty=true;}else{a.empty=false;a.red=j;a.green=h;a.blue=c;if(a.alpha<PS.DEFAULT_ALPHA){a.alphaRed=PS.Dissolve(PS.Grid.bgRed,j,a.alpha);a.alphaGreen=PS.Dissolve(PS.Grid.bgGreen,h,a.alpha);a.alphaBlue=PS.Dissolve(PS.Grid.bgBlue,c,a.alpha);a.color=PS.RGBString(a.alphaRed,a.alphaGreen,a.alphaBlue);}else{a.alphaRed=j;a.alphaGreen=h;a.alphaBlue=c;a.color=PS.RGBString(j,h,c);}}if(a.visible){if(PS.Grid.flash&&a.flash){PS.FlashStart(d,k);}else{a.colorNow=a.color;PS.DrawBead(a);}}return e;};PS.BeadColor=function(o,l,k,h,n){var m,a,c,d,p,f,e;m="[PS.BeadColor] ";if((k===PS.DEFAULT)||(k===PS.EMPTY)){k=PS.EMPTY;c=d=p=undefined;}else{if((k!==undefined)&&(k!==PS.CURRENT)){a=PS.ValidColorParams(m,k,h,n);if(!a){return PS.ERROR;}c=a.r;d=a.g;p=a.b;}}if(o===PS.ALL){if(l===PS.ALL){for(e=0;e<PS.Grid.y;e+=1){for(f=0;f<PS.Grid.x;f+=1){k=PS.DoBeadColor(f,e,k,c,d,p);}}}else{if(!PS.CheckY(l,m)){k=PS.ERROR;}else{for(f=0;f<PS.Grid.x;f+=1){k=PS.DoBeadColor(f,l,k,c,d,p);}}}}else{if(l===PS.ALL){if(!PS.CheckX(o,m)){return PS.ERROR;}for(e=0;e<PS.Grid.y;e+=1){k=PS.DoBeadColor(o,e,k,c,d,p);}}else{if(!PS.CheckX(o,m)||!PS.CheckY(l,m)){k=PS.ERROR;}else{k=PS.DoBeadColor(o,l,k,c,d,p);}}}return k;};PS.DoBeadAlpha=function(c,f,d){var e,b;e=c+(f*PS.Grid.x);b=PS.Grid.beads[e];if((d===undefined)||(d===PS.CURRENT)||(d===b.alpha)){return b.alpha;}b.alpha=d;if(b.alpha<PS.DEFAULT_ALPHA){b.alphaRed=PS.Dissolve(PS.Grid.bgRed,b.red,d);b.alphaGreen=PS.Dissolve(PS.Grid.bgGreen,b.green,d);b.alphaBlue=PS.Dissolve(PS.Grid.bgBlue,b.blue,d);b.color=PS.RGBString(b.alphaRed,b.alphaGreen,b.alphaBlue);}else{b.alphaRed=b.red;b.alphaGreen=b.green;b.alphaBlue=b.blue;b.color=PS.RGBString(b.red,b.green,b.blue);}if(b.visible&&!b.empty){if(PS.Grid.flash&&b.flash){PS.FlashStart(c,f);}else{b.colorNow=b.color;PS.DrawBead(b);}}return d;};PS.BeadAlpha=function(b,g,c){var f,e,d;f="[PS.BeadAlpha] ";if(c!==undefined){if(typeof c!=="number"){return PS.Oops(f+"alpha param is not a number");}c=Math.floor(c);if(c===PS.DEFAULT){c=PS.DEFAULT_ALPHA;}else{if(c!==PS.CURRENT){if(c<0){c=0;}else{if(c>PS.DEFAULT_ALPHA){c=PS.DEFAULT_ALPHA;}}}}}if(b===PS.ALL){if(g===PS.ALL){for(d=0;d<PS.Grid.y;d+=1){for(e=0;e<PS.Grid.x;e+=1){c=PS.DoBeadAlpha(e,d,c);}}}else{if(!PS.CheckY(g,f)){c=PS.ERROR;}else{for(e=0;e<PS.Grid.x;e+=1){c=PS.DoBeadAlpha(e,g,c);}}}}else{if(g===PS.ALL){if(!PS.CheckX(b,f)){return PS.ERROR;}for(d=0;d<PS.Grid.y;d+=1){c=PS.DoBeadAlpha(b,d,c);}}else{if(!PS.CheckX(b,f)||!PS.CheckY(g,f)){c=PS.ERROR;}else{c=PS.DoBeadAlpha(b,g,c);}}}return c;};PS.DoBeadBorderWidth=function(b,e,d){var c,a;c=b+(e*PS.Grid.x);a=PS.Grid.beads[c];if((d===undefined)||(d===PS.CURRENT)){return a.borderWidth;}a.borderWidth=d;if(a.visible){PS.DrawBead(a);}return d;};PS.BeadBorderWidth=function(a,f,e){var d,c,b;d="[PS.BeadBorderWidth] ";if(e===PS.DEFAULT){e=PS.DEFAULT_BORDER_WIDTH;}else{if((e!==undefined)&&(e!==PS.CURRENT)){if(typeof e!=="number"){return PS.Oops(d+"width param is not a number");}e=Math.floor(e);if(e<0){e=0;}else{if(e>PS.Grid.borderMax){e=PS.Grid.borderMax;}}}}if(a===PS.ALL){if(f===PS.ALL){for(b=0;b<PS.Grid.y;b+=1){for(c=0;c<PS.Grid.x;c+=1){e=PS.DoBeadBorderWidth(c,b,e);}}}else{if(!PS.CheckY(f,d)){e=PS.ERROR;}else{for(c=0;c<PS.Grid.x;c+=1){e=PS.DoBeadBorderWidth(c,f,e);}}}}else{if(f===PS.ALL){if(!PS.CheckX(a,d)){return PS.ERROR;}for(b=0;b<PS.Grid.y;b+=1){e=PS.DoBeadBorderWidth(a,b,e);}}else{if(!PS.CheckX(a,d)||!PS.CheckY(f,d)){e=PS.ERROR;}else{e=PS.DoBeadBorderWidth(a,f,e);}}}return e;};PS.DoBeadBorderColor=function(d,k,e,j,h,c){var f,a;f=d+(k*PS.Grid.x);a=PS.Grid.beads[f];if((e===undefined)||(e===PS.CURRENT)){return(a.borderRed*PS.REDSHIFT)+(a.borderGreen*256)+a.borderBlue;}a.borderRed=j;a.borderGreen=h;a.borderBlue=c;if(a.borderAlpha<PS.DEFAULT_ALPHA){j=PS.Dissolve(PS.Grid.bgRed,j,a.borderAlpha);h=PS.Dissolve(PS.Grid.bgGreen,h,a.borderAlpha);c=PS.Dissolve(PS.Grid.bgBlue,c,a.borderAlpha);}a.borderColor=PS.RGBString(j,h,c);if(a.visible){PS.DrawBead(a);}return e;};PS.BeadBorderColor=function(o,l,k,h,n){var m,a,c,d,p,f,e;m="[PS.BeadBorderColor] ";if(k===PS.DEFAULT){k=PS.DEFAULT_BORDER_COLOR;c=PS.DEFAULT_BORDER_RED;d=PS.DEFAULT_BORDER_GREEN;p=PS.DEFAULT_BORDER_BLUE;}else{if((k!==undefined)&&(k!==PS.CURRENT)){a=PS.ValidColorParams(m,k,h,n);if(!a){return PS.ERROR;}c=a.r;d=a.g;p=a.b;}}if(o===PS.ALL){if(l===PS.ALL){for(e=0;e<PS.Grid.y;e+=1){for(f=0;f<PS.Grid.x;f+=1){k=PS.DoBeadBorderColor(f,e,k,c,d,p);}}}else{if(!PS.CheckY(l,m)){k=PS.ERROR;}else{for(f=0;f<PS.Grid.x;f+=1){k=PS.DoBeadBorderColor(f,l,k,c,d,p);}}}}else{if(l===PS.ALL){if(!PS.CheckX(o,m)){return PS.ERROR;}for(e=0;e<PS.Grid.y;e+=1){k=PS.DoBeadBorderColor(o,e,k,c,d,p);}}else{if(!PS.CheckX(o,m)||!PS.CheckY(l,m)){k=PS.ERROR;}else{k=PS.DoBeadBorderColor(o,l,k,c,d,p);}}}return k;};PS.DoBeadBorderAlpha=function(e,l,f){var h,d,k,j,c;h=e+(l*PS.Grid.x);d=PS.Grid.beads[h];if((f===undefined)||(f===PS.CURRENT)||(f===d.borderAlpha)){return d.borderAlpha;}d.borderAlpha=f;if(f<PS.DEFAULT_ALPHA){k=PS.Dissolve(PS.Grid.bgRed,d.borderRed,f);j=PS.Dissolve(PS.Grid.bgGreen,d.borderGreen,f);c=PS.Dissolve(PS.Grid.bgBlue,d.borderBlue,f);d.borderColor=PS.RGBString(k,j,c);}else{d.borderColor=PS.RGBString(d.borderRed,d.borderGreen,d.borderBlue);}if(d.visible){PS.DrawBead(d);}return f;};PS.BeadBorderAlpha=function(b,g,c){var f,e,d;f="[PS.BeadBorderAlpha] ";if(c!==undefined){if(typeof c!=="number"){return PS.Oops(f+"alpha param is not a number");}c=Math.floor(c);if(c===PS.DEFAULT){c=PS.DEFAULT_ALPHA;}else{if(c!==PS.CURRENT){if(c<0){c=0;}else{if(c>PS.DEFAULT_ALPHA){c=PS.DEFAULT_ALPHA;}}}}}if(b===PS.ALL){if(g===PS.ALL){for(d=0;d<PS.Grid.y;d+=1){for(e=0;e<PS.Grid.x;e+=1){c=PS.DoBeadBorderAlpha(e,d,c);}}}else{if(!PS.CheckY(g,f)){c=PS.ERROR;}else{for(e=0;e<PS.Grid.x;e+=1){c=PS.DoBeadBorderAlpha(e,g,c);}}}}else{if(g===PS.ALL){if(!PS.CheckX(b,f)){return PS.ERROR;}for(d=0;d<PS.Grid.y;d+=1){c=PS.DoBeadBorderAlpha(b,d,c);}}else{if(!PS.CheckX(b,f)||!PS.CheckY(g,f)){c=PS.ERROR;}else{c=PS.DoBeadBorderAlpha(b,g,c);}}}return c;};PS.DoBeadGlyph=function(b,e,d){var c,a;c=b+(e*PS.Grid.x);a=PS.Grid.beads[c];if((d===undefined)||(d===PS.CURRENT)||(d===a.glyph)){return a.glyph;}a.glyph=d;a.glyphStr=String.fromCharCode(d);if(a.visible){if(PS.Grid.flash&&a.flash){PS.FlashStart(b,e);}else{a.colorNow=a.color;PS.DrawBead(a);}}return d;};PS.BeadGlyph=function(a,h,f){var e,d,c,b;e="[PS.BeadGlyph] ";d=typeof f;if(d!=="undefined"){if(d==="string"){if(f.length<1){return PS.Oops(e+"glyph param is empty string");}f=f.charCodeAt(0);}else{if(d==="number"){f=Math.floor(f);if(f===PS.DEFAULT){f=0;}else{if(f!==PS.CURRENT){if(f<0){f=0;}}}}else{return PS.Oops(e+"glyph param not a string or number");}}}if(a===PS.ALL){if(h===PS.ALL){for(b=0;b<PS.Grid.y;b+=1){for(c=0;c<PS.Grid.x;c+=1){f=PS.DoBeadGlyph(c,b,f);}}}else{if(!PS.CheckY(h,e)){f=PS.ERROR;}else{for(c=0;c<PS.Grid.x;c+=1){f=PS.DoBeadGlyph(c,h,f);}}}}else{if(h===PS.ALL){if(!PS.CheckX(a,e)){return PS.ERROR;}for(b=0;b<PS.Grid.y;b+=1){f=PS.DoBeadGlyph(a,b,f);}}else{if(!PS.CheckX(a,e)||!PS.CheckY(h,e)){f=PS.ERROR;}else{f=PS.DoBeadGlyph(a,h,f);}}}return f;};PS.DoBeadGlyphColor=function(d,k,e,j,h,c){var f,a;f=d+(k*PS.Grid.x);a=PS.Grid.beads[f];if((e===undefined)||(e===PS.CURRENT)){return(a.glyphRed*PS.REDSHIFT)+(a.glyphGreen*256)+a.glyphBlue;}a.glyphRed=j;a.glyphGreen=h;a.glyphBlue=c;if(a.alpha<PS.DEFAULT_ALPHA){j=PS.Dissolve(PS.Grid.bgRed,j,a.alpha);h=PS.Dissolve(PS.Grid.bgGreen,h,a.alpha);c=PS.Dissolve(PS.Grid.bgBlue,c,a.alpha);}a.glyphColor=PS.RGBString(j,h,c);if(a.visible&&(a.glyph>0)){PS.DrawBead(a);}return e;};PS.BeadGlyphColor=function(o,l,k,h,n){var m,a,c,d,p,f,e;m="[PS.BeadGlyphColor] ";if(k===PS.DEFAULT){k=PS.DEFAULT_GLYPH_COLOR;c=PS.DEFAULT_GLYPH_RED;d=PS.DEFAULT_GLYPH_GREEN;p=PS.DEFAULT_GLYPH_BLUE;}else{if((k!==undefined)&&(k!==PS.CURRENT)){a=PS.ValidColorParams(m,k,h,n);if(!a){return PS.ERROR;}c=a.r;d=a.g;p=a.b;}}if(o===PS.ALL){if(l===PS.ALL){for(e=0;e<PS.Grid.y;e+=1){for(f=0;f<PS.Grid.x;f+=1){k=PS.DoBeadGlyphColor(f,e,k,c,d,p);}}}else{if(!PS.CheckY(l,m)){k=PS.ERROR;}else{for(f=0;f<PS.Grid.x;f+=1){k=PS.DoBeadGlyphColor(f,l,k,c,d,p);}}}}else{if(l===PS.ALL){if(!PS.CheckX(o,m)){return PS.ERROR;}for(e=0;e<PS.Grid.y;e+=1){k=PS.DoBeadGlyphColor(o,e,k,c,d,p);}}else{if(!PS.CheckX(o,m)||!PS.CheckY(l,m)){k=PS.ERROR;}else{k=PS.DoBeadGlyphColor(o,l,k,c,d,p);}}}return k;};PS.DoBeadFlash=function(b,e,c){var d,a;d=b+(e*PS.Grid.x);a=PS.Grid.beads[d];if((c===undefined)||(c===PS.CURRENT)){return a.flash;}a.flash=c;return c;};PS.BeadFlash=function(a,f,b){var e,d,c;e="[PS.BeadFlash] ";if((b!==undefined)&&(b!==PS.CURRENT)){if(b===PS.DEFAULT){b=true;}else{if(b){b=true;}else{b=false;}}}if(a===PS.ALL){if(f===PS.ALL){for(c=0;c<PS.Grid.y;c+=1){for(d=0;d<PS.Grid.x;d+=1){b=PS.DoBeadFlash(d,c,b);}}}else{if(!PS.CheckY(f,e)){b=PS.ERROR;}else{for(d=0;d<PS.Grid.x;d+=1){b=PS.DoBeadFlash(d,f,b);}}}}else{if(f===PS.ALL){if(!PS.CheckX(a,e)){return PS.ERROR;}for(c=0;c<PS.Grid.y;c+=1){b=PS.DoBeadFlash(a,c,b);}}else{if(!PS.CheckX(a,e)||!PS.CheckY(f,e)){b=PS.ERROR;}else{b=PS.DoBeadFlash(a,f,b);}}}return b;};PS.DoBeadFlashColor=function(d,k,e,j,h,c){var f,a;f=d+(k*PS.Grid.x);a=PS.Grid.beads[f];if((e===undefined)||(e===PS.CURRENT)){return(a.flashRed*PS.REDSHIFT)+(a.flashGreen*256)+a.flashBlue;}a.flashRed=j;a.flashGreen=h;a.flashBlue=c;a.flashColor=PS.RGBString(j,h,c);return e;};PS.BeadFlashColor=function(o,l,k,h,n){var m,c,d,p,a,f,e;m="[PS.BeadFlashColor] ";if(k===PS.DEFAULT){k=PS.DEFAULT_FLASH_COLOR;c=PS.DEFAULT_FLASH_RED;d=PS.DEFAULT_FLASH_GREEN;p=PS.DEFAULT_FLASH_BLUE;}else{if((k!==undefined)&&(k!==PS.CURRENT)){a=PS.ValidColorParams(m,k,h,n);if(!a){return PS.ERROR;}c=a.r;d=a.g;p=a.b;}}if(o===PS.ALL){if(l===PS.ALL){for(e=0;e<PS.Grid.y;e+=1){for(f=0;f<PS.Grid.x;f+=1){k=PS.DoBeadFlashColor(f,e,k,c,d,p);}}}else{if(!PS.CheckY(l,m)){k=PS.ERROR;}else{for(f=0;f<PS.Grid.x;f+=1){k=PS.DoBeadFlashColor(f,l,k,c,d,p);}}}}else{if(l===PS.ALL){if(!PS.CheckX(o,m)){return PS.ERROR;}for(e=0;e<PS.Grid.y;e+=1){k=PS.DoBeadFlashColor(o,e,k,c,d,p);}}else{if(!PS.CheckX(o,m)||!PS.CheckY(l,m)){k=PS.ERROR;}else{k=PS.DoBeadFlashColor(o,l,k,c,d,p);}}}return k;};PS.DoBeadData=function(b,e,d){var c,a;c=b+(e*PS.Grid.x);a=PS.Grid.beads[c];if(d!==undefined){a.data=d;}return a.data;};PS.BeadData=function(a,f,e){var d,c,b;d="[PS.BeadData] ";if(a===PS.ALL){if(f===PS.ALL){for(b=0;b<PS.Grid.y;b+=1){for(c=0;c<PS.Grid.x;c+=1){e=PS.DoBeadData(c,b,e);}}}else{if(!PS.CheckY(f,d)){e=PS.ERROR;}else{for(c=0;c<PS.Grid.x;c+=1){e=PS.DoBeadData(c,f,e);}}}}else{if(f===PS.ALL){if(!PS.CheckX(a,d)){return PS.ERROR;}for(b=0;b<PS.Grid.y;b+=1){e=PS.DoBeadData(a,b,e);}}else{if(!PS.CheckX(a,d)||!PS.CheckY(f,d)){e=PS.ERROR;}else{e=PS.DoBeadData(a,f,e);}}}return e;};PS.DoBeadAudio=function(b,f,e,d){var c,a;c=b+(f*PS.Grid.x);a=PS.Grid.beads[c];if((e!==undefined)&&(e!==PS.CURRENT)){a.audio=e;}if((d!==undefined)&&(d!==PS.CURRENT)){a.volume=d;}return a.audio;};PS.BeadAudio=function(a,g,f,e){var d,c,b;d="[PS.BeadAudio] ";if((f!==undefined)&&(f!==PS.CURRENT)){if(f===PS.DEFAULT){f=null;}else{if(typeof f!=="string"){return PS.Oops(d+"Audio param is not a string");}if(f.length<1){f=null;}}}if((e!==undefined)&&(e!==PS.CURRENT)){if(e===PS.DEFAULT){e=PS.DEFAULT_VOLUME;}else{if(typeof e!=="number"){return PS.Oops(d+"Volume param not a number");}if(e<0){e=0;}else{if(e>PS.MAX_VOLUME){e=PS.MAX_VOLUME;}}}}if(a===PS.ALL){if(g===PS.ALL){for(b=0;b<PS.Grid.y;b+=1){for(c=0;c<PS.Grid.x;c+=1){f=PS.DoBeadAudio(c,b,f,e);}}}else{if(!PS.CheckY(g,d)){f=PS.ERROR;}else{for(c=0;c<PS.Grid.x;c+=1){f=PS.DoBeadAudio(c,g,f,e);}}}}else{if(g===PS.ALL){if(!PS.CheckX(a,d)){return PS.ERROR;}for(b=0;b<PS.Grid.y;b+=1){f=PS.DoBeadAudio(a,b,f,e);}}else{if(!PS.CheckX(a,d)||!PS.CheckY(g,d)){f=PS.ERROR;}else{f=PS.DoBeadAudio(a,g,f,e);}}}return f;};PS.DoBeadFunction=function(b,e,c){var d,a;d=b+(e*PS.Grid.x);a=PS.Grid.beads[d];if((c!==undefined)&&(c!==PS.CURRENT)){a.exec=c;}return a.exec;};PS.BeadFunction=function(a,f,b){var e,d,c;e="[PS.BeadFunction] ";if((b!==undefined)||(b!==PS.CURRENT)){if(b===PS.DEFAULT){b=null;}else{if(typeof b!=="function"){return PS.Oops(e+"exec param not a valid function");}}}if(a===PS.ALL){if(f===PS.ALL){for(c=0;c<PS.Grid.y;c+=1){for(d=0;d<PS.Grid.x;d+=1){b=PS.DoBeadFunction(d,c,b);}}}else{if(!PS.CheckY(f,e)){b=PS.ERROR;}else{for(d=0;d<PS.Grid.x;d+=1){b=PS.DoBeadFunction(d,f,b);}}}}else{if(f===PS.ALL){if(!PS.CheckX(a,e)){return PS.ERROR;}for(c=0;c<PS.Grid.y;c+=1){b=PS.DoBeadFunction(a,c,b);}}else{if(!PS.CheckX(a,e)||!PS.CheckY(f,e)){b=PS.ERROR;}else{b=PS.DoBeadFunction(a,f,b);}}}return b;};PS.DoBeadTouch=function(b,d){var c,a;c=b+(d*PS.Grid.x);a=PS.Grid.beads[c];if(typeof a.audio==="string"){PS.AudioPlay(a.audio,a.volume);}if(typeof a.exec==="function"){a.exec(b,d,a.data);}PS.Click(b,d,a.data);};PS.BeadTouch=function(a,e){var d,c,b;d="[PS.BeadTouch] ";if(a===PS.ALL){if(e===PS.ALL){for(b=0;b<PS.Grid.y;b+=1){for(c=0;c<PS.Grid.x;c+=1){PS.DoBeadTouch(c,b);}}}else{if(PS.CheckY(e,d)){for(c=0;c<PS.Grid.x;c+=1){PS.DoBeadTouch(c,e);}}}}else{if(e===PS.ALL){if(!PS.CheckX(a,d)){return;}for(b=0;b<PS.Grid.y;b+=1){PS.DoBeadTouch(a,b);}}else{if(PS.CheckX(a,d)&&PS.CheckY(e,d)){PS.DoBeadTouch(a,e);}}}};PS.StatusText=function(d){var b,a,c;b="[PS.StatusText] ";a=typeof d;if(a!=="undefined"){if(a!=="string"){return PS.Oops(b+"Parameter is not a valid string");}c=document.getElementById("status");if(c){if(PS.StatusFading){c.style.color=PS.Grid.bgColor;PS.StatusPhase=0;}c.value=d;}PS.Status=d;}return PS.Status;};PS.StatusColor=function(b){var c,a,d;c="[PS.StatusColor] ";if((b!==undefined)&&(b!==PS.CURRENT)){if(b===PS.DEFAULT){b=PS.DEFAULT_TEXT_COLOR;}else{b=PS.ValidRGB(b,c);if(b<0){return PS.ERROR;}}a=PS.UnmakeRGB(b);PS.StatusRed=a.r;PS.StatusGreen=a.g;PS.StatusBlue=a.b;PS.StatusHue=PS.RGBString(a.r,a.g,a.b);PS.StatusPhase=100;d=document.getElementById("status");if(d){d.style.color=PS.StatusHue;}d=document.getElementById("footer");if(d){d.style.color=PS.StatusHue;}}return PS.StatusHue;};PS.StatusFade=function(a){var b,c;b="[PS.StatusFade] ";if((a!==undefined)&&(a!==PS.CURRENT)){if(a||(a===PS.DEFAULT)){a=true;}else{a=false;PS.StatusPhase=100;c=document.getElementById("status");if(c){c.style.color=PS.StatusHue;}}PS.StatusFading=a;}return PS.StatusFading;};PS.DebugOpen=function(){var b,a;if(!PS.DebugWindow){b=document.getElementById("debug");b.style.display="inline";a=document.getElementById("monitor");if(a){a.value="";}PS.DebugWindow=true;}};PS.DebugClose=function(){var a;if(PS.DebugWindow){a=document.getElementById("debug");a.style.display="none";PS.DebugWindow=false;}};PS.Debug=function(b){var a;if((typeof b!=="string")||(b.length<1)){return;}PS.DebugOpen();a=document.getElementById("monitor");if(a){a.value+=b;a.scrollTop=a.scrollHeight;}};PS.DebugClear=function(){var a;a=document.getElementById("footer");if(a){a.innerHTML="Version "+PS.VERSION;}if(PS.DebugWindow){a=document.getElementById("monitor");if(a){a.value="";}}};PS.Oops=function(b){var a;if((typeof b!=="string")||(b.length<1)){b="???";}a=document.getElementById("footer");if(a){a.innerHTML=b;}PS.Debug("ERROR: "+b+"\n");PS.AudioPlay("fx_uhoh",PS.DEFAULT,PS.DEFAULT,PS.DEFAULT);return PS.ERROR;};PS.Clock=function(b){var a;a="[PS.Clock] ";if(b!==undefined){if(typeof b!=="number"){return PS.Oops(a+"ticks parameter not a number");}b=Math.floor(b);if(b<1){PS.UserClock=0;}else{if(typeof PS.Tick!=="function"){return PS.Oops(a+"PS.Tick function undefined");}}PS.UserDelay=0;PS.UserClock=b;}return PS.UserClock;};PS.Timer=function(){window.setTimeout(function(){window.requestAnimationFrame(PS.Timer);PS.DoTimer();},PS.DEFAULT_FPS);};PS.DoTimer=function(){var n,h,a,f,l,k,d,j,m;PS.FlashDelay+=1;if(PS.FlashDelay>=PS.FLASH_INTERVAL){PS.FlashDelay=0;PS.FlashNext();if(PS.StatusFading&&(PS.StatusPhase<100)){n=PS.StatusPhase+PS.STATUS_FLASH_STEP;if(n>=100){n=100;h=PS.StatusHue;}else{a=PS.Dissolve(PS.Grid.bgRed,PS.StatusRed,n);f=PS.Dissolve(PS.Grid.bgGreen,PS.StatusGreen,n);l=PS.Dissolve(PS.Grid.bgBlue,PS.StatusBlue,n);h=PS.RGBString(a,f,l);}PS.StatusPhase=n;k=document.getElementById("status");if(k){k.style.color=h;}}}if(PS.UserClock>0){PS.UserDelay+=1;if(PS.UserDelay>=PS.UserClock){PS.UserDelay=0;if(PS.Tick){try{PS.Tick();}catch(c){PS.UserClock=0;PS.Oops("PS.Tick() failed ["+c.message+"]");}}}}};PS.FlashStart=function(c,f){var e,b,d,a;e=c+(f*PS.Grid.x);b=PS.Grid.beads[e];b.flashPhase=0;b.colorNow=b.flashColor;PS.DrawBead(b);a=PS.Grid.flashList.length;for(d=0;d<a;d+=1){if(PS.Grid.flashList[d]===e){return;}}PS.Grid.flashList.push(e);};PS.FlashNext=function(){var d,f,k,c,e,j,h,a;d=PS.Grid.flashList.length;f=0;while(f<d){k=PS.Grid.flashList[f];c=PS.Grid.beads[k];e=c.flashPhase+PS.FLASH_STEP;if(e>=100){c.colorNow=c.color;c.flashPhase=0;PS.Grid.flashList.splice(f,1);d-=1;}else{c.flashPhase=e;j=PS.Dissolve(c.flashRed,c.alphaRed,e);h=PS.Dissolve(c.flashGreen,c.alphaGreen,e);a=PS.Dissolve(c.flashBlue,c.alphaBlue,e);c.colorNow=PS.RGBString(j,h,a);f+=1;}PS.DrawBead(c);}};PS.MouseXY=function(b,a){var h,g,f,d,j,c,e;if(PS.Grid){if(a.x&&a.y){h=a.x;g=a.y;}else{h=a.clientX;g=a.clientY;}h+=(document.body.scrollLeft+document.documentElement.scrollLeft-b.offsetLeft);g+=(document.body.scrollTop+document.documentElement.scrollTop-b.offsetTop);if((h>=PS.Grid.left)&&(h<PS.Grid.right)&&(g>=PS.Grid.top)&&(g<PS.Grid.bottom)){f=PS.Grid.beads;e=0;for(j=0;j<PS.Grid.y;j+=1){d=f[e];if((g>=d.top)&&(g<d.bottom)){for(c=0;c<PS.Grid.x;c+=1){d=f[e];if((h>=d.left)&&(h<d.right)){PS.MouseX=c;PS.MouseY=j;return;}e+=1;}}else{e+=PS.Grid.x;}}}}PS.MouseX=-1;PS.MouseY=-1;};PS.MouseDown=function(d){var a;PS.MouseXY(this,d);if(PS.MouseX>=0){a=PS.Grid.beads[PS.MouseX+(PS.MouseY*PS.Grid.x)];if(a.audio){PS.AudioPlay(a.audio,a.volume);}if(typeof a.exec==="function"){try{a.exec(PS.MouseX,PS.MouseY,a.data);}catch(c){PS.Oops("Bead "+PS.MouseX+", "+PS.MouseY+" function failed ["+c.message+"]");}}if(PS.Click){try{PS.Click(PS.MouseX,PS.MouseY,a.data);}catch(b){PS.Oops("PS.Click() failed ["+b.message+"]");}}}};PS.MouseUp=function(c){var a;if(PS.Grid&&PS.Release){PS.MouseXY(this,c);if(PS.MouseX>=0){a=PS.Grid.beads[PS.MouseX+(PS.MouseY*PS.Grid.x)];try{PS.Release(PS.MouseX,PS.MouseY,a.data);}catch(b){PS.Oops("PS.Release() failed ["+b.message+"]");}}}};PS.MouseMove=function(f){var b,e;PS.OverCanvas=true;PS.MouseXY(this,f);if(PS.MouseX>=0){b=PS.Grid.beads[PS.MouseX+(PS.MouseY*PS.Grid.x)];if((PS.MouseX!==PS.LastX)||(PS.MouseY!==PS.LastY)){if(PS.Leave){if(PS.LastX>=0){e=PS.Grid.beads[PS.LastX+(PS.LastY*PS.Grid.x)];try{PS.Leave(PS.LastX,PS.LastY,e.data);}catch(d){PS.Oops("PS.Leave() failed ["+d.message+"]");}}}if(PS.Enter){try{PS.Enter(PS.MouseX,PS.MouseY,b.data);}catch(c){PS.Oops("PS.Enter() failed ["+c.message+"]");}}PS.LastX=PS.MouseX;PS.LastY=PS.MouseY;}}else{if(PS.LastX>=0){if(PS.Leave){e=PS.Grid.beads[PS.LastX+(PS.LastY*PS.Grid.x)];try{PS.Leave(PS.LastX,PS.LastY,e.data);}catch(a){PS.Oops("PS.Leave() failed ["+a.message+"]");}}PS.LastX=-1;PS.LastY=-1;}}};PS.MouseOut=function(c){var b;PS.OverCanvas=false;PS.MouseBead=-1;if(PS.Grid&&PS.Leave){if(PS.LastBead>=0){b=PS.Grid.beads[PS.LastBead];try{PS.Leave(b.x,b.y,b.data);}catch(a){PS.Oops("PS.Leave() failed ["+a.message+"]");}}}PS.LastBead=-1;};PS.KeyFilter=function(b,a){if((b>=65)&&(b<=90)){if(a){b+=32;}return b;}switch(b){case 188:b=44;break;case 190:b=46;break;case 191:b=47;break;case 222:b=39;break;case 219:b=91;break;case 221:b=93;break;case 220:b=92;break;default:break;}if(a){switch(b){case 96:b=126;break;case 49:b=33;break;case 50:b=64;break;case 51:b=35;break;case 52:b=36;break;case 53:b=37;break;case 54:b=94;break;case 55:b=38;break;case 56:b=42;break;case 57:b=40;break;case 48:b=41;break;case 45:b=95;break;case 61:b=43;break;case 91:b=123;break;case 93:b=125;break;case 92:b=124;break;case 59:b=58;break;case 39:b=34;break;case 44:b=60;break;case 46:b=62;break;case 47:b=63;break;default:break;}}return b;};PS.SysKeyDown=function(c){var a;if(PS.KeyDown){c.returnValue=false;if(!c.which){a=c.keyCode;}else{a=c.which;}a=PS.KeyFilter(a,c.shiftKey);try{PS.KeyDown(a,c.shiftKey,c.ctrlKey);}catch(b){PS.Oops("PS.KeyDown() failed ["+b.message+"]");}}return false;};PS.SysKeyUp=function(c){var a;if(PS.KeyUp){c.returnValue=false;if(c.which===null){a=c.keyCode;}else{a=c.which;}a=PS.KeyFilter(a,c.shiftKey);try{PS.KeyUp(a,c.shiftKey,c.ctrlKey);}catch(b){PS.Oops("PS.KeyUp() failed ["+b.message+"]");}}return false;};PS.SysWheel=function(b){var c;if(!PS.OverCanvas){b.returnValue=true;return true;}if(PS.Wheel){c=0;if(!b){b=window.event;}if(b.wheelDelta){c=b.wheelDelta/120;if(window.opera){c=-c;}}else{if(b.detail){c=-(b.detail/3);}}if(b.preventDefault){b.preventDefault();}if(c>=PS.FORWARD){c=PS.FORWARD;}else{c=PS.BACKWARD;}try{PS.Wheel(c);}catch(a){PS.Oops("PS.Wheel() failed ["+a.message+"]");}}b.returnValue=false;};PS.Sys=function(){var a,c;a="[PS.Sys] ";if(!PS.AudioInit()){return;}PS.AudioLoad("fx_uhoh");if(typeof PS.Init!=="function"){PS.Init=null;PS.Oops(a+"WARNING: PS.Init function undefined");}if(typeof PS.Click!=="function"){PS.Click=null;PS.Oops(a+"WARNING: PS.Click function undefined");}if(typeof PS.Release!=="function"){PS.Release=null;PS.Oops(a+"WARNING: PS.Release function undefined");}if(typeof PS.Enter!=="function"){PS.Enter=null;PS.Oops(a+"WARNING: PS.Enter function undefined");}if(typeof PS.Leave!=="function"){PS.Leave=null;PS.Oops(a+"WARNING: PS.Leave function undefined");}if(typeof PS.KeyDown!=="function"){PS.KeyDown=null;PS.Oops(a+"WARNING: PS.KeyDown function undefined");}if(typeof PS.KeyUp!=="function"){PS.KeyUp=null;PS.Oops(a+"WARNING: PS.KeyUp function undefined");}if(typeof PS.Wheel!=="function"){PS.Wheel=null;PS.Oops(a+"WARNING: PS.Wheel function undefined");}c=document.getElementById("screen");if(c){c.addEventListener("mousedown",PS.MouseDown,false);c.addEventListener("mouseup",PS.MouseUp,false);c.addEventListener("mouseout",PS.MouseOut,false);c.addEventListener("mousemove",PS.MouseMove,false);}if(window.addEventListener){window.addEventListener("DOMMouseScroll",PS.SysWheel,false);window.addEventListener("mousewheel",PS.SysWheel,false);}else{window.onmousewheel=document.onmousewheel=PS.SysWheel;}PS.ImageCanvas=document.createElement("canvas");PS.ImageCanvas.width=PS.GRID_MAX;PS.ImageCanvas.height=PS.GRID_MAX;PS.Timer();c=document.getElementById("footer");if(c){c.innerHTML="Version "+PS.VERSION;}if(PS.Init){try{PS.Init();}catch(b){PS.Oops("PS.Init() failed ["+b.message+"]");}}else{PS.GridSize(PS.GRID_DEFAULT_WIDTH,PS.GRID_DEFAULT_HEIGHT);}};PS.Random=function(b){var a;a="[PS.Random] ";if(typeof b!=="number"){return PS.Oops(a+"Parameter is not a number");}b=Math.floor(b);if(b<2){return 1;}b=Math.random()*b;b=Math.floor(b)+1;return b;};PS.PianoFiles=["a0","bb0","b0","c1","db1","d1","eb1","e1","f1","gb1","g1","ab1","a1","bb1","b1","c2","db2","d2","eb2","e2","f2","gb2","g2","ab2","a2","bb2","b2","c3","db3","d3","eb3","e3","f3","gb3","g3","ab3","a3","bb3","b3","c4","db4","d4","eb4","e4","f4","gb4","g4","ab4","a4","bb4","b4","c5","db5","d5","eb5","e5","f5","gb5","g5","ab5","a5","bb5","b5","c6","db6","d6","eb6","e6","f6","gb6","g6","ab6","a6","bb6","b6","c7","db7","d7","eb7","e7","f7","gb7","g7","ab7","a7","bb7","b7","c8"];PS.Piano=function(d,a){var b,c;b="[PS.Piano] ";if(typeof d!=="number"){return PS.Oops(b+"Parameter is not a number");}d=Math.floor(d);if(d<1){d=1;}else{if(d>88){d=88;}}c="piano_"+PS.PianoFiles[d-1];if(a){c="l_"+c;}return c;};PS.HchordFiles=["a2","bb2","b2","c3","db3","d3","eb3","e3","f3","gb3","g3","ab3","a3","bb3","b3","c4","db4","d4","eb4","e4","f4","gb4","g4","ab4","a4","bb4","b4","c5","db5","d5","eb5","e5","f5","gb5","g5","ab5","a5","bb5","b5","c6","db6","d6","eb6","e6","f6","gb6","g6","ab6","a6","bb6","b6","c7","db7","d7","eb7","e7","f7"];PS.Harpsichord=function(d,a){var b,c;b="[PS.Harpsichord] ";if(typeof d!=="number"){return PS.Oops(b+"Parameter is not a number");}d=Math.floor(d);if(d<1){d=1;}else{if(d>57){d=57;}}c="hchord_"+PS.HchordFiles[d-1];if(a){c="l_"+c;}return c;};PS.XyloFiles=["a4","bb4","b4","c5","db5","d5","eb5","e5","f5","gb5","g5","ab5","a5","bb5","b5","c6","db6","d6","eb6","e6","f6","gb6","g6","ab6","a6","bb6","b6","c7","db7","d7","eb7","e7","f7","gb7","g7","ab7","a7","bb7","b7"];PS.Xylophone=function(c){var a,b;a="[PS.Xylophone] ";if(typeof c!=="number"){return PS.Oops(a+"Parameter is not a number");}c=Math.floor(c);if(c<1){c=1;}else{if(c>39){c=39;}}b="xylo_"+PS.XyloFiles[c-1];return b;};PS.ImageLoad=function(b,e){var c,a;c="[PS.ImageLoad] ";if(typeof b!=="string"){return PS.Oops(c+"Parameter 1 is not a string");}if(b.length<1){return PS.Oops(c+"Parameter 1 is an empty string");}if((e!==undefined)&&(typeof e!=="function")){return PS.Oops(c+"Parameter 2 is not a function");}try{a=new Image();if(e!==undefined){a.onload=e;}a.src=b;return a;}catch(d){return PS.Oops(c+"failed ["+d.message+"]");}};PS.ImageData=function(k,e){var o,p,l,r,c,q,g,f,m,b,a;o="[PS.ImageMap] ";if((e===undefined)||(e===PS.DEFAULT)||!e){e=false;}else{e=true;}p=k.width;if((typeof p!=="number")||(p<0)){return PS.Oops(o+"Invalid width parameter");}p=Math.floor(p);if(p>PS.GRID_MAX){p=PS.GRID_MAX;}l=k.height;if((typeof l!=="number")||(l<0)){return PS.Oops(o+"Invalid height parameter");}l=Math.floor(l);if(l>PS.GRID_MAX){l=PS.GRID_MAX;}try{r=PS.ImageCanvas.getContext("2d");r.drawImage(k,0,0);}catch(d){return PS.Oops(o+"failed @ 1 ["+d.message+"]");}try{c=r.getImageData(0,0,p,l);}catch(n){return PS.Oops(o+"failed @ 2 ["+n.message+"]");}q={};q.width=c.width;q.height=c.height;b=c.data;m=b.length;a=[];g=0;f=0;if(!e){a.length=(m/4)*3;while(g<m){a[f]=b[g];g+=1;f+=1;a[f]=b[g];g+=1;f+=1;a[f]=b[g];g+=2;f+=1;}q.pixelSize=3;}else{a.length=m;while(g<m){a[f]=b[g];g+=1;f+=1;a[f]=b[g];g+=1;f+=1;a[f]=b[g];g+=1;f+=1;a[f]=b[g];g+=1;f+=1;}q.pixelSize=4;}q.data=a;return q;};PS.ImageBlit=function(x,e,n){var q,v,u,s,B,l,c,m,f,A,z,t,C,D,E,d,F,o,y,p;q="[PS.ImageBlit] ";if(typeof x!=="object"){return PS.Oops(q+"parameter 1 is not a table");}u=x.data;s=x.width;if(typeof s!=="number"){return PS.Oops(q+"imgdata.width is not a number");}s=Math.floor(s);if(s<1){return PS.Oops(q+"imgdata.width < 1");}B=x.height;if(typeof B!=="number"){return PS.Oops(q+"imgdata.height is not a number");}B=Math.floor(B);if(B<1){return PS.Oops(q+"imgdata.height < 1");}l=x.pixelSize;if(typeof l!=="number"){return PS.Oops(q+"imgdata.pixelSize is not a number");}l=Math.floor(l);if(l===1){E=PS.DEFAULT_ALPHA;}else{if((l!==3)&&(l!==4)){return PS.Oops(q+"invalid pixelSize");}}v=s*B*l;if(u.length!==v){return PS.Oops(q+"invalid data length ["+x.data.length+"]");}if((e===undefined)||(e===PS.DEFAULT)){e=0;}else{if(typeof e!=="number"){return PS.Oops(q+"parameter 2 is not a number");}e=Math.floor(e);if((e>=PS.Grid.x)||((e+s)<1)){return true;}}if((n===undefined)||(n===PS.DEFAULT)){n=0;}else{if(typeof n!=="number"){return PS.Oops(q+"parameter 3 is not a number");}n=Math.floor(n);if((n>=PS.Grid.y)||((n+B)<1)){return true;}}c=0;f=n;for(z=0;z<B;z+=1){m=e;if(f>=PS.Grid.y){break;}if(f>=0){for(A=0;A<s;A+=1){if((m>=0)&&(m<PS.Grid.x)){if(l===1){d=u[c];if(typeof d!=="number"){return PS.Oops(q+"non-numeric rgb at position "+c);}d=Math.floor(d);if(d<1){d=0;}else{if(d>16777215){d=16777215;}}t=d/PS.REDSHIFT;t=Math.floor(t);F=t*PS.REDSHIFT;C=(d-F)/PS.GREENSHIFT;C=Math.floor(C);o=C*PS.GREENSHIFT;D=d-F-o;}else{t=u[c];if(typeof t!=="number"){return PS.Oops(q+"non-numeric red at position "+c);}t=Math.floor(t);if(t<1){t=0;}else{if(t>255){t=255;}}C=u[c+1];if(typeof C!=="number"){return PS.Oops(q+"non-numeric green at position "+c);}C=Math.floor(C);if(C<1){C=0;}else{if(C>255){C=255;}}D=u[c+2];if(typeof D!=="number"){return PS.Oops(q+"non-numeric blue at position "+c);}D=Math.floor(D);if(D<1){D=0;}else{if(D>255){D=255;}}if(l===4){E=u[c+3];if(typeof E!=="number"){return PS.Oops(q+"non-numeric alpha at position "+c);}E=Math.floor(E/2.55);if(E<1){E=0;}else{if(E>PS.DEFAULT_ALPHA){E=PS.DEFAULT_ALPHA;}}}else{E=PS.DEFAULT_ALPHA;}}y=m+(f*PS.Grid.x);p=PS.Grid.beads[y];p.empty=false;if(E<PS.DEFAULT_ALPHA){p.alphaRed=PS.Dissolve(PS.Grid.bgRed,p.alphaRed,E);p.alphaGreen=PS.Dissolve(PS.Grid.bgGreen,p.alphaGreen,E);p.alphaBlue=PS.Dissolve(PS.Grid.bgBlue,p.alphaBlue,E);p.color=PS.RGBString(p.alphaRed,p.alphaGreen,p.alphaBlue);}else{p.alphaRed=t;p.alphaGreen=C;p.alphaBlue=D;p.color=PS.RGBString(t,C,D);}p.red=t;p.green=C;p.blue=D;if(p.visible){p.flashPhase=100;p.colorNow=p.color;PS.DrawBead(p);}}c+=l;m+=1;}}else{c+=(s*l);}f+=1;}return true;};PS.AudioError=function(a){var d,b;d=a.error.code;switch(d){case 1:b="MEDIA_ERR_ABORTED";break;case 2:b="MEDIA_ERR_NETWORK";break;case 3:b="MEDIA_ERR_DECODE";break;case 4:b="MEDIA_ERR_SRC_NOT_SUPPORTED";break;default:b="UNKNOWN";break;}PS.Oops("[HTML5 audio error: "+b+"]\n");};PS.AudioLoaded=function(c){var a,b;a=this.getAttribute("data-channel");b=PS.AudioChannels[a];b.status=PS.CHANNEL_READY;if(b.playNow){b.playNow=false;PS.PlayHTML5Audio(a);}};PS.AudioEnding=function(e){var a,d,c;a=this.getAttribute("data-channel");d=PS.AudioChannels[a];d.status=PS.CHANNEL_READY;c=d.exec;if(c&&(typeof c==="function")){try{d.exec=null;c();}catch(b){PS.Oops("Audio function error ["+b.message+"]");}}};PS.AudioInit=function(){var d,c,a;d="[PS.AudioInit] ";if(!document.createElement("audio").canPlayType){PS.Oops(d+"HTML5 audio not supported");return false;}PS.AudioContext=null;if(PS.HTML5_AUDIO===undefined){try{PS.AudioContext=new webkitAudioContext();}catch(e){try{PS.AudioContext=new AudioContext();}catch(b){PS.AudioContext=null;}}}PS.AudioCurrentPath=PS.AUDIO_PATH_DEFAULT;if(!PS.AudioContext){PS.AudioChannels.length=PS.AUDIO_MAX_CHANNELS;for(c=0;c<PS.AUDIO_MAX_CHANNELS;c+=1){a=document.createElement("audio");if(!a){return PS.Oops(d+"Audio element init failed");}a.setAttribute("data-channel",c);a.setAttribute("onerror",PS.AudioError);a.addEventListener("canplaythrough",PS.AudioLoaded);a.addEventListener("ended",PS.AudioEnding);a.setAttribute("preload","auto");document.body.appendChild(a);PS.AudioChannels[c]={id:"",audio:a,volume:PS.DEFAULT_VOLUME,playNow:false,exec:null,status:PS.CHANNEL_EMPTY};}}else{PS.AudioID=0;PS.ChromeChannels.length=0;PS.ChromeBuffers.length=0;PS.ChromeBufferCnt=0;PS.ChromeChannelCnt=0;}return true;};PS.AudioPath=function(b){var a;a="[PS.AudioPath] ";if(b===PS.DEFAULT){PS.AudioCurrentPath=b=PS.AUDIO_PATH_DEFAULT;}else{if((typeof b!=="string")||(b.length<1)){b=PS.Oops(a+"path parameter is not a valid string");}else{PS.AudioCurrentPath=b;}}return b;};PS.AudioLoad=function(e,d){var b,c,a;b="[PS.AudioLoad] ";if((typeof e!=="string")||(e.length<1)){return PS.Oops(b+"ID parameter not a valid string");}if(d===undefined){d=PS.AudioCurrentPath;}else{if(d===PS.DEFAULT){d=PS.AUDIO_PATH_DEFAULT;}else{if((typeof d!=="string")||(d.length<1)){return PS.Oops(b+"Path parameter not a valid string");}}}if(!PS.AudioContext){c=d+e+".wav";a=PS.LoadHTML5Audio(c);if(a===PS.ERROR){return a;}return true;}c=d+e+".wav";return PS.LoadChromeAudio(c);};PS.AudioPlay=function(a,d,b,k){var g,c,f,e,j,h;g="[PS.AudioPlay] ";if((d===undefined)||(d===PS.DEFAULT)){d=PS.DEFAULT_VOLUME;}else{if(typeof d!=="number"){return PS.Oops(g+"Volume parameter not a number");}if(d<0){d=0;}else{if(d>PS.MAX_VOLUME){d=PS.MAX_VOLUME;}}}if(b===PS.DEFAULT){b=null;}else{if((b!==undefined)&&(typeof b!=="function")){return PS.Oops(g+"Func parameter not a valid function");}}if(k===undefined){k=PS.AudioCurrentPath;}else{if(k===PS.DEFAULT){k=PS.AUDIO_PATH_DEFAULT;}else{if((typeof k!=="string")||(k.length<1)){return PS.Oops(g+"Path parameter not a valid string");}}}if(!PS.AudioContext){j=k+a+".wav";for(c=0;c<PS.AUDIO_MAX_CHANNELS;c+=1){f=PS.AudioChannels[c];if((f.id===j)&&(f.status===PS.CHANNEL_READY)){return PS.PlayHTML5Audio(c,d,b);}}c=PS.LoadHTML5Audio(j,d,b,true);if(c===PS.ERROR){return c;}return c+1;}j=k+a+".wav";e=PS.ChromeBuffers.length;c=0;while(c<e){h=PS.ChromeBuffers[c];if(h.path===j){f=PS.PlayChromeAudio(j,h.buffer,d,b);return f;}c+=1;}PS.AudioID+=1;f=PS.AudioID;PS.LoadChromeAudio(j,d,b,f);return f;};PS.AudioStop=function(k){var f,j,e,h,a,b;f="[PS.AudioStop] ";if(typeof k!=="number"){return PS.Oops(f+"Parameter is not a number");}k=Math.floor(k);if(!PS.AudioContext){if((k<1)||(k>PS.AUDIO_MAX_CHANNELS)){return PS.Oops(f+"Invalid channel id");}h=PS.AudioChannels[k-1];h.audio.pause();h.audio.currentTime=0;h.status=PS.CHANNEL_READY;}else{a=PS.ChromeChannels.length;b=0;while(b<a){h=PS.ChromeChannels[b];if(h.id===k){if(h.source&&(h.source.playbackState!==PS.CHROME_FINISHED_STATE)){if(h.timeoutHandle){window.clearTimeout(h.timeoutHandle);h.timeoutHandle=null;}try{h.source.stop(0);}catch(g){h.source.noteOff(0);}}PS.ChromeChannels.splice(b,1);PS.ChromeChannelCnt-=1;break;}b+=1;}}return k;};PS.AudioPause=function(l){var m,j,e,h,f,n,d,g,a,k;m="[PS.AudioPause] ";if(typeof l!=="number"){return PS.Oops(m+"Parameter is not a number");}l=Math.floor(l);if(!PS.AudioContext){if((l<1)||(l>PS.AUDIO_MAX_CHANNELS)){return PS.Oops(m+"Invalid channel id ["+l+"]");}j=PS.AudioChannels[l-1];e=j.audio;if(e.paused){PS.PlayHTML5Audio(l-1);}else{j.status=PS.CHANNEL_PAUSED;e.pause();}return l;}h=PS.ChromeChannels.length;f=0;while(f<h){j=PS.ChromeChannels[f];if(j.id===l){k=j.pauseTime;if(k>0){n=j.fullpath;d=j.buffer;g=j.volume;a=j.exec;PS.ChromeChannels.splice(f,1);PS.PlayChromeAudio(n,d,g,a,l,k);}else{if(j.source&&(j.source.playbackState!==PS.CHROME_FINISHED_STATE)){if(j.timeoutHandle){window.clearTimeout(j.timeoutHandle);j.timeoutHandle=null;}k=PS.AudioContext.currentTime-j.startTime;k=k%j.buffer.duration;j.pauseTime=k;j.status=PS.CHANNEL_PAUSED;try{j.source.stop(0);}catch(b){j.source.noteOff(0);}}else{PS.ChromeChannels.splice(f,1);l=PS.ERROR;}}break;}f+=1;}return l;};PS.LoadHTML5Audio=function(h,g,f,b){var d,a,e,c;d="[PS.LoadHTML5Audio] ";for(c=0;c<PS.AUDIO_MAX_CHANNELS;c+=1){e=PS.AudioChannels[c];if((e.id===h)&&(e.status===PS.CHANNEL_READY)){e.audio.currentTime=0;if(g!==undefined){e.volume=g;}if(f!==undefined){e.exec=f;}if(b){PS.PlayHTML5Audio(c);}return c;}}for(c=0;c<PS.AUDIO_MAX_CHANNELS;c+=1){e=PS.AudioChannels[c];if((e.status===PS.CHANNEL_EMPTY)||(e.status===PS.CHANNEL_READY)){e.id=h;e.audio.setAttribute("src",h);e.status=PS.CHANNEL_LOADING;if(g!==undefined){e.volume=g;}if(f!==undefined){e.exec=f;}if(b){e.playNow=true;}e.audio.load();return c;}}return PS.ERROR;};PS.PlayHTML5Audio=function(a,d,c){var b;b=PS.AudioChannels[a];if(d===undefined){d=b.volume;}else{b.volume=d;}b.audio.volume=d;if(c!==undefined){b.exec=c;}b.status=PS.CHANNEL_PLAYING;b.audio.play();return a+1;};PS.LoadChromeAudio=function(k,e,b,g,a){var h,f,d,j,c;h="[PS.LoadChromeAudio] ";f=PS.ChromeBuffers.length;d=0;while(d<f){j=PS.ChromeBuffers[d];if(j.path===k){return true;}d+=1;}c=new XMLHttpRequest();if(!c){return PS.Oops(h+"XMLHttpRequest error");}c.open("GET",k,true);c.responseType="arraybuffer";c.onload=function(){PS.AudioContext.decodeAudioData(c.response,function(i){PS.ChromeBuffers.push({path:k,buffer:i});PS.ChromeBufferCnt+=1;if(e){PS.PlayChromeAudio(k,i,e,b,g,a);}},function(){PS.Oops(h+"Error loading "+k+"]");});};c.send();return true;};PS.ChromeEnding=function(f){var a,c,g,e;a=PS.ChromeChannels.length;c=0;while(c<a){g=PS.ChromeChannels[c];if(g.id===f){e=g.exec;if(f.source&&(f.source.playbackState!==PS.CHROME_FINISHED_STATE)){PS.Debug("Channel not done!\n");try{f.source.stop(0);}catch(d){f.source.noteOff(0);}}if(e&&(typeof e==="function")){try{e();}catch(b){PS.Opps("Audio end function error ["+b.message+"]");}}PS.ChromeChannels.splice(c,1);PS.ChromeChannelCnt-=1;break;}c+=1;}};PS.PlayChromeAudio=function(n,f,h,c,j,b){var l,a,g,m,e,k;l="[PS.PlayChromeAudio] ";a=PS.AudioContext.createBufferSource();if(!a){return PS.Oops(l+"Invalid bufferSource");}a.buffer=f;try{g=PS.AudioContext.createGain();}catch(d){g=PS.AudioContext.createGainNode();}if(!g){return PS.Oops(l+"Invalid gainNode");}a.connect(g);g.connect(PS.AudioContext.destination);if(h===undefined){h=PS.DEFAULT_VOLUME;}g.gain.value=h;if(j===undefined){PS.AudioID+=1;j=PS.AudioID;}if(b===undefined){b=0;}e=f.duration-b;k=Math.floor(e*1000);k+=25;m={id:j,path:n,buffer:f,source:a,volume:h,gainNode:g,startTime:PS.AudioContext.currentTime-b,pauseTime:0,status:PS.CHANNEL_PLAYING,exec:c,timeoutHandle:window.setTimeout(PS.ChromeEnding,k,j)};PS.ChromeChannels.push(m);PS.ChromeChannelCnt+=1;try{a.start(0,b,e);}catch(i){a.noteGrainOn(0,b,e);}return j;};(function(){var b,d,a,c;b=0;d=["ms","moz","webkit","o"];for(a=0;a<d.length&&!window.requestAnimationFrame;a+=1){c=d[a];window.requestAnimationFrame=window[c+"RequestAnimationFrame"];window.cancelAnimationFrame=window[c+"CancelAnimationFrame"]||window[c+"CancelRequestAnimationFrame"];}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(i,f){var e,g,h;e=new Date().getTime();g=Math.max(0,16-(e-b));h=window.setTimeout(function(){i(e+g);},g);b=e+g;return h;};}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(e){window.clearTimeout(e);};}}());
