/*! Perlenspiel 3.1.6 2014-05-30 */
var Perlenspiel,PS={};!function(){"use strict";function a(a){a.ALL="PS.ALL",a.CURRENT="PS.CURRENT",a.DONE="PS.DONE",a.DEFAULT="PS.DEFAULT",a.ERROR="PS.ERROR",a.EMPTY="PS.EMPTY",a.UNEQUAL="PS.UNEQUAL",a.GRID="PS.GRID",a.HTML5_AUDIO="PS.HTML5_AUDIO",a.WEB_AUDIO="PS.WEB_AUDIO",a.SPRITE_TOUCH="PS.SPRITE_TOUCH",a.SPRITE_OVERLAP="PS.SPRITE_OVERLAP",a.COLOR_BLACK=0,a.COLOR_WHITE=16777215,a.COLOR_GRAY_LIGHT=12632256,a.COLOR_GRAY=8421504,a.COLOR_GRAY_DARK=4210752,a.COLOR_RED=16711680,a.COLOR_ORANGE=16744448,a.COLOR_YELLOW=16776960,a.COLOR_GREEN=65280,a.COLOR_BLUE=255,a.COLOR_INDIGO=4194559,a.COLOR_VIOLET=8388863,a.COLOR_MAGENTA=16711935,a.COLOR_CYAN=65535,a.ALPHA_OPAQUE=255,a.ALPHA_TRANSPARENT=0,a.KEY_ENTER=13,a.KEY_TAB=9,a.KEY_ESCAPE=27,a.KEY_PAGE_UP=1001,a.KEY_PAGE_DOWN=1002,a.KEY_END=1003,a.KEY_HOME=1004,a.KEY_ARROW_LEFT=1005,a.KEY_ARROW_UP=1006,a.KEY_ARROW_RIGHT=1007,a.KEY_ARROW_DOWN=1008,a.KEY_INSERT=1009,a.KEY_DELETE=1010,a.KEY_PAD_0=96,a.KEY_PAD_1=97,a.KEY_PAD_2=98,a.KEY_PAD_3=99,a.KEY_PAD_4=100,a.KEY_PAD_5=101,a.KEY_PAD_6=102,a.KEY_PAD_7=103,a.KEY_PAD_8=104,a.KEY_PAD_9=105,a.KEY_F1=112,a.KEY_F2=113,a.KEY_F3=114,a.KEY_F4=115,a.KEY_F5=116,a.KEY_F6=117,a.KEY_F7=118,a.KEY_F8=119,a.KEY_F9=120,a.KEY_F10=121,a.WHEEL_FORWARD="PS.WHEEL_FORWARD",a.WHEEL_BACKWARD="PS.WHEEL_BACKWARD",a.FINDER_ASTAR="PS.FINDER_ASTAR",a.FINDER_BREADTH_FIRST="PS.FINDER_BREADTH_FIRST",a.FINDER_BEST_FIRST="PS.FINDER_BEST_FIRST",a.FINDER_DIJKSTRA="PS.FINDER_DIJKSTRA",a.FINDER_BI_ASTAR="PS.FINDER_BI_ASTAR",a.FINDER_BI_BEST_FIRST="PS.FINDER_BI_BEST_FIRST",a.FINDER_BI_DIJKSTRA="PS.FINDER_BI_DIJKSTRA",a.FINDER_BI_BREADTH_FIRST="PS.FINDER_BI_BREADTH_FIRST",a.FINDER_JUMP_POINT="PS.FINDER_JUMP_POINT",a.DEFAULT_NAMESPACE="game"}a(PS),Perlenspiel={Start:function(b){function c(){ce>=0?ce-=1:(de-=.05,0>=de&&(tc.timerStop(be),be=null,de=0),cd.style.opacity=de)}function d(a){var b;return b=typeof a,"number"===b?isNaN(a)&&(b="NaN"):"object"===b&&(a?a instanceof Array&&(b="array"):b="null"),b}function e(a,b,c,e){var f,g;return f=a,f!==!0&&f!==!1&&(null===f?f=!1:f===PS.CURRENT?f=b:f===PS.DEFAULT?f=c:(g=d(f),f="undefined"===g?e:"number"===g?0!==f:PS.ERROR)),f}function f(a,b){var c,e,g,h;for(c in a)a.hasOwnProperty(c)&&(e=a[c],h=d(e),"object"===h&&(g={},f(e,g),e=g),b[c]=e)}function g(a){return a.stopPropagation?a.stopPropagation():a.cancelBubble=!0,a.preventDefault(),!1}function h(){var a,b,c,d,e;for(a=[],b=0;b<arguments.length;b+=1)c=arguments[b],d=c-65536,e=c>65535?[55296+(d>>10),56320+(1023&d)]:[c],a.push(String.fromCharCode.apply(null,e));return a.join("")}function i(a,b,c,d,e,f){var g,h,i,j,k,l,m,n,o,p;return g=yc.context,h=yc.bead_size,i=a.left,j=a.top,k=h,l=h,a.visible?(n=a.size<h,o=a.radius,(n||o>0)&&(a.bgColor.a<255&&(g.fillStyle=f,g.fillRect(i,j,k,l)),a.bgColor.a>0&&(g.fillStyle=e,g.fillRect(i,j,k,l)),n&&(i+=a.margin,j+=a.margin,k=a.size,l=a.size)),m=a.border,m.width>0&&(m.color.a<255&&(g.fillStyle=f,g.fillRect(i,j,k,l)),m.color.a>0&&(g.fillStyle=b,0===o?g.fillRect(i,j,k,l):(p=Math.floor(k*o/100),p=g.fillRoundedRect(i,j,k,l,p))),i+=m.left,j+=m.top,k-=m.left+m.right,l-=m.top+m.bottom),g.fillStyle=c,0===o?g.fillRect(i,j,k,l):(p=Math.floor(k*o/100),g.fillRoundedRect(i,j,k,l,p)),void(a.glyph.code>0&&a.glyph.color.a>0&&(yc.context.font=a.glyph.font,g.fillStyle=d,g.fillText(a.glyph.str,a.left+a.glyph.x,a.top+a.glyph.y)))):(g.fillStyle=f,void g.fillRect(i,j,k,l))}function j(a,b){var c,d;return c=a.a*(1-b.a),d={r:Math.floor(b.r*b.a+a.r*c),g:Math.floor(b.g*b.a+a.g*c),b:Math.floor(b.b*b.a+a.b*c)}}function k(a,b,c){var d,e,f,g,h,i,k,l,m,n,o,p,q,r,s,t;for(d=b.r,e=b.g,f=b.b,g=a.planes,h=g.length,i=0;h>i;i+=1)l=g[i],k=l.color,m=k.r,n=k.g,o=k.b,p=k.a,p>0&&(255>p?(q=Math.max(0,Math.min(p/255,1)),r={r:d,g:e,b:f,a:1},s={r:m,g:n,b:o,a:q},t=j(r,s),d=t.r,e=t.g,f=t.b):(d=m,e=n,f=o));m=d,n=e,o=f,c.rgb=m*Kd+n*Ld+o,c.r=m,c.g=n,c.b=o,c.str=uc[m]+vc[n]+wc[o]}function l(a){var b,c,d,e,f,g,h,j;b=a.str,c=yc.canvas,c.style.backgroundColor=b,gd===PS.DEFAULT_NAMESPACE&&(document.body.style.backgroundColor=b);var l=document.getElementById(sd);for(l.style.backgroundColor=b,Ac.statusP.style.backgroundColor=b,Ac.inputP.style.backgroundColor=b,cd.style.backgroundColor=b,d=0;d<yc.count;d+=1)e=zc[d],f=e.planes[0],g=f.color,g.a<255?(k(e,a,ee),h=ee.str):h=e.color.str,j=e.border.color,(!e.visible||e.size<yc.bead_size||e.radius>0||g.a<255||j.a<255)&&i(e,j.str,h,e.glyph.color.str,e.bgColor.str,b)}function m(a){var b,c,d;b=a.r>127?0:255,c=a.g>127?0:255,d=a.b>127?0:255,cd.style.color=uc[b]+vc[c]+wc[d]}function n(a){yc.canvas.style.boxShadow=yc.shadow.params+a.str}function o(a){Ac.statusP.style.color=a.str,Ac.inputP.style.color=a.str}function p(a,b){var c;c=zc[b],i(c,c.border.color.str,a.str,c.glyph.color.str,c.bgColor.str,yc.color.str)}function q(a,b){var c;c=zc[b],i(c,a.str,c.color.str,c.glyph.color.str,c.bgColor.str,yc.color.str)}function r(a,b){var c;c=zc[b],i(c,c.border.color.str,c.color.str,a.str,c.bgColor.str,yc.color.str)}function s(a){a.dirty=!0,_d=!0}function t(){var a,b,c;if(_d){for(a=yc.count,b=0;a>b;b+=1)c=zc[b],c.dirty&&(c.dirty=!1,i(c,c.border.color.str,c.color.str,c.glyph.color.str,c.bgColor.str,yc.color.str));_d=!1}}function u(){var a;ad||(a=document.getElementById(vd),a.style.display="inline",a=document.getElementById(Dd),a.value="",ad=!0,bd=!1)}function v(a){("string"!=typeof a||a.length<1)&&(a="???"),tc.debug("WARNING: "+a+"\n")}function w(a){var b,c,d;return b="",-1!==a.search(".js")?(c=a.lastIndexOf("/")+1,d=a.substr(c).replace(/^[\s\(\)]+|[\s\(\)]+$/g,""),3===d.split(":").length&&(d=d.substr(0,d.lastIndexOf(":"))),""!==d&&(b+="    "+d+"\n")):ge&&-1!==a.search(".htm")&&(b+="\n"+a),b}function x(a){var b,c,d,e;if(console&&console.log&&console.log(a),!a.split)return a;for(b=a.split("\n"),e="",c=b.length,d=0;c>d;d+=1)e+=w(b[d]);return e}function y(a,b){var c;return Gc=!1,be&&tc.timerStop(be),("string"!=typeof a||a.length<1)&&(a="???"),c="ERROR: "+a+"\n",cd.style.opacity=1,cd.innerHTML=c,fe&&b&&(c+=x(b.stack)+"\n"),tc.debug(c),dd&&tc.audioPlay(Xd.audio.error_sound,{path:Xd.audio.path}),PS.ERROR}function z(a){try{throw new Error("!")}catch(b){return y(a,b)}}function A(){var a;a=document.getElementById(td),a.scrollTop=a.scrollHeight}function B(){Jc=[],Kc=0}function C(a){f(Xd.fader,a),a.frames.length=0}function D(a,b,c){var d;return d={element:a,exec:b,execEnd:c,frames:[]},C(d),d}function E(a,b,c,d,e,f,g,h,i){var j,k,l,m,n,o,p,q,r,s,t,u,v,w;if(a.step=0,a.frames.length=0,b!==f||c!==g||d!==h||e!==i){a.tr=f,a.tg=g,a.tb=h,a.ta=i,a.trgb=f*Kd+g*Ld+h,a.tstr=uc[f]+vc[g]+vc[h]+xc[i],j=b,k=c,l=d,m=e,r=b>f?-(b-f):f-b,s=c>g?-(c-g):g-c,t=d>h?-(d-h):h-d,u=e>i?-(e-i):i-e,n=a.rate<Rd?1:Math.ceil(a.rate/Rd),o=100/n,p=0;do if(v=!1,q={},p+=o,p>=100?(q.r=f,q.g=g,q.b=h,q.a=i):(j!==f&&(w=p*r/100,j=b+w,j=Math.round(j),v=!0),q.r=j,k!==g&&(w=p*s/100,k=c+w,k=Math.round(k),v=!0),q.g=k,l!==h&&(w=p*t/100,l=d+w,l=Math.round(l),v=!0),q.b=l,m!==i&&(w=p*u/100,m=e+w,m=Math.round(m),v=!0),q.a=m),q.rgb=q.r*Kd+q.g*Ld+q.b,q.str=uc[q.r]+vc[q.g]+vc[q.b]+xc[q.a],a.frames.push(q),!v)return;while(100>p)}}function F(a,b,c,d,e,f,g,h,i){E(a,b,c,d,e,f,g,h,i),a.frames.length>0&&(a.kill=!1,a.active=!0,Jc.push(a))}function G(a,b,c,d,e){var f,g,h,i;f=a.active,a.active=!1,g=a.frames.length,g>0&&(h=a.step,h>=g&&(h=g-1),i=a.frames[h],E(a,i.r,i.g,i.b,i.a,b,c,d,e)),a.frames.length>0&&(a.active=f)}function H(){Hc=[],Ic=0}function I(){var a,b,c,d,e,f,g,h,i,j,k,l,m;if(a="[_tick] ",b=!1,Kc+=1,Kc>=Rd)for(Kc=0,c=Jc.length,d=0;c>d;)if(e=Jc[d],g=e.frames.length,e.kill)Jc.splice(d,1),c-=1;else if(e.active){if(f=e.frames[e.step],k=e.onStep){m=[g,e.step,f.rgb],e.params&&(m=m.concat(e.params));try{j=k.apply(Nd,m),(j===!1||null===j)&&(e.step=g-1,f=e.frames[e.step]),b=!0}catch(n){return void y(a+"fader .onStep failed ["+n.message+"]",n)}}if(e.exec)try{e.exec(f,e.element)}catch(o){return void y(a+"fader .exec failed ["+o.message+"]",o)}if(e.step+=1,e.step>=g){if(e.active=!1,e.step=0,e.frames.length=0,e.execEnd)try{e.execEnd(f,e.element)}catch(p){return void y(a+"fader .execEnd failed ["+p.message+"]",p)}if(k=e.onEnd){m=e.params,m||(m=[]);try{k.apply(Nd,m),b=!0}catch(q){return void y(a+"fader .onEnd failed ["+q.message+"]",q)}}Jc.splice(d,1),c-=1}else d+=1}else d+=1;if(c=Qc.length,Tc&&c>0)if(Uc>0)Uc-=1;else for(Uc=Vc,d=0;c>d;d+=1)if(h=Qc[d])try{PS.keyDown(h,Rc,Sc),b=!0}catch(r){return void y(a+"Key repeat failed ["+r.message+"]",r)}if(c=Hc.length,c>0)for(d=0;c>d;){if(i=Hc[d],l=i.id,i.count-=1,i.count<1){i.count=i.delay;try{j=i.exec.apply(Nd,i.arglist),b=!0}catch(s){j=y(a+"Timed function failed ["+s.message+"]",s)}j===PS.ERROR&&tc.timerStop(l),c=Hc.length}i=Hc[d],i&&i.id===l&&(d+=1)}b&&t()}function J(a){var b,c,d,e,f,g,h,i,j;k(a,yc.color,he),b=he.rgb,c=a.color,d=he.r,e=he.g,f=he.b,g=c.r,h=c.g,i=c.b,c.rgb=b,c.r=d,c.g=e,c.b=f,c.str=he.str,a.visible&&(j=a.fader,j.rate>0?null!==j.rgb?F(j,j.r,j.g,j.b,255,d,e,f,255):j.active?G(j,d,e,f,255):F(j,g,h,i,255,d,e,f,255):s(a))}function K(a,b,c,e,f){var g,h,i,j;if(g=c,g!==PS.CURRENT&&g!==PS.DEFAULT)if(j=d(g),"undefined"===j)g=PS.CURRENT;else{if("number"!==j)return z(a+"red value invalid");g=Math.floor(g),0>g?g=0:g>255&&(g=255)}if(h=e,h!==PS.CURRENT&&h!==PS.DEFAULT)if(j=d(h),"undefined"===j)h=PS.CURRENT;else{if("number"!==j)return z(a+"green value invalid");h=Math.floor(h),0>h?h=0:h>255&&(h=255)}if(i=f,i!==PS.CURRENT&&i!==PS.DEFAULT)if(j=d(i),"undefined"===j)i=PS.CURRENT;else{if("number"!==j)return z(a+"blue value invalid");i=Math.floor(i),0>i?i=0:i>255&&(i=255)}return b.rgb=null,b.r=g,b.g=h,b.b=i,PS.DONE}function L(a,b){var c,d,e,f,g,h;c=Math.floor(b),1>c?c=d=f=h=0:c>=16777215?(c=16777215,d=f=h=255):(d=c/Kd,d=Math.floor(d),e=d*Kd,f=(c-e)/Ld,f=Math.floor(f),g=f*Ld,h=c-e-g),a.rgb=c,a.r=d,a.g=f,a.b=h}function M(a,b,c,e){var f,g,h,i,j;if(f=ie,f.rgb=0,f.r=null,f.g=null,f.b=null,f.str="",g=d(b),void 0!==b&&void 0!==c&&void 0===e)return z(a+"color arguments invalid");if(void 0!==c||void 0!==e){if("number"!==g&&"undefined"!==g&&b!==PS.CURRENT&&b!==PS.DEFAULT)return z("array"===g?a+"Extraneous arguments after color array":"object"===g?a+"Extraneous arguments after color object":a+"red argument invalid");if(h=K(a,f,b,c,e),h===PS.ERROR)return PS.ERROR}else if("number"===g)L(f,b);else if("array"===g){if(j=b.length,1>j)f.rgb=PS.CURRENT;else if(h=K(a,f,b[0],b[1],b[2]),h===PS.ERROR)return PS.ERROR}else if("object"===g){if(i=b.rgb,null==i&&void 0==b.r&&void 0==b.g&&void 0==b.b)return PS.ERROR;if(g=d(i),"undefined"===g||null===i){if(h=K(a,f,b.r,b.g,b.b),h===PS.ERROR)return PS.ERROR}else if("number"===g)L(f,i);else{if(i!==PS.CURRENT&&i!==PS.DEFAULT)return z(a+".rgb property invalid");f.rgb=i}}else if("undefined"===g||b===PS.CURRENT)f.rgb=PS.CURRENT;else{if(b!==PS.DEFAULT)return z(a+"color argument invalid");f.rgb=PS.DEFAULT}return f}function N(a){var b,c,d,e;b=yc.bead_size,a.glyph.x=Math.round(b/2),d=a.glyph.scale,c=100>d?Math.round(b*d/100):b,a.glyph.size=e=Math.round(c/2),a.glyph.font=e+"px 'Droid'",a.glyph.y=Math.round((b-e)/2+e/2)}function O(a){var b;f(Xd.bead,a),b={},f(Xd.bead.color,b),a.planes=[{height:0,color:b}],N(a),C(a.fader),C(a.borderFader),C(a.glyphFader)}function P(a,b){var c,d,e,f,g,h;if(c=a.planes,1>b)return d=c[0],d.color;for(e=c.length,f=1;e>f;f+=1)if(d=c[f],d.height===b)return d.color;if(h=Xd.bead.color,g={rgb:h.rgb,r:h.r,g:h.g,b:h.b,a:0},a.active){for(f=0;e>f&&(d=c[f],!(d.height>b));)f+=1;c.splice(f,0,{height:b,color:g})}return g}function Q(a){return a.glyph.code>0?a.border.gmax:a.border.max}function R(a,b){a.border.equal=!0,a.border.width=b,a.border.top=b,a.border.left=b,a.border.bottom=b,a.border.right=b}function S(a){var b,c,d,e,f,g,h;b=yc.bead_size,a.scale<100?(c=Math.floor(b*a.scale/100),d=b-c,d>0&&d%2&&(c+=1)):(c=b,a.margin=0,a.senseLeft=a.left,a.senseRight=a.right,a.senseTop=a.top,a.senseBottom=a.bottom),a.size=c,c!==b&&(a.margin=e=Math.floor((b-c)/2),a.senseLeft=a.left+e,a.senseRight=a.right-e,a.senseTop=a.top+e,a.senseBottom=a.bottom-e),h=a.border,h.max=Math.floor((c-8)/2),h.gmax=Math.floor((c-a.glyph.size)/2),f=Q(a),h.equal?h.width>f&&R(a,f):(g=h.top,g>f&&(h.top=f),g=h.left,g>f&&(h.left=f),g=h.bottom,g>f&&(h.bottom=f),g=h.right,g>f&&(h.right=f))}function T(a){var b;return b=a.data,null===b&&(b=0),b}function U(a){var b,c;if(ob(),a.active){if(c=!1,b=T(a),a.exec)try{a.exec(a.x,a.y,b,Nd),c=!0}catch(d){return y("Bead "+a.x+", "+a.y+" function failed ["+d.message+"]",d)}if(tc.touch)try{tc.touch(a.x,a.y,b,Nd),c=!0}catch(e){return y("PS.touch() failed ["+e.message+"]",e)}c&&t()}return PS.DONE}function V(a){var b;if(a.active&&tc.release){b=T(a);try{tc.release(a.x,a.y,b,Nd),t()}catch(c){return y("PS.release() failed ["+c.message+"]",c)}}return PS.DONE}function W(a){var b;if(_c=!0,a.active&&tc.enter){b=T(a);try{tc.enter(a.x,a.y,b,Nd),t()}catch(c){return y("PS.enter() failed ["+c.message+"]",c)}}return PS.DONE}function X(a){var b;if(a.active&&tc.exit){b=T(a);try{tc.exit(a.x,a.y,b,Nd),t()}catch(c){return y("PS.exit() failed ["+c.message+"]",c)}}return PS.DONE}function Y(){if(_c=!1,tc.exitGrid)try{tc.exitGrid(Nd),t()}catch(a){return y("PS.exitGrid() failed ["+a.message+"]",a)}return PS.DONE}function Z(){ae=-1}function $(a,b){var c,d,e,f;if(c=yc.canvas,a+=document.body.scrollLeft+document.documentElement.scrollLeft-c.offsetLeft-yc.padLeft,b+=document.body.scrollTop+document.documentElement.scrollTop-c.offsetTop-yc.padRight,a>=yc.left&&a<yc.right&&b>=yc.top&&b<yc.bottom)for(e=0;e<yc.count;){if(d=zc[e],b>=d.top&&b<d.bottom){for(f=0;f<yc.x;f+=1){if(a>=d.senseLeft&&a<d.senseRight&&b>=d.senseTop&&b<d.senseBottom)return d;e+=1,d=zc[e]}return null}e+=yc.x}return null}function _(a){var b,c,d;return a.x&&a.y?(b=a.x,c=a.y):(b=a.clientX,c=a.clientY),d=$(b,c),d?U(d):pb(),gd!==PS.DEFAULT_NAMESPACE?g(a):void a.preventDefault()}function ab(a){var b,c,d;return a.x&&a.y?(b=a.x,c=a.y):(b=a.clientX,c=a.clientY),d=$(b,c),d&&V(d),g(a)}function bb(a){var b,c,d,e;return a.x&&a.y?(b=a.x,c=a.y):(b=a.clientX,c=a.clientY),d=$(b,c),d?d.index!==ae&&(ae>=0&&(e=zc[ae],X(e)),W(d),ae=d.index):ae>=0&&(e=zc[ae],X(e),ae=-1),g(a)}function cb(a){var b,c;return ae>=0&&(b=zc[ae],X(b),ae=-1),c=a.relatedTarget,c&&(c=c.id,c&&(c===sd||c===td||c.length<1)&&Y()),g(a)}function db(a){var b,c,d,e;return Zc!==Qd?g(a):(d=a.changedTouches[0],Zc=d.identifier,b=d.pageX,c=d.pageY,e=$(b,c),e?(_c=!0,$c=e.index,U(e)):($c=Qd,_c=!1),g(a))}function eb(a){var b,c,d,e,f,h,i;for(b=a.changedTouches.length,c=0;b>c;c+=1)if(d=a.changedTouches[c],e=d.identifier,e===Zc){Zc=Qd,$c=Qd,_c=!1,f=d.pageX,h=d.pageY,i=$(f,h),i&&V(i);break}return g(a)}function fb(a){var b,c,d,e,f,h,i,j;for(b=a.changedTouches.length,c=0;b>c;c+=1)if(d=a.changedTouches[c],e=d.identifier,e===Zc){f=d.pageX,h=d.pageY,i=$(f,h),i?(_c=!0,$c!==i.index&&($c!==Qd&&(j=zc[$c],X(j)),$c=i.index,W(i))):($c!==Qd&&(j=zc[$c],X(j)),$c=Qd,_c&&Y());break}return g(a)}function gb(){var a;for(Qc.length=0,Rc=!1,Sc=!1,a=0;256>a;a+=1)Pc[a]=0}function hb(a,b){var c;return c=a,c>=65&&90>=c?b||(c+=32):(c=Mc[c],b&&256>c&&(c=Nc[c])),c}function ib(a){return a>=32||13===a||8===a||9===a||27===a}function jb(a){if(yc.focused){var b,c,d,e,f,h;if(b="[_keyDown] ",c=!1,bd)return!0;if(tc.keyDown){if(Rc=a.shiftKey,Sc=a.ctrlKey,d=a.which?a.which:a.keyCode,e=hb(d,Rc),ib(e)){if(!Pc[e]){Pc[e]=1,e!==d&&Pc[d]&&(Pc[d]=0,h=Qc.indexOf(d),h>=0&&Qc.splice(h,1)),Qc.length<1&&(Uc=Wc),Qc.indexOf(e)<0&&Qc.push(e);try{tc.keyDown(e,Rc,Sc,Nd),c=!0}catch(i){y(b+"PS.keyDown failed ["+i.message+"]",i)}}}else if(e===Pd)for(f=Qc.length,h=0;f>h;h+=1)if(e=d=Qc[h],d>=97&&122>=d?e-=32:256>d&&(e=Nc[d]),e!==d){Pc[d]=0,Pc[e]=1,Qc[h]=e;try{tc.keyDown(e,!0,Sc,Nd),c=!0}catch(j){y(b+"PS.keyDown failed ["+j.message+"]",j)}}c&&t()}return g(a)}}function kb(a){if(yc.focused){var b,c,d,e,f,h,i,j;if(b="[_keyUp] ",c=!1,bd)return!0;if(tc.keyUp){if(d=Rc=a.shiftKey,e=Sc=a.ctrlKey,f=a.which?a.which:a.keyCode,h=hb(f,Rc),ib(h)){Pc[h]=0,i=Qc.indexOf(h),i>=0&&Qc.splice(i,1),Qc.length<1&&(Uc=0,Rc=!1,Sc=!1);try{tc.keyUp(h,d,e,Nd),c=!0}catch(k){y(b+"PS.keyUp failed ["+k.message+"]",k)}}else if(h===Pd)for(j=Qc.length,i=0;j>i;i+=1)if(h=f=Qc[i],256>f&&(h=Oc[f]),h!==f){Pc[f]=0,Pc[h]=1,Qc[i]=h;try{tc.keyDown(h,!1,e,Nd),c=!0}catch(l){y(b+"PS.keyDown failed ["+l.message+"]",l)}}c&&t()}return g(a)}}function lb(a){if(yc.focused){var b;if(!_c)return!0;if(tc.input){a||(a=window.event),b=Math.max(-1,Math.min(1,a.wheelDelta||-a.detail)),b=b>=1?PS.WHEEL_FORWARD:PS.WHEEL_BACKWARD;try{tc.input({wheel:b},Nd),t()}catch(c){y("PS.input() failed ["+c.message+"]",c)}}return g(a)}}function mb(){Lc||(document.addEventListener("keydown",jb,!1),document.addEventListener("keyup",kb,!1),Lc=!0)}function nb(){gb(),Lc&&(document.removeEventListener("keydown",jb,!1),document.removeEventListener("keyup",kb,!1),Lc=!1)}function ob(a){yc.focused||(yc.focused=!0),a&&a.preventDefault()}function pb(a){if(yc.focused){var b=a.target,c=yc.canvas,d=document.getElementById(td),e=document.getElementById(sd),f=document.getElementById(Cd);if(b===c||b===Ac.div||b===f||b===d||b===e)return;yc.focused=!1,a&&a.preventDefault()}}function qb(){var a;if(a=yc.canvas,a.style.display="block",a.focused=gd===PS.DEFAULT_NAMESPACE?!0:!1,a.addEventListener("mousedown",_,!1),a.addEventListener("mouseup",ab,!1),a.addEventListener("mousemove",bb,!1),a.addEventListener("mouseout",cb,!1),mb(),gd!==PS.DEFAULT_NAMESPACE){var b=document.getElementById(sd);b.addEventListener("mousedown",ob,!0),document.addEventListener("mousedown",pb,!1)}document.addEventListener("keydown",jb,!1),document.addEventListener("keyup",kb,!1),window.addEventListener("DOMMouseScroll",lb,!1),window.addEventListener("mousewheel",lb,!1),Xc&&(Zc=Qd,$c=Qd,document.addEventListener("touchmove",fb,!1),document.addEventListener("touchstart",db,!1),document.addEventListener("touchend",eb,!1),document.addEventListener("touchcancel",eb,!1))}function rb(){var a;if(a=yc.canvas,a.style.display="none",a.removeEventListener("mousedown",_,!1),a.removeEventListener("mouseup",ab,!1),a.removeEventListener("mousemove",bb,!1),a.removeEventListener("mouseout",cb,!1),nb(),gd!==PS.DEFAULT_NAMESPACE){var b=document.getElementById(sd);b&&b.removeEventListener("mousedown",ob,!0),document.removeEventListener("mousedown",pb,!1)}document.removeEventListener("keydown",jb,!1),document.removeEventListener("keyup",kb,!1),window.removeEventListener("DOMMouseScroll",lb,!1),window.removeEventListener("mousewheel",lb,!1),Xc&&(document.removeEventListener("touchmove",fb,!1),document.removeEventListener("touchstart",db,!1),document.removeEventListener("touchend",eb,!1),document.removeEventListener("touchcancel",eb,!1))}function sb(a){var b,c,d,e,g,h;return b=yc.color,c=yc.fader,d=a.rgb,d===PS.CURRENT?b.rgb:(null===d?(e=a.r,e===PS.CURRENT?a.r=e=b.r:e===PS.DEFAULT&&(a.r=e=Xd.grid.color.r),g=a.g,g===PS.CURRENT?a.g=g=b.g:g===PS.DEFAULT&&(a.g=g=Xd.grid.color.g),h=a.b,h===PS.CURRENT?a.b=h=b.b:h===PS.DEFAULT&&(a.b=h=Xd.grid.color.b),a.rgb=e*Kd+g*Ld+h):d===PS.DEFAULT&&f(Xd.grid.color,a),(b.rgb!==a.rgb||c.rate>0&&null!==c.rgb&&c.rgb!==a.rgb)&&(b.rgb=a.rgb,e=a.r,g=a.g,h=a.b,b.str=a.str=uc[e]+vc[g]+wc[h],c.rate>0?null!==c.rgb?F(c,c.r,c.g,c.b,255,e,g,h,255):c.active?G(c,e,g,h,255):F(c,b.r,b.g,b.b,255,e,g,h,255):(l(a),m(a)),b.r=e,b.g=g,b.b=h),b.rgb)}function tb(a,b){var c,d,e,g,h;return c=yc.shadow,d=b.rgb,d!==PS.CURRENT&&(null===d?(e=b.r,e===PS.CURRENT?b.r=e=c.r:e===PS.DEFAULT&&(b.r=e=Xd.grid.shadow.r),g=b.g,g===PS.CURRENT?b.g=g=c.g:g===PS.DEFAULT&&(b.g=g=Xd.grid.shadow.g),h=b.b,h===PS.CURRENT?b.b=h=c.b:h===PS.DEFAULT&&(b.b=h=Xd.grid.shadow.b),b.rgb=e*Kd+g*Ld+h):d===PS.DEFAULT&&f(Xd.grid.shadow,b),c.rgb!==b.rgb&&(c.rgb=b.rgb,e=b.r,g=b.g,h=b.b,c.str=b.str=uc[e]+vc[g]+wc[h],c.r=e,c.g=g,c.b=h)),a!==PS.CURRENT&&(yc.shadow.show=a),yc.shadow.show?n(c):yc.canvas.style.boxShadow="none",{show:yc.shadow.show,rgb:c.rgb}}function ub(a,b){var c,d,e,f,g,h,i;if(B(),C(yc.fader),C(Ac.fader),yc.plane=0,yc.ready&&a===yc.x&&b===yc.y)for(d=0;d<yc.count;d+=1)i=zc[d],O(i),S(i);else{for(yc.x=a,yc.y=b,yc.count=a*b,yc.left=0,yc.top=0,c=Math.floor(a>=b?Id/a:Id/b),yc.bead_size=c,yc.width=c*a,yc.height=c*b,yc.right=yc.width,yc.bottom=yc.height,yc.canvas.width=yc.width,yc.canvas.height=yc.height,yc.context.textAlign="center",yc.context.textBaseline="middle",f=0,h=yc.top,e=0;b>e;e+=1){for(g=yc.left,d=0;a>d;d+=1)i=zc[f],i.x=d,i.y=e,i.left=g,i.right=g+c,i.top=h,i.bottom=h+c,O(i),S(i),g+=c,f+=1;h+=c}for(;Md>f;)i=zc[f],i.visible=!1,i.active=!1,f+=1}_d=!0,sb({rgb:PS.DEFAULT}),tc.statusColor(PS.DEFAULT),t(),Z(),yc.ready=!0}function vb(a,b){return"number"!==d(a)?z(b+"x argument not a number"):(a=Math.floor(a),0>a?z(b+"x argument negative"):a>=yc.x?z(b+"x argument exceeds grid width"):a)}function wb(a,b){return"number"!==d(a)?z(b+"y argument not a number"):(a=Math.floor(a),0>a?z(b+"y argument negative"):a>=yc.y?z(b+"y argument exceeds grid height"):a)}function xb(a,b,c,d,e,f,g,h){var i,j,k;if(c===PS.ALL){if(d===PS.ALL){for(j=0;j<yc.y;j+=1)for(i=0;i<yc.x&&(k=b(i,j,e,f,g,h),k!==PS.ERROR);i+=1);return k}if(d=wb(d,a),d===PS.ERROR)return PS.ERROR;for(i=0;i<yc.x&&(k=b(i,d,e,f,g,h),k!==PS.ERROR);i+=1);return k}if(d===PS.ALL){if(c=vb(c,a),c===PS.ERROR)return PS.ERROR;for(j=0;j<yc.y&&(k=b(c,j,e,f,g,h),k!==PS.ERROR);j+=1);return k}return c=vb(c,a),c===PS.ERROR?PS.ERROR:(d=wb(d,a),d===PS.ERROR?PS.ERROR:k=b(c,d,e,f,g,h))}function yb(a,b,c){var d,e,g,h,i,j,k,l,m;return d=b*yc.x+a,e=zc[d],g=Xd.bead.color,h=P(e,yc.plane),i=e.fader,j=c.rgb,e.active&&j!==PS.CURRENT?(null===j?(k=c.r,k===PS.CURRENT?c.r=k=h.r:k===PS.DEFAULT&&(c.r=k=g.r),l=c.g,l===PS.CURRENT?c.g=l=h.g:l===PS.DEFAULT&&(c.g=l=g.g),m=c.b,m===PS.CURRENT?c.b=m=h.b:m===PS.DEFAULT&&(c.b=m=g.b),c.rgb=k*Kd+l*Ld+m):j===PS.DEFAULT&&f(g,c),(h.rgb!==c.rgb||i.rate>0&&null!==i.rgb&&i.rgb!==c.rgb)&&(h.rgb=c.rgb,h.r=c.r,h.g=c.g,h.b=c.b,J(e)),h.rgb):h.rgb}function zb(a,b,c){var d,e,f;return d=b*yc.x+a,e=zc[d],f=P(e,yc.plane),e.active&&c!==PS.CURRENT&&c!==f.a&&(f.a=c,J(e)),f.a}function Ab(a,b){var c,e,f,g,h,i,j;if(c=d(b),"undefined"===c||b===PS.CURRENT)return{rgb:PS.CURRENT,r:0,g:0,b:0,onStep:PS.CURRENT,onEnd:PS.CURRENT,params:PS.CURRENT};if(b===PS.DEFAULT)return{rgb:PS.DEFAULT,r:0,g:0,b:0,onStep:PS.CURRENT,onEnd:PS.DEFAULT,params:PS.DEFAULT};if("object"!==c)return z(a+"options argument invalid");if(e=b.rgb,e!==PS.CURRENT&&e!==PS.DEFAULT)if(c=d(e),"undefined"===c||null===e)b.rgb=PS.CURRENT;else{if("number"!==c)return z(a+"options.rgb property invalid");e=Math.floor(e),e<=PS.COLOR_BLACK?(e=PS.COLOR_BLACK,f=0,h=0,g=0):e>=PS.COLOR_WHITE?(e=PS.COLOR_WHITE,f=255,h=255,g=255):(f=e/Kd,f=Math.floor(f),i=f*Kd,h=(e-i)/Ld,h=Math.floor(h),j=h*Ld,g=e-i-j),b.rgb=e,b.r=f,b.g=h,b.b=g}else b.r=0,b.g=0,b.b=0;if(e=b.onStep,e!==PS.CURRENT&&e!==PS.DEFAULT)if(c=d(e),"undefined"===c||null===e)b.onStep=PS.CURRENT;else if("function"!==c)return z(a+"options.onStep property invalid");if(e=b.onEnd,e!==PS.CURRENT&&e!==PS.DEFAULT)if(c=d(e),"undefined"===c||null===e)b.onEnd=PS.CURRENT;else if("function"!==c)return z(a+"options.onEnd property invalid");if(e=b.params,e!==PS.CURRENT&&e!==PS.DEFAULT)if(c=d(e),"undefined"===c||null===e)b.params=PS.CURRENT;else if("array"!==c)return z(a+"options.params property invalid");return b}function Bb(a,b,c,d){var e,f,g,h,i,j,k;return e=b*yc.x+a,f=zc[e],g=f.color,h=f.fader,i=h.rate,f.active&&(j=c===PS.CURRENT?i:c===PS.DEFAULT?Xd.fader.rate:c,k=d.rgb,k!==PS.CURRENT&&(h.rgb=k===PS.DEFAULT?Xd.fader.rgb:k,h.r=d.r,h.g=d.g,h.b=d.b),k=d.onStep,k!==PS.CURRENT&&(h.onStep=k===PS.DEFAULT?Xd.fader.onStep:k),k=d.onEnd,k!==PS.CURRENT&&(h.onEnd=k===PS.DEFAULT?Xd.fader.onEnd:k),k=d.params,k!==PS.CURRENT&&(h.params=k===PS.DEFAULT?Xd.fader.params:k),i!==j&&(h.rate=j,1>j?(h.active=!1,h.kill=!0):h.active&&G(h,g.r,g.g,g.b,255))),{rate:h.rate,rgb:h.rgb,onStep:h.onStep,onEnd:h.onEnd,params:h.params}}function Cb(a,b,c){var d,e;return d=b*yc.x+a,e=zc[d],e.active&&c!==PS.CURRENT&&e.scale!==c&&(e.scale=c,S(e),s(e)),e.scale}function Db(a,b,c){var d,e,f;return d=b*yc.x+a,e=zc[d],e.active&&c!==PS.CURRENT&&e.radius!==c&&(e.radius=c,!e.border.equal&&c>0&&(f=Math.max(e.border.top,e.border.left,e.border.bottom,e.border.right),R(e,f)),s(e)),e.radius}function Eb(a,b,c){var d,e,g,h,i,j,k,l;return d=b*yc.x+a,e=zc[d],g=Xd.bead.bgColor,h=e.bgColor,i=c.rgb,e.active&&i!==PS.CURRENT?(null===i?(j=c.r,j===PS.CURRENT?c.r=j=h.r:j===PS.DEFAULT&&(c.r=j=g.r),k=c.g,k===PS.CURRENT?c.g=k=h.g:k===PS.DEFAULT&&(c.g=k=g.g),l=c.b,l===PS.CURRENT?c.b=l=h.b:l===PS.DEFAULT&&(c.b=l=g.b),c.rgb=j*Kd+k*Ld+l):i===PS.DEFAULT&&f(g,c),h.rgb!==c.rgb&&(h.rgb=c.rgb,h.r=j=c.r,h.g=k=c.g,h.b=l=c.b,h.str=uc[j]+vc[k]+vc[l]+xc[h.a],e.active&&(e.scale<100||e.radius>0)&&s(e)),h.rgb):h.rgb}function Fb(a,b,c){var d,e,f;return d=b*yc.x+a,e=zc[d],f=e.bgColor,c!==PS.CURRENT&&c!==f.a&&(f.a=c,f.str=uc[f.r]+vc[f.g]+vc[f.b]+xc[c],e.active&&(e.scale<100||e.radius>0)&&s(e)),f.a}function Gb(a,b,c){var d,e;return d=b*yc.x+a,e=zc[d],e.active&&c!==PS.CURRENT&&(null===c?(e.data=Xd.bead.data,e.fader.data=e.data,e.borderFader.data=e.data,e.glyphFader.data=e.data):(e.data=c,e.fader.data=c,e.borderFader.data=c,e.glyphFader.data=c)),e.data}function Hb(a,b,c){var d,e;return d=b*yc.x+a,e=zc[d],e.active&&c!==PS.CURRENT&&(e.exec=c),e.exec}function Ib(a,b,c){var d,e;return d=b*yc.x+a,e=zc[d],e.active&&c!==PS.CURRENT&&e.visible!==c&&(e.visible=c,c||(e.fader.kill=!0,e.borderFader.kill=!0,e.glyphFader.kill=!0),s(e)),e.visible}function Jb(a,b,c){var d,e;return d=b*yc.x+a,e=zc[d],c!==PS.CURRENT&&(e.active=c),e.active}function Kb(a,b,c){var e,f,g,h,i,j,k,l,m;return e=b*yc.x+a,f=zc[e],f.active&&c!==PS.CURRENT&&(g=Q(f),"number"===d(c)?(c>g&&(c=g),c!==f.border.width&&(R(f,c),s(f))):(i=!1,j=c.top,j===PS.CURRENT?j=f.border.top:(j>g&&(j=g),j!==f.border.top&&(f.border.top=j,i=!0)),k=c.left,k===PS.CURRENT?k=f.border.left:(k>g&&(k=g),k!==f.border.left&&(f.border.left=k,i=!0)),l=c.bottom,l===PS.CURRENT?l=f.border.bottom:(l>g&&(l=g),l!==f.border.bottom&&(f.border.bottom=l,i=!0)),m=c.right,m===PS.CURRENT?m=f.border.right:(m>g&&(m=g),m!==f.border.right&&(f.border.right=m,i=!0)),j===k&&j===m&&j===l?(R(f,j),i&&s(f)):f.radius>0?(g=Math.max(j,k,l,m),R(f,g),s(f)):(f.border.equal=!1,i&&s(f)))),h={top:f.border.top,left:f.border.left,bottom:f.border.bottom,right:f.border.right,equal:f.border.equal},f.border.equal||(f.border.width=Math.max(h.top,h.left,h.bottom,h.right)),h.width=f.border.width,h}function Lb(a,b,c){var d,e,g,h,i,j,k,l,m;return d=b*yc.x+a,e=zc[d],g=e.border.color,h=e.borderFader,i=c.rgb,e.active&&i!==PS.CURRENT&&(null===i?(j=c.r,j===PS.CURRENT?c.r=j=g.r:j===PS.DEFAULT&&(c.r=j=Xd.bead.border.color.r),k=c.g,k===PS.CURRENT?c.g=k=g.g:k===PS.DEFAULT&&(c.g=k=Xd.bead.border.color.g),l=c.b,l===PS.CURRENT?c.b=l=g.b:l===PS.DEFAULT&&(c.b=l=Xd.bead.border.color.b),c.rgb=j*Kd+k*Ld+l):i===PS.DEFAULT&&f(Xd.bead.border.color,c),(g.rgb!==c.rgb||h.rate>0&&null!==h.rgb&&h.rgb!==c.rgb)&&(g.rgb=c.rgb,j=c.r,k=c.g,l=c.b,c.a=m=g.a,g.str=c.str=uc[j]+vc[k]+vc[l]+xc[m],e.visible&&(h.rate>0?null!==h.rgb?F(h,h.r,h.g,h.b,m,j,k,l,m):h.active?G(h,j,k,l,m):F(h,g.r,g.g,g.b,m,j,k,l,m):s(e)),g.r=j,g.g=k,g.b=l)),g.rgb}function Mb(a,b,c){var d,e,f,g,h,i,j;return d=b*yc.x+a,e=zc[d],f=e.border.color,e.active&&c!==PS.CURRENT&&c!==f.a&&(g=f.r,h=f.g,i=f.b,f.str=uc[g]+vc[h]+vc[i]+xc[c],e.visible&&(j=e.borderFader,j.rate>0?j.active?G(j,g,h,i,c):null!==j.rgb?F(j,j.r,j.g,j.b,f.a,g,h,i,c):F(j,g,h,i,f.a,g,h,i,c):s(e)),f.a=c),f.a}function Nb(a,b,c,d){var e,f,g,h,i,j,k;return e=b*yc.x+a,f=zc[e],h=f.border.color,g=f.borderFader,i=g.rate,f.active&&(j=c===PS.CURRENT?i:c===PS.DEFAULT?Xd.fader.rate:c,k=d.rgb,k!==PS.CURRENT&&(g.rgb=k===PS.DEFAULT?Xd.fader.rgb:k,g.r=d.r,g.g=d.g,g.b=d.b),k=d.onStep,k!==PS.CURRENT&&(g.onStep=k===PS.DEFAULT?Xd.fader.onStep:k),k=d.onEnd,k!==PS.CURRENT&&(g.onEnd=k===PS.DEFAULT?Xd.fader.onEnd:k),k=d.params,k!==PS.CURRENT&&(g.params=k===PS.DEFAULT?Xd.fader.params:k),i!==j&&(g.rate=j,1>j?(g.active=!1,g.kill=!0):g.active&&G(g,h.r,h.g,h.b,255))),{rate:g.rate,rgb:g.rgb,onStep:g.onStep,onEnd:g.onEnd,params:g.params}}function Ob(a,b,c){var d,e,f;return d=b*yc.x+a,e=zc[d],e.active&&c!==PS.CURRENT&&e.glyph.code!==c&&(e.glyph.code=c,f=1>c?"":String.fromCodePoint(c),e.glyph.str=f,s(e)),e.glyph.code}function Pb(a,b,c){var d,e,g,h,i,j,k,l,m;return d=b*yc.x+a,e=zc[d],g=e.glyph.color,h=e.glyphFader,i=c.rgb,e.active&&i!==PS.CURRENT&&(null===i?(j=c.r,j===PS.CURRENT?c.r=j=g.r:j===PS.DEFAULT&&(c.r=j=Xd.bead.glyph.color.r),k=c.g,k===PS.CURRENT?c.g=k=g.g:k===PS.DEFAULT&&(c.g=k=Xd.bead.glyph.color.g),l=c.b,l===PS.CURRENT?c.b=l=g.b:l===PS.DEFAULT&&(c.b=l=Xd.bead.glyph.color.b),c.rgb=j*Kd+k*Ld+l):i===PS.DEFAULT&&f(Xd.bead.glyph.color,c),(g.rgb!==c.rgb||h.rate>0&&null!==h.rgb&&h.rgb!==c.rgb)&&(g.rgb=c.rgb,j=c.r,k=c.g,l=c.b,c.a=m=g.a,g.str=c.str=uc[j]+vc[k]+vc[l]+xc[m],e.visible&&(h.rate>0?(null!==h.rgb&&F(h,h.r,h.g,h.b,m,j,k,l,m),h.active?G(h,j,k,l,m):F(h,g.r,g.g,g.b,m,j,k,l,m)):s(e)),g.r=j,g.g=k,g.b=l)),g.rgb}function Qb(a,b,c){var d,e,f,g,h,i,j;return d=b*yc.x+a,e=zc[d],f=e.glyph.color,e.active&&c!==PS.CURRENT&&c!==f.a&&(g=f.r,h=f.g,i=f.b,f.str=uc[g]+vc[h]+vc[i]+xc[c],e.visible&&(j=e.glyphFader,j.rate>0?j.active?G(j,g,h,i,c):F(j,g,h,i,f.a,g,h,i,c):s(e)),f.a=c),f.a}function Rb(a,b,c){var d,e,f;return d=b*yc.x+a,e=zc[d],f=e.glyph.scale,e.active&&c!==PS.CURRENT&&c!==f&&(e.glyph.scale=c,e.visible&&(N(e),s(e))),e.glyph.scale}function Sb(a,b,c,d){var e,f,g,h,i,j,k;return e=b*yc.x+a,f=zc[e],g=f.glyph.color,h=f.glyphFader,i=h.rate,f.active&&(j=c===PS.CURRENT?i:c===PS.DEFAULT?Xd.fader.rate:c,k=d.rgb,k!==PS.CURRENT&&(h.rgb=k===PS.DEFAULT?Xd.fader.rgb:k,h.r=d.r,h.g=d.g,h.b=d.b),k=d.onStep,k!==PS.CURRENT&&(h.onStep=k===PS.DEFAULT?Xd.fader.onStep:k),k=d.onEnd,k!==PS.CURRENT&&(h.onEnd=k===PS.DEFAULT?Xd.fader.onEnd:k),k=d.params,k!==PS.CURRENT&&(h.params=k===PS.DEFAULT?Xd.fader.params:k),i!==j&&(h.rate=j,1>j?(h.active=!1,h.kill=!0):h.active&&G(h,g.r,g.g,g.b,255))),{rate:h.rate,rgb:h.rgb,onStep:h.onStep,onEnd:h.onEnd,params:h.params}}function Tb(a){var b,c,d,e,f;for(b=a.getAttribute("data-id"),c=Cc.length,d=0;c>d;d+=1)if(e=Cc[d],e.id===b){f=e.exec,Cc.splice(d,1);break}try{f(PS.ERROR)}catch(g){y("[PS.imageLoad] .exec function failed ["+g.message+"]",g)}z("[PS.imageLoad] Error loading "+a.src)}function Ub(a,b){var c,e,f,g,h,i,j,k,l,m,n,o,p,q,r;if(c="[_imageExtract] ",e=a.width,"number"!==d(e)||1>e)return z(c+"image width invalid");if(e=Math.floor(e),f=a.height,"number"!==d(f)||1>f)return z(c+"image height invalid");f=Math.floor(f);try{Bc.width=e,Bc.height=f,g=Bc.getContext("2d"),g.drawImage(a,0,0,e,f,0,0,e,f)}catch(s){return y(c+"image extraction failed @ 1 ["+s.message+"]",s)}try{h=g.getImageData(0,0,e,f)}catch(t){return y(c+"image extraction failed @ 2 ["+t.message+"]",t)}if(i={width:h.width,height:h.height},j=h.data,k=j.length,l=[],n=m=0,1===b)for(l.length=k/4;k>m;)o=j[m],p=j[m+1],q=j[m+2],l[n]=o*Kd+p*Ld+q,m+=4,n+=1;else if(2===b)for(l.length=k/2;k>m;)o=j[m],p=j[m+1],q=j[m+2],r=j[m+3],l[n]=o*Kd+p*Ld+q,l[n+1]=r,m+=4,n+=2;else if(3===b)for(l.length=k/4*3;k>m;)o=j[m],p=j[m+1],q=j[m+2],l[n]=o,l[n+1]=p,l[n+2]=q,m+=4,n+=3;else for(l.length=k;k>m;)l[m]=j[m],m+=1,l[m]=j[m],m+=1,l[m]=j[m],m+=1,l[m]=j[m],m+=1;return i.pixelSize=b,i.data=l,i}function Vb(a){var b,c,d,e,f,g,h,i;for(b=a.getAttribute("data-id"),c=Cc.length,d=0;c>d;d+=1)if(e=Cc[d],e.id===b){f=e.exec,g=e.format,h=e.source,Cc.splice(d,1);break}if(i=Ub(a,g),i!==PS.ERROR)try{i.source=h,i.id=b,f(i)}catch(j){y("[PS.imageLoad] .exec function failed ["+j.message+"]",j)}}function Wb(a,b){var c,e,f,g,h,i,j,k;if("object"!==d(b))return z(a+"image argument not an object");if(c=b.width,"number"!==d(c))return z(a+"image.width not a number");if(c=Math.floor(c),1>c)return z(a+"image.width < 1");if(b.width=c,e=b.height,"number"!==d(e))return z(a+"image.height not a number");if(e=Math.floor(e),1>e)return z(a+"image.height < 1");if(b.height=e,f=b.pixelSize,"number"!==d(f))return z(a+"image.pixelSize not a number");if(f=Math.floor(f),1>f&&f>4)return z(a+"image.pixelSize is not 1, 2, 3 or 4");if(b.pixelSize=f,h=b.data,"array"!==d(h))return z(a+"image.data is not an array");if(i=h.length,g=c*e*f,i!==g)return z(a+"image.data length invalid");for(j=0;i>j;j+=1){if(k=h[j],"number"!==d(k))return z(a+"image.data["+j+"] not a number");if(0>k)return z(a+"image.data["+j+"] negative");if(3>f){if(k>16777215)return z(a+"image.data["+j+"] > 0xFFFFFF")
}else if(k>255)return z(a+"image.data["+j+"] > 255")}return!0}function Xb(a,b){var c,d;if(c=a.toString(16).toUpperCase(),b)for(d=c.length;b>d;)c="0"+c,d+=1;return"0x"+c}function Yb(a,b,c,d,e,f,g){var h;return 3>a?(h="",h+=b?Xb(c,6):c,2===a&&(h+=b?", "+Xb(g,2):", "+g)):(h=b?Xb(d,2)+", "+Xb(e,2)+", "+Xb(f,2):d+", "+e+", "+f,4===a&&(h+=b?", "+Xb(g,2):", "+g)),h}function Zb(){var a;return a={id:Fd+Fc,placed:!1,visible:!0,x:0,y:0,ax:0,ay:0,image:null,color:null,collide:null,width:0,height:0,plane:-1},Fc+=1,Ec.push(a),a}function $b(a,b){var c,d,e;if("string"!=typeof a||a.length<1)return z(b+"sprite argument invalid");for(c=Ec.length,d=0;c>d;d+=1)if(e=Ec[d],e.id===a)return e;return z(b+"sprite id '"+a+"' does not exist")}function _b(a,b,c,d,e){var f,g,h,i,j,k,l,m,n;if(void 0===b&&(b=a.x,c=a.y,d=a.width,e=a.height),f=yc.x,b-=a.ax,!(b>=f)){if(0>b){if(d+=b,1>d)return;b=0}if(b+d>f&&(d=f-b),h=b+d,g=yc.y,c-=a.ay,!(c>=g)){if(0>c){if(e+=c,1>e)return;c=0}for(c+e>g&&(e=g-c),i=c+e,k=c;i>k;k+=1)for(j=b;h>j;j+=1)m=j+k*f,l=zc[m],l.active&&(n=P(l,a.plane),n.r=255,n.g=255,n.b=255,n.a=0,n.rgb=16777215,J(l))}}}function ac(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;if(b=a.width,c=a.height,!(1>b||1>c||(d=yc.x,j=0,f=a.x-a.ax,f>=d))){if(0>f){if(b+=f,1>b)return;f=0,j=a.width-b}if(f+b>d&&(b=d-f),h=f+b,e=yc.y,k=0,g=a.y-a.ay,!(g>=e)){if(0>g){if(c+=g,1>c)return;g=0,k=a.height-c}if(g+c>e&&(c=e-g),i=g+c,l=a.color)for(n=g;i>n;n+=1)for(m=f;h>m;m+=1)p=m+n*d,o=zc[p],o.active&&(q=P(o,a.plane),q.rgb=l.rgb,q.r=l.r,q.g=l.g,q.b=l.b,q.a=l.a,J(o));else for(r=a.image.data,n=g;i>n;n+=1){for(s=4*(k*a.width+j),m=f;h>m;m+=1)p=m+n*d,o=zc[p],o.active&&(t=r[s],u=r[s+1],v=r[s+2],w=r[s+3],q=P(o,a.plane),q.rgb=t*Kd+u*Ld+v,q.r=t,q.g=u,q.b=v,q.a=w,J(o)),s+=4;k+=1}}}}function bc(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;for(c="[_collisionCheck] ",f=a.x-a.ax,g=a.y-a.ay,h=a.width,i=a.height,j=a.collide,d=Ec.length,e=0;d>e;e+=1)if(k=Ec[e],l=k.id,l!==b&&k.visible&&k.placed&&(m=k.x-k.ax,n=k.y-k.ay,o=k.width,p=k.height,q=k.collide,r=m>f?m-f:f-m,s=n>g?n-g:g-n,t=null,f===m-h||f===m+o?(n>=g&&i>=s||g>=n&&p>=s)&&(t=PS.SPRITE_TOUCH):g===n-i||g===n+p?(m>=f&&h>=r||f>=m&&o>=r)&&(t=PS.SPRITE_TOUCH):f>=m&&m+o>f?(n>=g&&i>s||g>=n&&p>s)&&(t=PS.SPRITE_OVERLAP):m>=f&&f+h>m&&(g>=n&&p>s||n>=g&&i>s)&&(t=PS.SPRITE_OVERLAP),t)){if(j)try{j(b,a.plane,l,k.plane,t)}catch(u){return void y(c+b+" collide function failed ["+u.message+"]",u)}if(q)try{q(l,k.plane,b,a.plane,t)}catch(v){return void y(c+l+" collide function failed ["+v.message+"]",v)}}}function cc(a){this.content=[],this.scoreFunction=a}function dc(a,b,c,d){var e,f,g,h,i,j,k;for(e=c>a?c-a:a-c,f=d>b?d-b:b-d,g=c>a?1:-1,h=d>b?1:-1,i=e-f,k=[];a!==c||b!==d;){if(j=2*i,j>-f&&(i-=f,a+=g),a===c&&b===d){k.push([a,b]);break}e>j&&(i+=e,b+=h),k.push([a,b])}return k}function ec(a,b,c,d,e,f){var g,h,i,j,k,l,m,n,o;for(g=e>c?e-c:c-e,h=f>d?f-d:d-f,i=e>c?1:-1,j=f>d?1:-1,k=g-h,m=[];c!==e||d!==f;){if(l=2*k,l>-h&&(k-=h,c+=i),c===e&&d===f)return m.push([c,d]),m;if(g>l&&(k+=g,d+=j),o=d*b+c,n=a[o],!n.value)return null;m.push([c,d])}return m}function fc(a,b,c,d){var e,f,g;return e=c>a?c-a:a-c,f=d>b?d-b:b-d,g=e>f?f*Sd+(e-f):e*Sd+(f-e)}function gc(a,b,c,d,e,f){var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;return g=[],h=d.x,i=d.y,j=b-1,k=c-1,n=i*b,l=(i-1)*b,m=(i+1)*b,r=!1,s=!1,t=!1,u=!1,h>0&&(o=h-1,p=n+o,q=a[p],q.value?q.closed||(q.cost=q.value,g.push(q)):u=!0),j>h&&(o=h+1,p=n+o,q=a[p],q.value?q.closed||(q.cost=q.value,g.push(q)):t=!0),i>0&&(p=l+h,q=a[p],q.value?q.closed||(q.cost=q.value,g.push(q)):r=!0),k>i&&(p=m+h,q=a[p],q.value?q.closed||(q.cost=q.value,g.push(q)):s=!0),e||(h>0&&(o=h-1,i>0&&(f||!u&&!r)&&(p=l+o,q=a[p],q.value&&!q.closed&&(q.cost=q.value*Sd,g.push(q))),k>i&&(f||!u&&!s)&&(p=m+o,q=a[p],q.value&&!q.closed&&(q.cost=q.value*Sd,g.push(q)))),j>h&&(o=h+1,i>0&&(f||!r&&!t)&&(p=l+o,q=a[p],q.value&&!q.closed&&(q.cost=q.value*Sd,g.push(q))),k>i&&(f||!s&&!t)&&(p=m+o,q=a[p],q.value&&!q.closed&&(q.cost=q.value*Sd,g.push(q))))),g}function hc(a){return a.f}function ic(a,b,c,d,e,f,g){var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;if(b===d&&c===e)return[];if(h=a.width,i=a.height,j=a.nodes,k=c*h+b,l=j[k],!l.value)return[];if(k=e*h+d,l=j[k],!l.value)return[];if(!f&&(m=ec(j,h,b,c,d,e)))return m;for(n=j.length,s=0;n>s;s+=1)l=j[s],l.f=0,l.g=0,l.h=0,l.cost=0,l.closed=!1,l.visited=!1,l.parent=null;for(m=[],o=new cc(hc),k=c*h+b,l=j[k],o.push(l);o.size()>0;){if(p=o.pop(),p.x===d&&p.y===e){for(w=p;w.parent;)m.push([w.x,w.y]),w=w.parent;m.reverse();break}for(p.closed=!0,q=gc(j,h,i,p,f,g),r=q.length,s=0;r>s;s+=1)t=q[s],u=p.g+t.cost,v=t.visited,(!v||u<t.g)&&(t.visited=!0,t.parent=p,t.h=t.h||fc(t.x,t.y,d,e),t.g=u,t.f=t.g+t.h,v?o.rescore(t):o.push(t))}return m}function jc(a,b,c,d,e,f){var g,h,i,j,k,l,m,n;for(g=[],g.length=d*e,h=a.nodes,i=c+e,m=0,l=c;i>l;l+=1)for(j=l*a.width+b,k=0;d>k;k+=1)n=h[j],f!==PS.CURRENT&&(n.value=f===PS.DEFAULT?n.ovalue:f),g[m]=n.value,m+=1,j+=1;return g}function kc(a,b,c){var d,e,f,g,h,i,j,k;for(e=c.length,d=[],d.length=e,f=0,h=0;b>h;h+=1)for(g=0;a>g;g+=1)j=c[f],i={x:g,y:h,value:j,ovalue:j,f:0,g:0,h:0,cost:0,parent:null,closed:!1,visited:!1},d[f]=i,f+=1;return k={id:Gd+fd,width:a,height:b,nodes:d},fd+=1,ed.push(k),k}function lc(a){var b,c,d;for(b=ed.length,c=0;b>c;c+=1)if(d=ed[c],d.id===a)return d;return null}function mc(a){var b,c,d,e,f;for(b=ed.length,c=0;b>c;c+=1)if(d=ed[c],d.id===a){for(e=d.nodes,b=e.length,f=0;b>f;f+=1)e[f]=null;return d.nodes=null,ed.splice(c,1),!0}return!1}function nc(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x;for(f=a.nodes,g=a.width,h=a.height,i=1;g>i;){if(j=[],k=d-i,m=d+i,l=e-i,n=e+i,o=k,0>o&&(o=0),p=m+1,p>=g&&(p=g),l>=0)for(q=l*g+o,r=o;p>r;r+=1)s=f[q],s.value&&j.push([s.x,s.y]),q+=1;if(h>n)for(q=n*g+o,r=o;p>r;r+=1)s=f[q],s.value&&j.push([s.x,s.y]),q+=1;if(o=l+1,0>o&&(o=0),p=n,p>=h&&(p=h),k>=0)for(q=o*g+k,r=o;p>r;r+=1)s=f[q],s.value&&j.push([s.x,s.y]),q+=g;if(g>m)for(q=o*g+m,r=o;p>r;r+=1)s=f[q],s.value&&j.push([s.x,s.y]),q+=g;if(t=j.length){if(1===t)return j[0];for(u=g+h,r=0;t>r;r+=1)x=j[r],w=fc(b,c,x[0],x[1]),u>w&&(u=w,v=r);return j[v]}i+=1}return[b,c]}function oc(a){Ac.inputP.style.display="none",mb(),Ac.statusNode.nodeValue=Ac.text=a,Ac.statusP.style.display="block"}function pc(a){var b,c,d;if(b=a.which,b||(b=a.keyCode),b===PS.KEY_ENTER){if(c=Ac.input.value,d=Ac.exec,"function"==typeof d)try{d(c)}catch(e){y("PS.statusInput() function failed ["+e.message+"]",e)}return Ac.input.removeEventListener("keydown",pc,!1),oc(Ac.text),g(a)}return!0}function qc(a,b){var c;Ac.statusP.style.display="none",Ac.label=c=a,c.length<1&&(c=">"),Ac.inputNode.nodeValue=c,Ac.exec=b,Ac.input.value="",nb(),Ac.input.addEventListener("keydown",pc,!1),Ac.inputP.style.display="block",Ac.input.focus()}function rc(){try{return document.createEvent("TouchEvent"),!0}catch(a){return!1}}function sc(){var a,b,c,d,e;if(a=window.navigator.userAgent.toLowerCase(),b=window.navigator.platform.toLowerCase(),/firefox/.test(a)?(c="Firefox",/fennec/.test(a)&&(c+=" Mobile"),e=/firefox\/[\.\d]+/.exec(a)[0].split("/")[1]):/chrome/.test(a)?(c="Chrome",e=/chrome\/[\d\.]+/.exec(a)[0].split("/")[1]):/safari/.test(a)?(c="Safari",(/iphone/.test(a)||/ipad/.test(a)||/ipod/.test(a))&&(d="iOS")):/msie/.test(a)?(c="Internet Explorer",/iemobile/.test(a)&&(c+=" Mobile"),e=/msie \d+[.]\d+/.exec(a)[0].split(" ")[1]):/trident/.test(a)?(c="Internet Explorer",e=/rv\:\d+[.]\d+/.exec(a)[0].split(":")[1]):/opera/.test(a)?(c="Opera",/mini/.test(a)?c+=" Mini":/mobile/.test(a)&&(c+=" Mobile")):/android/.test(a)&&(c="Android",d=/android\s[\.\d]+/.exec(a)),!e)try{e=/version\/[\.\d]+/.exec(a),e=e?e[0].split("/")[1]:/opera\/[\.\d]+/.exec(a)[0].split("/")[1]}catch(f){console.error("Problem detecting browser: "+f.message),e=""}"win32"===b||"win64"===b?d="Windows":("macintel"===b||"macppc"===b)&&(d="Mac OS X ",d+=/10[\.\_\d]+/.exec(a)[0],/[\_]/.test(d)&&(d=d.split("_").join("."))),d||(/linux/.test(b)?d="Linux":/windows/.test(a)&&(d="Windows")),Yd.host.app=c,e&&(Yd.host.version=e),Yd.host.os=d}var tc,uc,vc,wc,xc,yc,zc,Ac,Bc,Cc,Dc,Ec,Fc,Gc,Hc,Ic,Jc,Kc,Lc,Mc,Nc,Oc,Pc,Qc,Rc,Sc,Tc,Uc,Vc,Wc,Xc,Yc,Zc,$c,_c,ad,bd,cd,dd,ed,fd,gd=b,hd="outer",id="main",jd="debug",kd="stsp",ld="inp",md="inlabel",nd="inspan",od="inbox",pd="grid",qd="footer",rd="monitor",sd=gd+"-"+hd,td=gd+"-"+id,ud="init",vd=gd+"-"+jd,wd=gd+"-"+kd,xd=gd+"-"+ld,yd=gd+"-"+md,zd=gd+"-"+nd,Ad=gd+"-"+od,Bd=gd+"-"+pd,Cd=gd+"-"+qd,Dd=gd+"-"+rd,Ed="image_",Fd="sprite_",Gd="pathmap_",Hd="timer_",Id=512,Jd=1/255,Kd=65536,Ld=256,Md=1024,Nd={},Od=6,Pd=16,Qd=-1,Rd=4,Sd=1.4142,Td=16,Ud=["a0","bb0","b0","c1","db1","d1","eb1","e1","f1","gb1","g1","ab1","a1","bb1","b1","c2","db2","d2","eb2","e2","f2","gb2","g2","ab2","a2","bb2","b2","c3","db3","d3","eb3","e3","f3","gb3","g3","ab3","a3","bb3","b3","c4","db4","d4","eb4","e4","f4","gb4","g4","ab4","a4","bb4","b4","c5","db5","d5","eb5","e5","f5","gb5","g5","ab5","a5","bb5","b5","c6","db6","d6","eb6","e6","f6","gb6","g6","ab6","a6","bb6","b6","c7","db7","d7","eb7","e7","f7","gb7","g7","ab7","a7","bb7","b7","c8"],Vd=["a2","bb2","b2","c3","db3","d3","eb3","e3","f3","gb3","g3","ab3","a3","bb3","b3","c4","db4","d4","eb4","e4","f4","gb4","g4","ab4","a4","bb4","b4","c5","db5","d5","eb5","e5","f5","gb5","g5","ab5","a5","bb5","b5","c6","db6","d6","eb6","e6","f6","gb6","g6","ab6","a6","bb6","b6","c7","db7","d7","eb7","e7","f7"],Wd=["a4","bb4","b4","c5","db5","d5","eb5","e5","f5","gb5","g5","ab5","a5","bb5","b5","c6","db6","d6","eb6","e6","f6","gb6","g6","ab6","a6","bb6","b6","c7","db7","d7","eb7","e7","f7","gb7","g7","ab7","a7","bb7","b7"],Xd={grid:{x:8,y:8,max:32,plane:0,color:{r:255,g:255,b:255,a:255,rgb:16777215,str:"rgba(255,255,255,1)"},shadow:{show:!1,r:192,g:192,b:192,a:255,rgb:12632256,str:"rgba(192,192,192,1)",params:"0px 0px 64px 8px "},padLeft:0,padRight:0,ready:!1},status:{text:"",label:"",exec:null,color:{r:0,g:0,b:0,a:255,rgb:0,str:"rgba(0,0,0,1)"}},fader:{active:!1,kill:!1,r:0,g:0,b:0,rgb:null,tr:0,tg:0,tb:0,trgb:0,tstr:null,step:0,rate:0,onStep:null,onEnd:null,params:null},bead:{dirty:!0,active:!0,visible:!0,planes:null,color:{r:255,g:255,b:255,a:255,rgb:16777215,str:"rgba(255,255,255,1)"},bgColor:{r:255,g:255,b:255,a:0,rgb:16777215,str:"rgba(255,255,255,0)"},radius:0,scale:100,data:0,exec:null,border:{width:1,equal:!0,top:1,left:1,bottom:1,right:1,color:{r:128,g:128,b:128,a:255,rgb:8421504,str:"rgba(128,128,128,1)"}},glyph:{str:"",code:0,scale:100,size:0,x:0,y:0,font:null,color:{r:0,g:0,b:0,a:255,rgb:0,str:"rgba(0,0,0,1)"}}},audio:{volume:.5,max_volume:1,path:"http://alpheus.wpi.edu/~bmoriarty/ps/audio/",loop:!1,error_sound:"fx_uhoh"}},Yd={engine:"Perlenspiel",major:3,minor:1,revision:6,audio:null,host:{app:"",version:"",os:""},inputs:{touch:!1}},Zd=null,$d=null,_d=!1,ae=-1,be=null,ce=50,de=1,ee={rgb:0,r:0,g:0,b:0,str:""},fe=!0,ge=!1,he={rgb:0,r:0,g:0,b:0,str:""},ie={rgb:0,r:null,g:null,b:null,str:""};return cc.prototype={push:function(a){this.content.push(a),this.bubbleUp(this.content.length-1)},pop:function(){var a,b;return a=this.content[0],b=this.content.pop(),this.content.length>0&&(this.content[0]=b,this.sinkDown(0)),a},remove:function(a){var b,c,d;for(b=this.content.length,c=0;b>c;c+=1)if(this.content[c]===a){d=this.content.pop(),c!==b-1&&(this.content[c]=d,this.bubbleUp(c),this.sinkDown(c));break}},size:function(){var a;return a=this.content.length},bubbleUp:function(a){var b,c,d,e;for(b=this.content[a],c=this.scoreFunction(b);a>0&&(d=Math.floor((a+1)/2)-1,e=this.content[d],!(c>=this.scoreFunction(e)));)this.content[d]=b,this.content[a]=e,a=d},sinkDown:function(a){var b,c,d,e,f,g,h,i,j,k;for(b=this.content.length,c=this.content[a],d=this.scoreFunction(c);;){if(f=2*(a+1),e=f-1,g=null,b>e&&(h=this.content[e],i=this.scoreFunction(h),d>i&&(g=e)),b>f&&(j=this.content[f],k=this.scoreFunction(j),(null===g?d:i)>k&&(g=f)),null===g)break;this.content[a]=this.content[g],this.content[g]=c,a=g}},rescore:function(a){this.sinkDown(this.content.indexOf(a))}},tc={_lastTick:0,_clock:function(){Gc&&(window.requestAnimationFrame(tc._clock),I())},_sys:function(){var a,d,e,g,i,j,k,n,s,u,w,x,z,A,C,E,F,G,I;for(a="[PS.sys] ",String.fromCodePoint||(String.fromCodePoint=h),uc=[],uc.length=256,vc=[],vc.length=256,wc=[],wc.length=256,xc=[],xc.length=256,d=0;256>d;d+=1)uc[d]="rgba("+d+",",vc[d]=d+",",wc[d]=d+",1)",C=Math.floor(Jd*d*1e3)/1e3,xc[d]=C+")";if(sc(),Yc=screen.width/document.documentElement.clientWidth,Xc=rc(),Yd.inputs.touch=Xc,document.body.id="body",gd===PS.DEFAULT_NAMESPACE&&(document.body.style.backgroundColor=Xd.grid.color.str),$d=document.getElementById(ud),$d&&$d.parentNode.removeChild($d),e=document.getElementById(b),!e&&(e=document.createElement("div"),document.body.appendChild(e),!e))return console.error("No outer div!");if(e.id=sd,e.tabindex=12,e.className=hd,e.style.backgroundColor=Xd.grid.color.str,Zd=document.createElement("div"),!Zd)return console.error("No main div!");if(Zd.id=td,Zd.className=id,e.appendChild(Zd),tc._mainLeft=Zd.offsetLeft,tc._mainTop=Zd.offsetTop,i=document.createElement("p"),i.id=wd,i.className=kd,i.style.whiteSpace="nowrap",i.style.display="block",j=document.createTextNode("."),i.appendChild(j),Zd.appendChild(i),k=document.createElement("p"),k.id=xd,k.className=ld,k.style.display="none",s=document.createElement("span"),s.id=yd,s.className=md,n=document.createTextNode(""),s.appendChild(n),k.appendChild(s),s=document.createElement("span"),s.id=zd,s.className=nd,u=document.createElement("input"),u.id=Ad,u.className=od,u.type="text",u.tabindex=0,u.wrap="soft",s.appendChild(u),k.appendChild(s),Zd.appendChild(k),Ac={statusP:i,statusNode:j,inputP:k,inputNode:n,input:u,fader:D(wd,o,null)},f(Xd.status,Ac),oc("Perlenspiel 3.1"),w=document.createElement("canvas"),!w)return void window.alert(a+"HTML5 canvas not supported.");if(w.id=Bd,w.className=pd,w.width=Id,w.style.backgroundColor=Xd.grid.color.str,w.style.boxShadow="none",_c=!1,Z(),Zd.appendChild(w),x=document.createElement("p"),!x)return console.error("No footer p!");if(x.id=Cd,x.className=qd,x.style.opacity="1.0",x.innerHTML="Loading Perlenspiel",Zd.appendChild(x),cd=x,g=document.createElement("div"),!g)return console.error("No debug div!");if(g.id=vd,g.className=jd,Zd.appendChild(g),z=document.createElement("textarea"),!z)return console.error("No monitor textarea!");for(z.id=Dd,z.className=rd,z.rows=8,z.wrap="soft",z.readonly="readonly",z.onfocus=function(){bd=!0},z.onblur=function(){bd=!1},g.appendChild(z),ad=!1,bd=!1,Lc=!1,Pc=[],Mc=[],Nc=[],Oc=[],d=0;256>d;d+=1)Pc[d]=0,Mc[d]=d,Nc[d]=d,Oc[d]=d;for(Qc=[],Rc=!1,Sc=!1,Tc=!0,Vc=Od,Wc=5*Od,Mc[33]=PS.KEY_PAGE_UP,Mc[34]=PS.KEY_PAGE_DOWN,Mc[35]=PS.KEY_END,Mc[36]=PS.KEY_HOME,Mc[37]=PS.KEY_ARROW_LEFT,Mc[38]=PS.KEY_ARROW_UP,Mc[39]=PS.KEY_ARROW_RIGHT,Mc[40]=PS.KEY_ARROW_DOWN,Mc[45]=PS.KEY_INSERT,Mc[46]=PS.KEY_DELETE,Mc[188]=44,Mc[190]=46,Mc[191]=47,Mc[192]=96,Mc[219]=91,Mc[220]=92,Mc[221]=93,Mc[222]=39,Nc[96]=126,Nc[49]=33,Nc[50]=64,Nc[51]=35,Nc[52]=36,Nc[53]=37,Nc[54]=94,Nc[55]=38,Nc[56]=42,Nc[57]=40,Nc[48]=41,Nc[45]=95,Nc[61]=43,Nc[91]=123,Nc[93]=125,Nc[92]=124,Nc[59]=58,Nc[39]=34,Nc[44]=60,Nc[46]=62,Nc[47]=63,d=65;91>d;d+=1)Oc[d]=d+32;Oc[126]=96,Oc[33]=49,Oc[64]=50,Oc[35]=51,Oc[36]=52,Oc[37]=53,Oc[94]=54,Oc[38]=55,Oc[42]=56,Oc[40]=57,Oc[41]=48,Oc[95]=45,Oc[43]=51,Oc[123]=91,Oc[125]=93,Oc[124]=92,Oc[58]=59,Oc[34]=39,Oc[60]=44,Oc[62]=46,Oc[63]=47,window.onblur=gb(),A=w.getContext("2d"),A.constructor.prototype.fillRoundedRect||(A.constructor.prototype.fillRoundedRect=function(a,b,c,d,e,f,g){void 0===e&&(e=5),this.beginPath(),"Opera"===Yd.host.app?(this.moveTo(a+c-e,b),this.arcTo(a+e,b,a,b+e,e),this.arcTo(a,b+d-e,a+e,b+d,e),this.arcTo(a+c-e,b+d,a+c,b+d-e,e),this.arcTo(a+c,b+e,a+c-e,b,e)):(this.moveTo(a+e,b),this.arcTo(a+c,b,a+c,b+d,e),this.arcTo(a+c,b+d,a,b+d,e),this.arcTo(a,b+d,a,b,e),this.arcTo(a,b,a+c,b,e)),this.closePath(),g&&this.stroke(),(f||void 0===f)&&this.fill()}),yc={canvas:w,context:A,fader:D(Bd,l,m)},f(Xd.grid,yc);var J=window.getComputedStyle(yc.canvas,null);for(yc.padLeft=parseInt(J.getPropertyValue("padding-top").replace("px",""),10),yc.padRight=parseInt(J.getPropertyValue("padding-left").replace("px",""),10),zc=[],zc.length=C=Md,d=0;C>d;d+=1)E={index:d,fader:D(d,p,null),borderFader:D(d,q,null),glyphFader:D(d,r,null)},O(E),zc[d]=E;if(Ec=[],Fc=0,ed=[],fd=0,F=null,"iOS"!==Yd.host.os){if(F=AQ.init({defaultPath:Xd.audio.path,defaultFileTypes:["ogg","mp3","wav"],onAlert:PS.debug,stack:!0,forceHTML5:!0}),F===PS.ERROR||F.status===AQ.ERROR)return;Yd.audio=F,dd=null,G=PS.audioLoad(Xd.audio.error_sound,{path:Xd.audio.path,lock:!0}),G===PS.ERROR?v("Error sound '"+Xd.audio.error_sound+"' not loaded"):dd=Xd.audio.error_sound}if(Bc=document.createElement("canvas"),A=Bc.getContext("2d"),A.imageSmoothingEnabled=!1,A.mozImageSmoothingEnabled=!1,A.webkitImageSmoothingEnabled=!1,Cc=[],Dc=0,I="() event function undefined","function"!=typeof tc.init&&(tc.init=null,v("PS.init"+I)),"function"!=typeof tc.touch&&(tc.touch=null,v("PS.touch"+I)),"function"!=typeof tc.release&&(tc.release=null,v("PS.release"+I)),"function"!=typeof tc.enter&&(tc.enter=null,v("PS.enter"+I)),"function"!=typeof tc.exit&&(tc.exit=null,v("PS.exit()"+I)),"function"!=typeof tc.exitGrid&&(tc.exitGrid=null,v("PS.exitGrid"+I)),"function"!=typeof tc.keyDown&&(tc.keyDown=null,v("PS.keyDown"+I)),"function"!=typeof tc.keyUp&&(tc.keyUp=null,v("PS.keyUp"+I)),"function"!=typeof tc.input&&(tc.input=null,v("PS.input"+I)),I="PS "+Yd.major+"."+Yd.minor+"."+Yd.revision+" | ",F&&(I+=F.engine+" "+F.major+"."+F.minor+"."+F.revision+" | "),I+=Yd.host.os+" "+Yd.host.app+" "+Yd.host.version,Xc&&(I+=" | Touch "),x.innerHTML=I,ub(Xd.grid.x,Xd.grid.y),B(),H(),Gc=!0,tc._clock(),qb(),be=tc.timerStart(6,c),tc.init)try{tc.init(Yd,Nd),t()}catch(K){y("PS.init() failed ["+K.message+"]",K)}},shutdown:function(){console.info("Deactivating "+yc.canvas.id),Gc=!1,rb()},gridSize:function(a,b){var c,e,f,g;if(c="[PS.gridSize] ",arguments.length>2)return z(c+"Too many arguments");if(e=a,f=b,g=Xd.grid.max,e===PS.DEFAULT)e=Xd.grid.x;else if(e===PS.CURRENT)e=yc.x;else{if("number"!==d(e))return z(c+"x argument invalid");e=Math.floor(e),1>e?e=1:e>g&&(e=g)}if(f===PS.DEFAULT)f=Xd.grid.y;else if(f===PS.CURRENT)f=yc.y;else{if("number"!==d(f))return z(c+"y argument invalid");f=Math.floor(f),1>f?f=1:f>g&&(f=g)}return ub(e,f),{width:yc.x,height:yc.y}},gridPlane:function(a){var b,c,e;if(b="[PS.gridPlane] ",arguments.length>1)return z(b+"Too many arguments");if(c=a,e=d(c),"undefined"!==e&&c!==PS.CURRENT){if(c===PS.DEFAULT)c=0;else{if("number"!==e)return z(b+"plane argument invalid");c=Math.floor(c),1>c&&(c=0)}yc.plane=c}return yc.plane},gridColor:function(a,b,c){var d,e;return d="[PS.gridColor] ",arguments.length>3?z(d+"Too many arguments"):(e=M(d,a,b,c),e===PS.ERROR?PS.ERROR:sb(e))},gridFade:function(a,b){var c,e,f,g,h,i,j,k;if(c="[PS.gridFade] ",arguments.length>2)return z(c+"Too many arguments");if(f=yc.color,e=yc.fader,g=e.rate,j=d(a),"undefined"===j||a===PS.CURRENT)h=g;else if(a===PS.DEFAULT)h=Xd.fader.rate;else{if("number"!==j)return z(c+"rate argument invalid");h=Math.floor(a),0>h&&(h=0)}return i=Ab(c,b),i===PS.ERROR?PS.ERROR:(k=i.rgb,k!==PS.CURRENT&&(e.rgb=k===PS.DEFAULT?Xd.fader.rgb:k,e.r=i.r,e.g=i.g,e.b=i.b),k=i.onStep,k!==PS.CURRENT&&(e.onStep=k===PS.DEFAULT?Xd.fader.onStep:k),k=i.onEnd,k!==PS.CURRENT&&(e.onEnd=k===PS.DEFAULT?Xd.fader.onEnd:k),k=i.params,k!==PS.CURRENT&&(e.params=k===PS.DEFAULT?Xd.fader.params:k),g!==h&&(e.rate=h,1>h?(e.active=!1,e.kill=!0):e.active&&G(e,f.r,f.g,f.b,255)),{rate:e.rate,rgb:e.rgb,onStep:e.onStep,onEnd:e.onEnd,params:e.params})},gridShadow:function(a,b,c,e){var f,g,h;if(f="[PS.gridShadow] ",arguments.length>4)return z(f+"Too many arguments");if(g=a,g!==!0&&g!==!1&&g!==PS.CURRENT)if(null===g||g===PS.DEFAULT)g=!1;else{if("number"!==d(g))return z(f+"First argument invalid");g=0!==g}return h=M(f,b,c,e),h===PS.ERROR?PS.ERROR:tb(g,h)},color:function(a,b,c,d,e){var f,g,h;return f="[PS.color] ",g=arguments.length,2>g?z(f+"Missing argument(s)"):g>5?z(f+"Too many arguments"):(h=M(f,c,d,e),h===PS.ERROR?PS.ERROR:xb(f,yb,a,b,h))},alpha:function(a,b,c){var e,f,g,h;if(e="[PS.alpha] ",f=arguments.length,2>f)return z(e+"Missing argument(s)");if(f>3)return z(e+"Too many arguments");if(g=c,g!==PS.CURRENT)if(h=d(g),"undefined"===h)g=PS.CURRENT;else if("number"===h)g=Math.floor(g),0>g?g=0:g>255&&(g=255);else{if(g!==PS.DEFAULT)return z(e+"alpha argument invalid");g=Xd.bead.color.a}return xb(e,zb,a,b,g)},fade:function(a,b,c,e){var f,g,h,i,j;if(f="[PS.fade] ",g=arguments.length,2>g)return z(f+"Missing argument(s)");if(g>4)return z(f+"Too many arguments");if(h=c,h!==PS.CURRENT&&h!==PS.DEFAULT)if(i=d(h),"undefined"===i)h=PS.CURRENT;else{if("number"!==i)return z(f+"rate argument invalid");h=Math.floor(h),0>h&&(h=0)}return j=Ab(f,e),j===PS.ERROR?PS.ERROR:xb(f,Bb,a,b,h,j)},scale:function(a,b,c){var e,f,g,h;if(e="[PS.scale] ",f=arguments.length,2>f)return z(e+"Missing argument(s)");if(f>3)return z(e+"Too many arguments");if(g=c,g!==PS.CURRENT)if(h=d(g),"undefined"===h)g=PS.CURRENT;else if(g===PS.DEFAULT)g=100;else{if("number"!==h)return z(e+"scale parameter invalid");g=Math.floor(g),50>g?g=50:g>100&&(g=100)}return xb(e,Cb,a,b,g)},radius:function(a,b,c){var e,f,g,h;if(e="[PS.radius] ",f=arguments.length,2>f)return z(e+"Missing argument(s)");if(f>3)return z(e+"Too many arguments");if(g=c,g!==PS.CURRENT)if(h=d(g),"undefined"===h)g=PS.CURRENT;else if(g===PS.DEFAULT)g=0;else{if("number"!==h)return z(e+"radius parameter invalid");g=Math.floor(g),0>g?g=0:g>50&&(g=50)}return xb(e,Db,a,b,g)},bgColor:function(a,b,c,d,e){var f,g,h;return f="[PS.bgColor] ",g=arguments.length,2>g?z(f+"Missing argument(s)"):g>5?z(f+"Too many arguments"):(h=M(f,c,d,e),h===PS.ERROR?PS.ERROR:xb(f,Eb,a,b,h))},bgAlpha:function(a,b,c){var e,f,g,h;if(e="[PS.bgAlpha] ",f=arguments.length,2>f)return z(e+"Missing argument(s)");if(f>3)return z(e+"Too many arguments");if(g=c,g!==PS.CURRENT)if(h=d(g),"undefined"===h)g=PS.CURRENT;else if("number"===h)g=Math.floor(g),0>g?g=0:g>255&&(g=255);else{if(g!==PS.DEFAULT)return z(e+"alpha argument invalid");g=Xd.bead.bgColor.a}return xb(e,Fb,a,b,g)},data:function(a,b,c){var d,e,f;return d="[PS.data] ",e=arguments.length,2>e?z(d+"Missing argument(s)"):e>3?z(d+"Too many arguments"):(f=c,void 0===f?f=PS.CURRENT:f===PS.DEFAULT&&(f=null),xb(d,Gb,a,b,f))},exec:function(a,b,c){var e,f,g,h;if(e="[PS.exec] ",f=arguments.length,2>f)return z(e+"Missing argument(s)");if(f>3)return z(e+"Too many arguments");if(g=c,g!==PS.CURRENT)if(h=d(g),"undefined"===h)g=PS.CURRENT;else if(g===PS.DEFAULT)g=Xd.bead.exec;else if("function"!==h)return z(e+"exec argument invalid");return xb(e,Hb,a,b,g)},visible:function(a,b,c){var d,f,g;return d="[PS.visible] ",f=arguments.length,2>f?z(d+"Missing argument(s)"):f>3?z(d+"Too many arguments"):(g=e(c,PS.CURRENT,!0,PS.CURRENT),g===PS.ERROR?z(d+"show argument invalid"):xb(d,Ib,a,b,g))},active:function(a,b,c){var d,f,g;return d="[PS.active] ",f=arguments.length,2>f?z(d+"Missing argument(s)"):f>3?z(d+"Too many arguments"):(g=e(c,PS.CURRENT,!0,PS.CURRENT),g===PS.ERROR?z(d+"active argument invalid"):xb(d,Jb,a,b,g))},border:function(a,b,c){var e,f,g,h,i,j;if(e="[PS.border] ",f=arguments.length,2>f)return z(e+"Missing argument(s)");if(f>3)return z(e+"Too many arguments");if(g=Xd.bead.border,h=c,h!==PS.CURRENT)if(i=d(h),"undefined"===i)h=PS.CURRENT;else if(h===PS.DEFAULT)h=g.width;else if("number"===i)h=Math.floor(h),0>h&&(h=0);else{if("object"!==i)return z(e+"width argument invalid");if(j=h.top,j!==PS.CURRENT)if(i=d(j),"undefined"===i)h.top=PS.CURRENT;else if("number"===i)j=Math.floor(j),0>j&&(j=0),h.top=j;else{if(j!==PS.DEFAULT)return z(e+".top property invalid");h.top=g.top}if(j=h.left,j!==PS.CURRENT)if(i=d(j),"undefined"===i)h.left=PS.CURRENT;else if("number"===i)j=Math.floor(j),0>j&&(j=0),h.left=j;else{if(j!==PS.DEFAULT)return z(e+".left property invalid");h.left=g.left}if(j=h.bottom,j!==PS.CURRENT)if(i=d(j),"undefined"===i)h.bottom=PS.CURRENT;else if("number"===i)j=Math.floor(j),0>j&&(j=0),h.bottom=j;else{if(j!==PS.DEFAULT)return z(e+".bottom property invalid");h.bottom=g.bottom}if(j=h.right,j!==PS.CURRENT)if(i=d(j),"undefined"===i)h.right=PS.CURRENT;else if("number"===i)j=Math.floor(j),0>j&&(j=0),h.right=j;else{if(j!==PS.DEFAULT)return z(e+".right property invalid");h.right=g.right}}return xb(e,Kb,a,b,h)},borderColor:function(a,b,c,d,e){var f,g;return f="[PS.borderColor] ",arguments.length<2?z(f+"Missing argument(s)"):arguments.length>5?z(f+"Too many arguments"):(g=M(f,c,d,e),g===PS.ERROR?PS.ERROR:xb(f,Lb,a,b,g))},borderAlpha:function(a,b,c){var e,f,g,h;if(e="[PS.borderAlpha] ",f=arguments.length,2>f)return z(e+"Missing argument(s)");if(f>3)return z(e+"Too many arguments");if(g=c,g!==PS.CURRENT)if(h=d(g),"undefined"===h)g=PS.CURRENT;else if("number"===h)g=Math.floor(g),0>g?g=0:g>255&&(g=255);else{if(g!==PS.DEFAULT)return z(e+"alpha argument invalid");g=Xd.bead.border.color.a}return xb(e,Mb,a,b,g)},borderFade:function(a,b,c,e){var f,g,h,i,j;if(f="[PS.borderFade] ",g=arguments.length,2>g)return z(f+"Missing argument(s)");if(g>4)return z(f+"Too many arguments");if(h=c,h!==PS.CURRENT&&h!==PS.DEFAULT)if(i=d(h),"undefined"===i)h=PS.CURRENT;else{if("number"!==i)return z(f+"rate argument not a number");h=Math.floor(h),0>h&&(h=0)}return j=Ab(f,e),j===PS.ERROR?PS.ERROR:xb(f,Nb,a,b,h,j)},glyph:function(a,b,c){var e,f,g,h;if(e="[PS.glyph] ",f=arguments.length,2>f)return z(e+"Missing argument(s)");if(f>3)return z(e+"Too many arguments");if(g=c,g!==PS.CURRENT)if(h=d(g),"undefined"===h)g=PS.CURRENT;else if(g===PS.DEFAULT)g=0;else if("string"===h)g=g.length>0?g.charCodeAt(0):0;else{if("number"!==h)return z(e+"glyph argument invalid");g=Math.floor(g),1>g&&(g=0)}return xb(e,Ob,a,b,g)},glyphColor:function(a,b,c,d,e){var f,g;return f="[PS.glyphColor] ",arguments.length<2?z(f+"Missing argument(s)"):arguments.length>5?z(f+"Too many arguments"):(g=M(f,c,d,e),g===PS.ERROR?PS.ERROR:xb(f,Pb,a,b,g))},glyphAlpha:function(a,b,c){var e,f,g,h;if(e="[PS.glyphAlpha] ",f=arguments.length,2>f)return z(e+"Missing argument(s)");if(f>3)return z(e+"Too many arguments");if(g=c,g!==PS.CURRENT)if(h=d(g),"undefined"===h)g=PS.CURRENT;else if("number"===h)g=Math.floor(g),0>g?g=0:g>255&&(g=255);else{if(g!==PS.DEFAULT)return z(e+"alpha argument invalid");g=Xd.bead.glyph.color.a}return xb(e,Qb,a,b,g)},glyphScale:function(a,b,c){var e,f,g,h;if(e="[PS.glyphScale] ",f=arguments.length,2>f)return z(e+"Missing argument(s)");if(f>3)return z(e+"Too many arguments");if(g=c,g!==PS.CURRENT)if(h=d(g),"undefined"===h)g=PS.CURRENT;else if("number"===h)g=Math.floor(g),50>g?g=50:g>100&&(g=100);else{if(g!==PS.DEFAULT)return z(e+"scale argument invalid");g=Xd.bead.glyph.scale}return xb(e,Rb,a,b,g)},glyphFade:function(a,b,c,e){var f,g,h,i,j;if(f="[PS.glyphFade] ",g=arguments.length,2>g)return z(f+"Missing argument(s)");if(g>4)return z(f+"Too many arguments");if(h=c,h!==PS.CURRENT&&h!==PS.DEFAULT)if(i=d(h),"undefined"===i)h=PS.CURRENT;else{if("number"!==i)return z(f+"rate argument not a number");h=Math.floor(h),0>h&&(h=0)}return j=Ab(f,e),j===PS.ERROR?PS.ERROR:xb(f,Sb,a,b,h,j)},statusText:function(a){var b,c,e;return b="[PS.statusText] ",arguments.length>1?z(b+"Too many arguments"):(c=a,e=d(c),c!==PS.CURRENT&&"undefined"!==e&&(c===PS.DEFAULT?c=Xd.status.text:"string"!==e&&(c=c.toString()),oc(c)),Ac.text)},statusInput:function(a,b){var c,e,f,g;return c="[PS.statusInput] ",2!==arguments.length?z(c+"Expected 2 arguments"):"function"!=typeof b?z(c+"2nd argument is not a function"):(f=a,e=d(f),"string"!==e&&(f=f.toString()),g=f.length,g>Td&&(f=f.substring(0,Td)),qc(f,b),Ac.label)},statusColor:function(a,b,c){var d,e,g,h,i,j,k,l;return d="[PS.statusColor] ",arguments.length>3?z(d+"Too many arguments"):(e=M(d,a,b,c),e===PS.ERROR?PS.ERROR:(g=Ac.color,h=Ac.fader,i=e.rgb,i!==PS.CURRENT&&(null===i?(j=e.r,j===PS.CURRENT?e.r=j=g.r:j===PS.DEFAULT&&(e.r=j=Xd.status.color.r),k=e.g,k===PS.CURRENT?e.g=k=g.g:k===PS.DEFAULT&&(e.g=k=Xd.status.color.g),l=e.b,l===PS.CURRENT?e.b=l=g.b:l===PS.DEFAULT&&(e.b=l=Xd.status.color.b),e.rgb=j*Kd+k*Ld+l):i===PS.DEFAULT&&f(Xd.status.color,e),(g.rgb!==e.rgb||h.rate>0&&null!==h.rgb&&h.rgb!==e.rgb)&&(g.rgb=e.rgb,j=e.r,k=e.g,l=e.b,g.str=e.str=uc[j]+vc[k]+wc[l],h.rate>0?(null!==h.rgb&&F(h,h.r,h.g,h.b,255,j,k,l,255),h.active?G(h,j,k,l,255):F(h,g.r,g.g,g.b,255,j,k,l,255)):o(g),g.r=j,g.g=k,g.b=l)),g.rgb))},statusFade:function(a,b){var c,e,f,g,h,i,j,k;if(c="[PS.statusFade] ",arguments.length>2)return z(c+"Too many arguments");if(f=Ac.color,e=Ac.fader,g=e.rate,i=d(a),"undefined"===i||a===PS.CURRENT)h=g;else if(a===PS.DEFAULT)h=Xd.fader.rate;else{if("number"!==i)return z(c+"rate argument invalid");h=Math.floor(a),0>h&&(h=0)}return k=Ab(c,b),k===PS.ERROR?PS.ERROR:(j=k.rgb,j!==PS.CURRENT&&(e.rgb=j===PS.DEFAULT?Xd.fader.rgb:j,e.r=k.r,e.g=k.g,e.b=k.b),j=k.onStep,j!==PS.CURRENT&&(e.onStep=j===PS.DEFAULT?Xd.fader.onStep:j),j=k.onEnd,j!==PS.CURRENT&&(e.onEnd=j===PS.DEFAULT?Xd.fader.onEnd:j),j=k.params,j!==PS.CURRENT&&(e.params=j===PS.DEFAULT?Xd.fader.params:j),g!==h&&(e.rate=h,1>h?(e.active=!1,e.kill=!0):e.active&&G(e,f.r,f.g,f.b,255)),{rate:e.rate,rgb:e.rgb,onStep:e.onStep,onEnd:e.onEnd,params:e.params})},timerStart:function(a,b){var c,e,f,g,h,i,j,k,l,m;if(c="[PS.timerStart] ",e=arguments.length,2>e)return z(c+"Argument(s) missing");if(f=a,g=b,f===PS.DEFAULT)f=60;else{if(h=d(f),"number"!==h)return z(c+"ticks argument invalid");if(f=Math.floor(f),1>f)return z(c+"ticks argument less than one (1)")}if("function"!=typeof g)return z(c+"exec argument not a function");if(j=[],e>2)for(l=e-2,j.length=l,k=0;l>k;k+=1)j[k]=arguments[k+2];return m=Hd+Ic,Ic+=1,i={id:m,delay:f,count:f,exec:g,arglist:j},Hc.push(i),m},timerStop:function(a){var b,c,d,e,f;if(b="[PS.timerStop] ",c=arguments.length,1>c)return z(b+"Argument missing");if("string"!=typeof a||a.length<1)return z(b+"id argument invalid");for(e=Hc.length,d=0;e>d;d+=1)if(f=Hc[d],f.id===a)return Hc.splice(d,1),a;return z(b+"timer id '"+a+"' not found")},random:function(a){var b,c;return b="[PS.random] ",arguments.length<1?z(b+"Argument missing"):(c=a,"number"!==d(c)?z(b+"Argument not a number"):(c=Math.floor(c),2>c?1:(c=Math.random()*c,c=Math.floor(c)+1)))},makeRGB:function(a,b,c){var e,f,g,h,i;return e="[PS.makeRGB] ",f=arguments.length,3>f?z(e+"Argument(s) missing"):f>3?z(e+"Too many arguments"):(g=a,h=b,i=c,"number"!==d(g)?z(e+"r argument not a number"):(g=Math.floor(g),0>g?g=0:g>255&&(g=255),"number"!==d(h)?z(e+"g argument not a number"):(h=Math.floor(h),0>h?h=0:h>255&&(h=255),"number"!==d(i)?z(e+"b argument not a number"):(i=Math.floor(i),0>i?i=0:i>255&&(i=255),g*Kd+h*Ld+i))))},unmakeRGB:function(a,b){var c,e,f,g,h,i,j,k,l,m;if(c="[PS.unmakeRGB] ",e=arguments.length,2>e)return z(c+"Missing argument(s)");if(e>2)return z(c+"Too many arguments");if(f=a,g=b,"number"!==d(f))return z(c+"rgb argument not a number");if(f=Math.floor(f),1>f?(f=0,h=0,i=0,j=0):f>=16777215?(f=16777215,h=255,i=255,j=255):(h=f/Kd,h=Math.floor(h),k=h*Kd,i=(f-k)/Ld,i=Math.floor(i),l=i*Ld,j=f-k-l),m=d(g),"object"===m)g.rgb=f,g.r=h,g.g=i,g.b=j;else{if("array"!==m)return z(c+"result argument not an array or object reference");g.length<3&&(g.length=3),g[0]=h,g[1]=i,g[2]=j}return g},applyRect:function(a,b,c,e,f){var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;if(g="[PS.applyRect] ",h=arguments.length,5>h)return z(g+"Argument(s) missing");if(i=yc.x,j=yc.y,k=a,l=b,m=c,n=e,o=f,k===PS.DEFAULT)k=0;else{if("number"!==d(k))return z(g+"left argument invalid");if(k=Math.floor(k),k>=i)return PS.DONE;0>k&&(k=0)}if(l===PS.DEFAULT)l=0;else{if("number"!==d(l))return z(g+"top argument invalid");if(l=Math.floor(l),l>=j)return PS.DONE;0>l&&(l=0)}if(m===PS.DEFAULT)m=i-k;else{if("number"!==d(m))return z(g+"width argument invalid");if(m=Math.floor(m),1>m)return PS.DONE;k+m>i&&(m=i-k)}if(p=k+m,n===PS.DEFAULT)n=j-l;else{if("number"!==d(n))return z(g+"height argument invalid");if(n=Math.floor(n),1>n)return PS.DONE;l+n>j&&(n=j-l)}if(q=l+n,!o||"function"!=typeof o)return z(g+"exec argument not a function");if(u=[0,0],h>5)for(v=h-5,w=0;v>w;w+=1)u.push(arguments[w+5]);for(s=l;q>s;s+=1)for(u[1]=s,r=k;p>r;r+=1){u[0]=r;try{t=o.apply(Nd,u)}catch(x){t=y(g+"exec failed @"+r+", "+s+" ["+x.message+"]",x)
}if(t===PS.ERROR)return PS.ERROR}return t},hex:function(a,b){var c,e,f,g,h;if(c="[PS.hex] ",e=a,f=d(e),"number"!==f)return z(c+"value argument invalid");if(e=Math.floor(e),e=Math.abs(e),g=b,f=d(g),"undefined"===f||g===PS.DEFAULT)g=2;else{if("number"!==f)return z(c+"padding argument invalid");g=Math.floor(g),1>g&&(g=1)}for(h=Number(e).toString(16);h.length<g;)h="0"+h;return"0x"+h},keyRepeat:function(a,b,c){var f,g,h,i,j;if(f="[PS.keyRepeat] ",h=e(a,Tc,!0,!0),h===PS.ERROR)return z(f+"repeat argument invalid");if(j=b,g=d(j),"undefined"===g||j===PS.DEFAULT)j=5*Od;else if(j===PS.CURRENT)j=Wc;else{if("number"!==g)return z(f+"init argument invalid");j=Math.floor(j),1>j&&(j=1)}if(i=c,g=d(i),"undefined"===g||i===PS.DEFAULT)i=Od;else if(i===PS.CURRENT)i=Vc;else{if("number"!==g)return z(f+"delay argument invalid");i=Math.floor(i),1>i&&(i=1)}return Tc=h,Wc=j,Vc=i,{repeat:Tc,init:Wc,delay:Vc}},imageLoad:function(a,b,c){var e,f,g,h,i,j,k,l,m;if(e="[PS.imageLoad] ",f=arguments.length,2>f)return z(e+"Missing argument(s)");if(f>3)return z(e+"Too many argument(s)");if(g=a,h=b,i=c,"string"!=typeof g||g.length<1)return z(e+"filename argument invalid");if(j=g.substr(g.lastIndexOf(".")+1),j=j.toLowerCase(),"png"!==j&&"jpg"!==j&&"jpeg"!==j&&"bmp"!==j)return z(e+"filename extension invalid");if("function"!=typeof h)return z(e+"exec argument invalid");if(m=d(i),"undefined"===m||i===PS.DEFAULT)i=4;else{if("number"!==m)return z(e+"format argument invalid");if(i=Math.floor(i),1>i&&i>4)return z(e+"format argument is not 1, 2, 3 or 4")}l=Ed+Dc,Dc+=1,Cc.push({source:g,id:l,exec:h,format:i});try{k=new Image,k.setAttribute("data-id",l),k.onload=function(){Vb(k)},k.onerror=function(){Tb(k)},k.src=g}catch(n){return y(e+"Error loading "+g+" ["+n.message+"]",n)}return l},imageBlit:function(a,b,c,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,u,v,w,x,y,A,B,C,D,E,F,G,H,I,K,L,M,N,O,Q,R,S,T;if(f="[PS.imageBlit] ",g=arguments.length,3>g)return z(f+"Missing argument(s)");if(g>4)return z(f+"Too many arguments");if(h=yc.x,i=yc.y,j=a,k=b,l=c,m=e,Wb(f,j)===PS.ERROR)return PS.ERROR;if(n=j.width,o=j.height,p=j.pixelSize,q=j.data,r=d(k),"undefined"===r||k===PS.DEFAULT)k=0;else{if("number"!==r)return z(f+"xpos argument invalid");k=Math.floor(k)}if(r=d(l),"undefined"===r||l===PS.DEFAULT)l=0;else{if("number"!==r)return z(f+"ypos argument invalid");l=Math.floor(l)}if(k>=h||l>=i||1>k+n||1>l+o)return!1;if(r=d(m),"undefined"===r||m===PS.DEFAULT)s=0,u=0,v=n,w=o;else{if("object"!==r)return z(f+"region argument invalid");if(u=m.left,r=d(u),"undefined"===r||u===PS.DEFAULT)u=0;else{if("number"!==r)return z(f+"region.left invalid");if(u=Math.floor(u),0>u)u=0;else if(u>=n)return z(f+"region.left outside image")}if(s=m.top,r=d(s),"undefined"===r||s===PS.DEFAULT)s=0;else{if("number"!==r)return z(f+"region.top invalid");if(s=Math.floor(s),0>s)s=0;else if(s>=o)return z(f+"region.top outside image")}if(v=m.width,r=d(v),"undefined"===r||v===PS.DEFAULT)v=n-u;else{if("number"!==r)return z(f+"region.width invalid");if(v=Math.floor(v),1>v)return!1;u+v>n&&(v=n-u)}if(1>k+v)return!1;if(w=m.height,r=d(w),"undefined"===r||w===PS.DEFAULT)w=o-s;else{if("number"!==r)return z(f+"region.height invalid");if(w=Math.floor(w),1>w)return!1;s+w>o&&(w=o-s)}if(1>l+w)return!1}if(0>k){if(v+=k,1>v)return!1;u-=k,k=0}if(y=k+v,y>h&&(v=h-k),1>v)return!1;if(0>l){if(w+=l,1>w)return!1;s-=l,l=0}if(y=l+w,y>i&&(w=i-l),1>w)return!1;for(A=n*p,T=!1,L=255,x=yc.plane,B=s*A+u*p,E=l,F=0;w>F;F+=1){for(C=B,D=k,G=0;v>G;G+=1)Q=D+E*h,R=zc[Q],R.active&&(T=!0,3>p?(M=q[C],H=M/Kd,H=Math.floor(H),N=H*Kd,I=(M-N)/Ld,I=Math.floor(I),O=I*Ld,K=M-N-O,2===p&&(L=q[C+1])):(H=q[C],I=q[C+1],K=q[C+2],M=H*Kd+I*Ld+K,4===p&&(L=q[C+3])),S=P(R,x),S.r=H,S.g=I,S.b=K,S.a=L,S.rgb=M,J(R)),D+=1,C+=p;E+=1,B+=A}return T&&t(),!0},imageCapture:function(a,b){var c,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,A;if(c="[PS.imageCapture] ",e=arguments.length,e>2)return z(c+"Too many arguments");if(f=a,g=b,h=d(f),"undefined"===h||f===PS.DEFAULT)f=3;else{if("number"!==h)return z(c+"format argument invalid");if(f=Math.floor(f),1>f&&f>4)return z(c+"format argument is not 1, 2, 3 or 4")}if(i=yc.x,j=yc.y,h=d(g),"undefined"===h||g===PS.DEFAULT)l=0,m=0,n=i,o=j;else{if("object"!==h)return z(c+"region argument invalid");if(m=g.left,h=d(m),"undefined"===h||m===PS.DEFAULT)m=0;else{if("number"!==h)return z(c+"region.left not a number");if(m=Math.floor(m),0>m)m=0;else if(m>=i)return z(c+"region.left outside grid")}if(l=g.top,h=d(l),"undefined"===h||l===PS.DEFAULT)l=0;else{if("number"!==h)return z(c+"region.top not a number");if(l=Math.floor(l),0>l)l=0;else if(l>=j)return z(c+"region.top outside grid")}if(n=g.width,h=d(n),"undefined"===h||n===PS.DEFAULT)n=i-m;else{if("number"!==h)return z(c+"region.width not a number");n=Math.floor(n),(1>n||m+n>i)&&(n=i-m)}if(o=g.height,h=d(o),"undefined"===h||o===PS.DEFAULT)o=j-l;else{if("number"!==h)return z(c+"region.height not a number");o=Math.floor(o),(1>o||l+o>j)&&(o=j-l)}}if(t=Ed+Dc,Dc+=1,q={source:PS.GRID,id:t,width:n,height:o,pixelSize:f,valid:!0,data:[]},p=n*o,1>p)return q;for(k=q.data,k.length=p*f,r=m+n,s=l+o,u=0,w=l;s>w;w+=1)for(v=m;r>v;v+=1)x=v+w*i,y=zc[x],A=y.color,3>f?(k[u]=A.rgb,2===f&&(k[u+1]=A.a)):(k[u]=A.r,k[u+1]=A.g,k[u+2]=A.b,4===f&&(k[u+3]=A.a)),u+=f;return q},imageDump:function(a,b,c,f,g){var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,A,B,C,D,E,F,G,H,I,J,K,L,M,N;if(h="[PS.imageDump] ",i=arguments.length,1>i)return z(h+"Missing argument(s)");if(i>5)return z(h+"Too many arguments");if(j=a,k=b,l=c,m=f,Wb(h,j)===PS.ERROR)return PS.ERROR;if(o=j.width,p=j.height,q=j.pixelSize,r=j.data,s=d(k),"undefined"===s||k===PS.DEFAULT)t=0,u=0,v=o,w=p;else{if("object"!==s)return z(h+"region argument invalid");if(u=k.left,s=d(u),"undefined"===s||u===PS.DEFAULT)u=0;else{if("number"!==s)return z(h+"region.left invalid");if(u=Math.floor(u),0>u)u=0;else if(u>=o)return z(h+"region.left outside grid")}if(t=k.top,s=d(t),"undefined"===s||t===PS.DEFAULT)t=0;else{if("number"!==s)return z(h+"region.top invalid");if(t=Math.floor(t),0>t)t=0;else if(t>=p)return z(h+"region.top outside grid")}if(v=k.width,s=d(v),"undefined"===s||v===PS.DEFAULT)v=o-u;else{if("number"!==s)return z(h+"region.width invalid");v=Math.floor(v),(1>v||u+v>o)&&(v=o-u)}if(w=k.height,s=d(w),"undefined"===s||w===PS.DEFAULT)w=p-t;else{if("number"!==s)return z(h+"region.height invalid");w=Math.floor(w),(1>w||t+w>p)&&(w=p-t)}}if(x=v*w,s=d(l),"undefined"===s||l===PS.DEFAULT)l=q;else{if("number"!==s)return z(h+"format argument invalid");if(l=Math.floor(l),1>l||l>4)return z(h+"format argument is not 1, 2, 3 or 4")}if(s=d(m),"undefined"===s||m===PS.DEFAULT)m=v;else{if("number"!==s)return z(h+"length argument invalid");m=Math.floor(m),1>m&&(m=1),m>x&&(m=x)}if(n=e(g,PS.ERROR,!0,!0),n===PS.ERROR)return z(h+"hex argument invalid");if(y="\nvar myImage = {\n	width : "+v+", height : "+w+", pixelSize : "+l+",\n	data : [",1>x)return y+="]\n};\n",tc.debug(y),PS.DONE;for(y+="\n	",D=255,C=B=0,A=o*q,E=t*A+u*q,G=0;w>G;G+=1){for(F=E,H=0;v>H;H+=1)3>q?(L=r[F],1>L?I=J=K=0:L>=16777215?I=J=K=255:(I=L/Kd,I=Math.floor(I),M=I*Kd,J=(L-M)/Ld,J=Math.floor(J),N=J*Ld,K=L-M-N),2===q&&(D=r[F+1])):(I=r[F],J=r[F+1],K=r[F+2],L=I*Kd+J*Ld+K,4===q&&(D=r[F+3])),y+=Yb(l,n,L,I,J,K,D),C+=1,x>C&&(y+=",",B+=1,m>B?y+=" ":(B=0,y+="\n	")),F+=q;E+=A}return y+="\n	]\n};\n",tc.debug(y),PS.DONE},spriteSolid:function(a,b){var c,e,f,g,h;if(c="[PS.spriteSolid] ",e=arguments.length,2>e)return z(c+"Missing argument(s)");if(e>2)return z(c+"Too many argument(s)");if(f=a,g=b,f===PS.DEFAULT)f=1;else{if("number"!==d(f))return z(c+"width argument invalid");f=Math.floor(f),1>f&&(f=1)}if(g===PS.DEFAULT)g=1;else{if("number"!==d(g))return z(c+"height argument invalid");g=Math.floor(g),1>g&&(g=1)}return h=Zb(),h.width=f,h.height=g,h.color={rgb:0,r:0,g:0,b:0,a:255},h.id},spriteSolidColor:function(a,b,c,d){var e,f,g,h,i,j,k,l,m;return e="[PS.spriteSolidColor] ",f=arguments.length,1>f?z(e+"Missing argument(s)"):f>4?z(e+"Too many argument(s)"):(g=$b(a,e),g===PS.ERROR?PS.ERROR:(i=g.color)?(h=M(e,b,c,d),h===PS.ERROR?PS.ERROR:(j=h.rgb,j!==PS.CURRENT&&(null===j?(k=h.r,k===PS.CURRENT?h.r=k=i.r:k===PS.DEFAULT&&(h.r=k=0),l=h.g,l===PS.CURRENT?h.g=l=i.g:l===PS.DEFAULT&&(h.g=l=0),m=h.b,m===PS.CURRENT?h.b=m=i.b:m===PS.DEFAULT&&(h.b=m=0),h.rgb=j=k*Kd+l*Ld+m):j===PS.DEFAULT&&(h.rgb=j=0,h.r=0,h.g=0,h.b=0),i.rgb!==j&&(i.rgb=j,i.r=h.r,i.g=h.g,i.b=h.b,g.visible&&g.placed&&(ac(g),t()))),i.rgb)):z(e+"Cannot set color of image sprite "+g.id))},spriteSolidAlpha:function(a,b){var c,e,f,g,h,i,j;if(c="[PS.spriteSolidAlpha] ",e=arguments.length,1>e)return z(c+"Missing argument(s)");if(e>2)return z(c+"Too many argument(s)");if(f=a,g=b,h=$b(f,c),h===PS.ERROR)return PS.ERROR;if(i=h.color,!i)return z(c+"Cannot set alpha of image sprite "+h.id);if(j=d(g),"undefined"!==j&&g!==PS.CURRENT){if(g===PS.DEFAULT)g=255;else{if("number"!==j)return z(c+"alpha argument invalid");g=Math.floor(g),0>g?g=0:g>255&&(g=255)}i.a!==g&&(i.a=g,h.visible&&h.placed&&(ac(h),t()))}return i.a},spriteImage:function(a,b){var c,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,A,B,C,D;if(c="[PS.spriteImage] ",e=arguments.length,1>e)return z(c+"Missing argument(s)");if(e>2)return z(c+"Too many argument(s)");if(Wb(c,a)===PS.ERROR)return PS.ERROR;if(l=k=0,m=f=a.width,n=g=a.height,h=a.pixelSize,i=a.data,j=d(b),"undefined"!==j&&b!==PS.DEFAULT){if("object"!==j)return z(c+"region argument invalid");if(l=b.left,j=d(l),"undefined"===j||l===PS.DEFAULT)l=0;else{if("number"!==j)return z(c+"region.left invalid");if(l=Math.floor(l),0>l)l=0;else if(l>=f)return z(c+"region.left outside image")}if(k=b.top,j=d(k),"undefined"===j||k===PS.DEFAULT)k=0;else{if("number"!==j)return z(c+"region.top invalid");if(k=Math.floor(k),0>k)k=0;else if(k>=g)return z(c+"region.top outside image")}if(m=b.width,j=d(m),"undefined"===j||m===PS.DEFAULT)m=f-l;else{if("number"!==j)return z(c+"region.width invalid");m=Math.floor(m),(1>m||l+m>f)&&(m=f-l)}if(n=b.height,j=d(n),"undefined"===j||n===PS.DEFAULT)n=g-k;else{if("number"!==j)return z(c+"region.height invalid");n=Math.floor(n),(1>n||k+n>g)&&(n=g-k)}}for(o=[],o.length=m*n*4,A=255,p=f*h,q=k*p+l*h,u=0,t=0;n>t;t+=1){for(r=q,s=0;m>s;s+=1)3>h?(v=i[r],1>v?v=w=x=y=0:v>=16777215?(v=16777215,w=x=y=255):(w=v/Kd,w=Math.floor(w),B=w*Kd,x=(v-B)/Ld,x=Math.floor(x),C=x*Ld,y=v-B-C),2===h&&(A=i[r+1])):(w=i[r],x=i[r+1],y=i[r+2],4===h&&(A=i[r+3])),o[u]=w,o[u+1]=x,o[u+2]=y,o[u+3]=A,r+=h,u+=4;q+=p}return D=Zb(),D.width=m,D.height=n,D.image={id:Ed+Dc,width:m,height:n,pixelSize:4,data:o},Dc+=1,D.id},spriteShow:function(a,b){var c,d,f,g,h;return c="[PS.spriteShow] ",d=arguments.length,1>d?z(c+"Missing argument(s)"):d>2?z(c+"Too many argument(s)"):(f=a,h=$b(f,c),h===PS.ERROR?PS.ERROR:(g=e(b,PS.CURRENT,!0,PS.CURRENT),g===PS.ERROR?z(c+"show argument invalid"):(g!==PS.CURRENT&&h.visible!==g&&(h.visible=g,h.placed&&(g?(ac(h),bc(h,f)):_b(h),t())),h.visible)))},spriteAxis:function(a,b,c){var e,f,g,h,i,j,k;if(e="[PS.spriteAxis] ",f=arguments.length,1>f)return z(e+"Missing argument(s)");if(f>3)return z(e+"Too many argument(s)");if(g=a,h=b,i=c,j=$b(g,e),j===PS.ERROR)return PS.ERROR;if(k=d(h),"undefined"===k||h===PS.CURRENT)h=j.ax;else if(h===PS.DEFAULT)h=0;else{if("number"!==k)return z(e+"x argument invalid");h=Math.floor(h)}if(k=d(i),"undefined"===k||i===PS.CURRENT)i=j.ay;else if(i===PS.DEFAULT)i=0;else{if("number"!==k)return z(e+"y argument invalid");i=Math.floor(i)}return(h!==j.ax||i!==j.ay)&&(j.ax=h,j.ay=i,j.visible&&j.placed&&(ac(j),bc(j,g),t())),{x:j.ax,y:j.ay}},spritePlane:function(a,b){var c,e,f,g,h,i;if(c="[PS.spritePlane] ",e=arguments.length,1>e)return z(c+"Missing argument(s)");if(e>2)return z(c+"Too many arguments");if(f=a,g=b,h=$b(f,c),h===PS.ERROR)return PS.ERROR;if(i=d(g),"undefined"!==i&&g!==PS.CURRENT){if(g===PS.DEFAULT)g=0;else{if("number"!==i)return z(c+"plane argument invalid");g=Math.floor(g),1>g&&(g=0)}h.plane!==g&&(h.visible&&h.placed&&_b(h),h.plane=g,h.visible&&h.placed&&(ac(h),t()))}return h.plane<0?0:h.plane},spriteMove:function(a,b,c){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,u;if(e="[PS.spriteMove] ",f=arguments.length,1>f)return z(e+"Missing argument(s)");if(f>3)return z(e+"Too many argument(s)");if(g=a,h=b,i=c,j=$b(g,e),j===PS.ERROR)return PS.ERROR;if(k=d(h),"undefined"===k||h===PS.CURRENT)h=j.x;else if(h===PS.DEFAULT)h=0;else{if("number"!==k)return z(e+"x argument invalid");h=Math.floor(h)}if(k=d(i),"undefined"===k||i===PS.CURRENT)i=j.y;else if(i===PS.DEFAULT)i=0;else{if("number"!==k)return z(e+"y argument invalid");i=Math.floor(i)}return j.placed&&h===j.x&&i===j.y||(u=!1,j.plane<0&&(j.plane=yc.plane),j.visible&&j.placed&&(m=j.y,o=j.height,h>j.x?(n=h-j.x,l=j.x):j.x>h?(n=j.x-h,l=j.x+j.width-n):n=0,n>=j.width?(u=!0,_b(j)):(p=j.x,r=j.width,i>j.y?(s=i-j.y,q=j.y):j.y>i?(s=j.y-i,q=j.y+j.height-s):s=0,s>=j.height?(u=!0,_b(j)):1>s?(u=!0,_b(j,l,m,n,o)):1>r?(u=!0,_b(j,p,q,r,s)):(u=!0,r-=n,h>j.x&&(p+=n),_b(j,l,m,n,o),_b(j,p,q,r,s)))),j.x=h,j.y=i,j.placed=!0,j.visible&&(u=!0,ac(j),bc(j,g)),u&&t()),{x:j.x,y:j.y}},spriteCollide:function(a,b){var c,e,f,g,h;if(c="[PS.spriteCollide] ",e=arguments.length,1>e)return z(c+"Missing argument(s)");if(e>2)return z(c+"Too many arguments");if(f=$b(a,c),f===PS.ERROR)return PS.ERROR;if(g=b,h=d(g),"undefined"!==h&&g!==PS.CURRENT){if(g===PS.DEFAULT)g=null;else if("function"!==h)return z(c+"exec argument not a function");f.collide!==g&&(f.collide=g,g&&f.visible&&f.placed&&bc(f,a))}return f.collide},spriteDelete:function(a){var b,c,d,e,f;if(b="[PS.spriteDelete] ",c=arguments.length,1>c)return z(b+"Missing argument");if(c>1)return z(b+"Too many arguments");if("string"!=typeof a||a.length<1)return z(b+"sprite argument invalid");for(d=Ec.length,e=0;d>e;e+=1)if(f=Ec[e],f.id===a)return _b(f),Ec.splice(e,1),t(),PS.DONE;return z(b+"sprite id '"+a+"' not found")},audioLoad:function(a,b){var c,d;return c="[PS.audioLoad] ",arguments.length<1?z(c+"Missing argument(s)"):arguments.length>2?z(c+"Too many arguments"):(d=AQ.load(a,b),d===AQ.ERROR?PS.ERROR:d.channel)},audioPlay:function(a,b){var c,e,f,g,h,i;if(c="[PS.audioPlay] ",e=arguments.length,1>e)return z(c+"Missing argument(s)");if(e>2)return z(c+"Too many arguments");if(f=a,g=b,h=d(g),"undefined"===h)g={};else if("object"!==h)return z(c+"params argument invalid");return g.autoplay=!0,i=AQ.load(f,g),i===AQ.ERROR?PS.ERROR:i.channel},audioPause:function(a){var b,c,d;return b="[PS.audioPause] ",c=arguments.length,1>c?z(b+"Missing argument(s)"):c>1?z(b+"Too many arguments"):(d=AQ.pause(a),d===AQ.ERROR?PS.ERROR:d)},audioStop:function(a){var b,c,d;return b="[PS.audioStop] ",c=arguments.length,1>c?z(b+"Missing argument(s)"):c>1?z(b+"Too many arguments"):(d=AQ.stop(a),d===AQ.ERROR?PS.ERROR:d===AQ.DONE?PS.DONE:d)},piano:function(a,b){var c,e,f,g,h,i;if(c="[PS.piano] ",e=Ud.length,g=a,f=d(g),"number"!==f)return z(c+"index argument invalid");if(g=Math.floor(g),1>g?g=1:g>e&&(g=e),h=b,h!==!0&&h!==!1)if(f=d(h),"undefined"===f)h=!1;else if("number"!==f)return z(c+"flag argument invalid");return i="piano_"+Ud[g-1],h&&(i="l_"+i),i},harpsichord:function(a,b){var c,e,f,g,h,i;if(c="[PS.harpsichord] ",e=Vd.length,g=a,f=d(g),"number"!==f)return z(c+"index argument invalid");if(g=Math.floor(g),1>g?g=1:g>e&&(g=e),h=b,h!==!0&&h!==!1)if(f=d(h),"undefined"===f)h=!1;else if("number"!==f)return z(c+"flag argument invalid");return i="hchord_"+Vd[g-1],h&&(i="l_"+i),i},xylophone:function(a){var b,c,e,f,g;return b="[PS.xylophone] ",c=Wd.length,f=a,e=d(f),"number"!==e?z(b+"index argument invalid"):(f=Math.floor(f),1>f?f=1:f>c&&(f=c),g="xylo_"+Wd[f-1])},debug:function(a){var b,c,e,f;return b="[PS.debug] ",arguments.length>1?z(b+"Too many arguments"):(c=a,e=d(c),"undefined"===e?c="":"string"!==e&&(c=c.toString()),u(),c.length>0&&(f=document.getElementById(Dd),f.value+=c,f.scrollTop=f.scrollHeight),A(),PS.DONE)},debugClose:function(){var a,b;return a="[PS.debugClose] ",arguments.length>0?z(a+"Too many arguments"):(b=document.getElementById(vd),b.style.display="none",ad=!1,PS.DONE)},debugClear:function(){var a,b;return a="[PS.debugClear] ",arguments.length>0?z(a+"Too many arguments"):(b=document.getElementById(Dd),b.value="",PS.DONE)},line:function(a,b,c,e){var f,g,h,i,j,k,l;return f="[PS.line] ",g=arguments.length,4>g?z(f+"Missing argument(s)"):g>4?z(f+"Too many arguments"):(h=a,i=b,j=c,k=e,"number"!==d(h)?z(f+"x1 argument not a number"):(h=Math.floor(h),"number"!==d(i)?z(f+"y1 argument not a number"):(i=Math.floor(i),"number"!==d(j)?z(f+"x2 argument not a number"):(j=Math.floor(j),"number"!==d(k)?z(f+"y2 argument not a number"):(k=Math.floor(k),l=dc(h,i,j,k))))))},pathMap:function(a){var b,c,d;return b="[PS.pathMap] ",c=arguments.length,1>c?z(b+"Missing argument(s)"):c>1?z(b+"Too many arguments"):Wb(b,a)===PS.ERROR?PS.ERROR:1!==a.pixelSize?z(b+"image is not format 1"):(d=kc(a.width,a.height,a.data),d.id)},pathFind:function(a,b,c,e,f,g){var h,i,j,k,l,m,n,o,p,q,r,s,t,u;if(h="[PS.pathFind] ",i=arguments.length,5>i)return z(h+"Missing argument(s)");if(i>6)return z(h+"Too many arguments");if(j=a,k=b,l=c,m=e,n=f,o=g,"string"!=typeof j||j.length<1)return z(h+"pathmap argument invalid");if(p=lc(j),!p)return z(h+j+" not found");if("number"!==d(k))return z(h+"x1 argument not a number");if(k=Math.floor(k),0>k||k>=p.width)return z(h+"x1 argument is outside "+j);if("number"!==d(l))return z(h+"y1 argument not a number");if(l=Math.floor(l),0>l||l>=p.height)return z(h+"y1 argument is outside "+j);if("number"!==d(m))return z(h+"x2 argument not a number");if(m=Math.floor(m),0>m||m>=p.width)return z(h+"x2 argument is outside "+j);if("number"!==d(n))return z(h+"y2 argument not a number");if(n=Math.floor(n),0>n||n>=p.height)return z(h+"y2 argument is outside "+j);if(t=!1,u=!1,q=d(o),"undefined"!==q&&o!==PS.DEFAULT){if("object"!==q)return z(h+"options argument invalid");if(s=o.no_diagonals,s===!0||s===!1)t=s;else if(q=d(s),"undefined"===q||s===PS.DEFAULT)t=!1;else{if("number"!==q)return z(h+"options.no_diagonals invalid");t=0!==s}if(s=o.cut_corners,s===!0||s===!1)u=s;else if(q=d(s),"undefined"===q||s===PS.DEFAULT)u=!1;else{if("number"!==q)return z(h+"options.cut_corners invalid");u=0!==s}}return r=ic(p,k,l,m,n,t,u)},pathData:function(a,b,c,e,f,g){var h,i,j,k,l,m,n,o,p,q,r,s;if(h="[PS.pathData] ",i=arguments.length,5>i)return z(h+"Missing argument(s)");if(i>6)return z(h+"Too many arguments");if(j=a,k=b,l=c,m=e,n=f,o=g,"string"!=typeof j||j.length<1)return z(h+"pathmap argument invalid");if(p=lc(j),!p)return z(h+j+" not found");if("number"!==d(k))return z(h+"left argument not a number");if(k=Math.floor(k),0>k||k>=p.width)return z(h+"left argument is outside "+j);if("number"!==d(l))return z(h+"top argument not a number");if(l=Math.floor(l),0>l||l>=p.height)return z(h+"top argument is outside "+j);if(m===PS.DEFAULT)m=1;else{if("number"!==d(m))return z(h+"width argument not a number");m=Math.floor(m),1>m?m=1:(q=p.width-k,m>q&&(m=q))}if(n===PS.DEFAULT)n=1;else{if("number"!==d(n))return z(h+"height argument not a number");n=Math.floor(n),1>n?n=1:(q=p.height-l,n>q&&(n=q))}if(o!==PS.DEFAULT&&o!==PS.CURRENT)if(r=d(o),"undefined"===r)o=PS.CURRENT;else{if("number"!==r)return z(h+"data argument not a number");if(0>o)return z(h+"data argument < 0")}return s=jc(p,k,l,m,n,o)},pathDelete:function(a){var b,c;return b="[PS.pathDelete] ",c=arguments.length,1>c?z(b+"Missing argument"):"string"!=typeof a||a.length<1?z(b+"pathmap argument invalid"):mc(a)?PS.DONE:z(b+a+" not found")},pathNear:function(a,b,c,d,e){var f,g,h,i;return f="[PS.pathNear] ",g=arguments.length,5>g?z(f+"Missing argument(s)"):g>5?z(f+"Too many arguments"):"string"!=typeof a||a.length<1?z(f+"pathmap argument invalid"):(h=lc(a))?i=nc(h,b,c,d,e):z(f+a+" not found")}},a(tc),tc}},PS=Perlenspiel.Start(PS.DEFAULT_NAMESPACE)}(),function(){"use strict";var a,b,c,d;for(a=0,b=["webkit","moz","ms","o"],c=0;c<b.length&&!window.requestAnimationFrame;c+=1)d=b[c],window.requestAnimationFrame=window[d+"RequestAnimationFrame"],window.cancelAnimationFrame=window[d+"CancelAnimationFrame"]||window[d+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c,d,e;return c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d),a=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){window.clearTimeout(a)})}();