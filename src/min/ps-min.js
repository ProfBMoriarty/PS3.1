var PS;(function(){"use strict";function Pt(){if(_t>=0){_t-=1}else{Dt-=.05;if(Dt<=0){PS.timerStop(Mt);Mt=null;Dt=0}kt.style.opacity=Dt}}function Ht(e){var t;t=typeof e;if(t==="number"){if(isNaN(e)){t="NaN"}}else if(t==="object"){if(e){if(e instanceof Array){t="array"}}else{t="null"}}return t}function Bt(e,t,n,r){var i,s;i=e;if(i!==true&&i!==false){if(i===null){i=false}else if(i===PS.CURRENT){i=t}else if(i===PS.DEFAULT){i=n}else{s=Ht(i);if(s==="undefined"){i=r}else if(s==="number"){i=i!==0}else{i=PS.ERROR}}}return i}function jt(e,t){var n,r,i,s;for(n in e){if(e.hasOwnProperty(n)){r=e[n];s=Ht(r);if(s==="object"){i={};jt(r,i);r=i}t[n]=r}}}function Ft(e){if(e.stopPropagation){e.stopPropagation()}else{e.cancelBubble=true}e.preventDefault();return false}function It(){var e,t,n,r,i;e=[];for(t=0;t<arguments.length;t+=1){n=arguments[t];r=n-65536;i=n>65535?[55296+(r>>10),56320+(r&1023)]:[n];e.push(String.fromCharCode.apply(null,i))}return e.join("")}function qt(e,t,n,r,i,s){var o,u,a,f,l,c,h,p,d,v;o=$.context;u=$.bead_size;a=e.left;f=e.top;l=u;c=u;if(!e.visible){o.fillStyle=s;o.fillRect(a,f,l,c);return}p=e.size<u;d=e.radius;if(p||d>0){if(e.bgColor.a<255){o.fillStyle=s;o.fillRect(a,f,l,c)}if(e.bgColor.a>0){o.fillStyle=i;o.fillRect(a,f,l,c)}if(p){a+=e.margin;f+=e.margin;l=e.size;c=e.size}}h=e.border;if(h.width>0){if(h.color.a<255){o.fillStyle=s;o.fillRect(a,f,l,c)}if(h.color.a>0){o.fillStyle=t;if(d===0){o.fillRect(a,f,l,c)}else{v=Math.floor(l*d/100);v=o.fillRoundedRect(a,f,l,c,v)}}a+=h.left;f+=h.top;l-=h.left+h.right;c-=h.top+h.bottom}o.fillStyle=n;if(d===0){o.fillRect(a,f,l,c)}else{v=Math.floor(l*d/100);o.fillRoundedRect(a,f,l,c,v)}if(e.glyph.code>0&&e.glyph.color.a>0){$.context.font=e.glyph.font;o.fillStyle=r;o.fillText(e.glyph.str,e.left+e.glyph.x,e.top+e.glyph.y)}}function Rt(e,t){var n,r;n=e.a*(1-t.a);r={r:Math.floor(t.r*t.a+e.r*n),g:Math.floor(t.g*t.a+e.g*n),b:Math.floor(t.b*t.a+e.b*n)};return r}function Ut(e,t,n){var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y;r=t.r;i=t.g;s=t.b;o=e.planes;u=o.length;for(a=0;a<u;a+=1){l=o[a];f=l.color;c=f.r;h=f.g;p=f.b;d=f.a;if(d>0){if(d<255){v=Math.max(0,Math.min(d/255,1));m={r:r,g:i,b:s,a:1};g={r:c,g:h,b:p,a:v};y=Rt(m,g);r=y.r;i=y.g;s=y.b}else{r=c;i=h;s=p}}}c=r;h=i;p=s;n.rgb=c*N+h*C+p;n.r=c;n.g=h;n.b=p;n.str=R[c]+U[h]+z[p]}function Wt(e){var t,n,r,i,s,o,u,a;t=e.str;n=$.canvas;n.style.backgroundColor=t;document.body.style.backgroundColor=t;K.statusP.style.backgroundColor=t;K.inputP.style.backgroundColor=t;kt.style.backgroundColor=t;for(r=0;r<$.count;r+=1){i=J[r];s=i.planes[0];o=s.color;if(o.a<255){Ut(i,e,zt);u=zt.str}else{u=i.color.str}a=i.border.color;if(!i.visible||i.size<$.bead_size||i.radius>0||o.a<255||a.a<255){qt(i,a.str,u,i.glyph.color.str,i.bgColor.str,t)}}}function Xt(e){var t,n,r;if(e.r>127){t=0}else{t=255}if(e.g>127){n=0}else{n=255}if(e.b>127){r=0}else{r=255}kt.style.color=R[t]+U[n]+z[r]}function Vt(e){$.canvas.style.boxShadow=$.shadow.params+e.str}function $t(e){K.statusP.style.color=e.str;K.inputP.style.color=e.str}function Jt(e,t){var n;n=J[t];qt(n,n.border.color.str,e.str,n.glyph.color.str,n.bgColor.str,$.color.str)}function Kt(e,t){var n;n=J[t];qt(n,e.str,n.color.str,n.glyph.color.str,n.bgColor.str,$.color.str)}function Qt(e,t){var n;n=J[t];qt(n,n.border.color.str,n.color.str,e.str,n.bgColor.str,$.color.str)}function Gt(e){e.dirty=true;Q=true}function Yt(){var e,t,n;if(Q){e=$.count;for(t=0;t<e;t+=1){n=J[t];if(n.dirty){n.dirty=false;qt(n,n.border.color.str,n.color.str,n.glyph.color.str,n.bgColor.str,$.color.str)}}Q=false}}function Zt(){var e;if(!Nt){e=document.getElementById(r);e.style.display="inline";e=document.getElementById(c);e.value="";Nt=true;Ct=false}}function en(e){if(typeof e!=="string"||e.length<1){e="???"}PS.debug("WARNING: "+e+"\n")}function rn(e){var t,n,r;t="";if(e.search(".js")!==-1){n=e.lastIndexOf("/")+1;r=e.substr(n).replace(/^[\s\(\)]+|[\s\(\)]+$/g,"");if(r.split(":").length===3){r=r.substr(0,r.lastIndexOf(":"))}if(r!==""){t+="    "+r+"\n"}}else if(nn&&e.search(".htm")!==-1){t+="\n"+e}return t}function sn(e){var t,n,r,i;if(console&&console.log){console.log(e)}if(!e.split){return e}t=e.split("\n");i="";n=t.length;for(r=0;r<n;r+=1){i+=rn(t[r])}return i}function on(e,t){var n;nt=false;if(Mt){PS.timerStop(Mt)}if(typeof e!=="string"||e.length<1){e="???"}n="ERROR: "+e+"\n";kt.style.opacity=1;kt.innerHTML=n;if(tn&&t){n+=sn(t.stack)+"\n"}PS.debug(n);if(Lt){PS.audioPlay(I.audio.error_sound,{path:I.audio.path})}return PS.ERROR}function un(e){try{throw new Error("!")}catch(t){return on(e,t)}}function an(){var e;e=document.getElementById(t);e.scrollTop=e.scrollHeight}function fn(){st=[];ot=0}function ln(e){jt(I.fader,e);e.frames.length=0}function cn(e,t,n){var r;r={element:e,exec:t,execEnd:n,frames:[]};ln(r);return r}function hn(e,t,n,r,i,s,o,u,a){var f,l,c,h,p,d,v,m,g,y,b,w,E,S;e.step=0;e.frames.length=0;if(t===s&&n===o&&r===u&&i===a){return}e.tr=s;e.tg=o;e.tb=u;e.ta=a;e.trgb=s*N+o*C+u;e.tstr=R[s]+U[o]+U[u]+W[a];f=t;l=n;c=r;h=i;if(t>s){g=-(t-s)}else{g=s-t}if(n>o){y=-(n-o)}else{y=o-n}if(r>u){b=-(r-u)}else{b=u-r}if(i>a){w=-(i-a)}else{w=a-i}if(e.rate<D){p=1}else{p=Math.ceil(e.rate/D)}d=100/p;v=0;do{E=false;m={};v+=d;if(v>=100){m.r=s;m.g=o;m.b=u;m.a=a}else{if(f!==s){S=v*g/100;f=t+S;f=Math.round(f);E=true}m.r=f;if(l!==o){S=v*y/100;l=n+S;l=Math.round(l);E=true}m.g=l;if(c!==u){S=v*b/100;c=r+S;c=Math.round(c);E=true}m.b=c;if(h!==a){S=v*w/100;h=i+S;h=Math.round(h);E=true}m.a=h}m.rgb=m.r*N+m.g*C+m.b;m.str=R[m.r]+U[m.g]+U[m.b]+W[m.a];e.frames.push(m);if(!E){return}}while(v<100)}function pn(e,t,n,r,i,s,o,u,a){hn(e,t,n,r,i,s,o,u,a);if(e.frames.length>0){e.kill=false;e.active=true;st.push(e)}}function dn(e,t,n,r,i){var s,o,u,a;s=e.active;e.active=false;o=e.frames.length;if(o>0){u=e.step;if(u>=o){u=o-1}a=e.frames[u];hn(e,a.r,a.g,a.b,a.a,t,n,r,i)}if(e.frames.length>0){e.active=s}}function vn(){rt=[];it=0}function mn(){var e,t,n,r,i,s,o,u,a,f,l,c,h;e="[_tick] ";t=false;ot+=1;if(ot>=D){ot=0;n=st.length;r=0;while(r<n){i=st[r];o=i.frames.length;if(i.kill){st.splice(r,1);n-=1}else if(i.active){s=i.frames[i.step];l=i.onStep;if(l){h=[o,i.step,s.rgb];if(i.params){h=h.concat(i.params)}try{f=l.apply(L,h);if(f===false||f===null){i.step=o-1;s=i.frames[i.step]}t=true}catch(p){on(e+"fader .onStep failed ["+p.message+"]",p);return}}if(i.exec){try{i.exec(s,i.element)}catch(d){on(e+"fader .exec failed ["+d.message+"]",d);return}}i.step+=1;if(i.step>=o){i.active=false;i.step=0;i.frames.length=0;if(i.execEnd){try{i.execEnd(s,i.element)}catch(v){on(e+"fader .execEnd failed ["+v.message+"]",v);return}}l=i.onEnd;if(l){h=i.params;if(!h){h=[]}try{l.apply(L,h);t=true}catch(m){on(e+"fader .onEnd failed ["+m.message+"]",m);return}}st.splice(r,1);n-=1}else{r+=1}}else{r+=1}}}n=ht.length;if(vt&&n>0){if(mt>0){mt-=1}else{mt=gt;for(r=0;r<n;r+=1){u=ht[r];if(u){try{PS.keyDown(u,pt,dt);t=true}catch(g){on(e+"Key repeat failed ["+g.message+"]",g);return}}}}}n=rt.length;if(n>0){r=0;while(r<n){a=rt[r];c=a.id;a.count-=1;if(a.count<1){a.count=a.delay;try{f=a.exec.apply(L,a.arglist);t=true}catch(y){f=on(e+"Timed function failed ["+y.message+"]",y)}if(f===PS.ERROR){PS.timerStop(c)}n=rt.length}a=rt[r];if(a&&a.id===c){r+=1}}}if(t){Yt()}}function yn(e){var t,n,r,i,s,o,u,a,f;Ut(e,$.color,gn);t=gn.rgb;n=e.color;r=gn.r;i=gn.g;s=gn.b;o=n.r;u=n.g;a=n.b;n.rgb=t;n.r=r;n.g=i;n.b=s;n.str=gn.str;if(e.visible){f=e.fader;if(f.rate>0){if(f.rgb!==null){pn(f,f.r,f.g,f.b,255,r,i,s,255)}else if(!f.active){pn(f,o,u,a,255,r,i,s,255)}else{dn(f,r,i,s,255)}}else{Gt(e)}}}function bn(e,t,n,r,i){var s,o,u,a;s=n;if(s!==PS.CURRENT&&s!==PS.DEFAULT){a=Ht(s);if(a==="undefined"){s=PS.CURRENT}else if(a==="number"){s=Math.floor(s);if(s<0){s=0}else if(s>255){s=255}}else{return un(e+"red value invalid")}}o=r;if(o!==PS.CURRENT&&o!==PS.DEFAULT){a=Ht(o);if(a==="undefined"){o=PS.CURRENT}else if(a==="number"){o=Math.floor(o);if(o<0){o=0}else if(o>255){o=255}}else{return un(e+"green value invalid")}}u=i;if(u!==PS.CURRENT&&u!==PS.DEFAULT){a=Ht(u);if(a==="undefined"){u=PS.CURRENT}else if(a==="number"){u=Math.floor(u);if(u<0){u=0}else if(u>255){u=255}}else{return un(e+"blue value invalid")}}t.rgb=null;t.r=s;t.g=o;t.b=u;return PS.DONE}function wn(e,t){var n,r,i,s,o,u;n=Math.floor(t);if(n<1){n=r=s=u=0}else if(n>=16777215){n=16777215;r=s=u=255}else{r=n/N;r=Math.floor(r);i=r*N;s=(n-i)/C;s=Math.floor(s);o=s*C;u=n-i-o}e.rgb=n;e.r=r;e.g=s;e.b=u}function Sn(e,t,n,r){var i,s,o,u,a;i=En;i.rgb=0;i.r=null;i.g=null;i.b=null;i.str="";s=Ht(t);if(n!==undefined||r!==undefined){if(s==="number"||s==="undefined"||t===PS.CURRENT||t===PS.DEFAULT){o=bn(e,i,t,n,r);if(o===PS.ERROR){return PS.ERROR}}else{if(s==="array"){return un(e+"Extraneous arguments after color array")}if(s==="object"){return un(e+"Extraneous arguments after color object")}return un(e+"red argument invalid")}}else if(s==="number"){wn(i,t)}else if(s==="array"){a=t.length;if(a<1){i.rgb=PS.CURRENT}else{o=bn(e,i,t[0],t[1],t[2]);if(o===PS.ERROR){return PS.ERROR}}}else if(s==="object"){u=t.rgb;s=Ht(u);if(s==="undefined"||u===null){o=bn(e,i,t.r,t.g,t.b);if(o===PS.ERROR){return PS.ERROR}}else if(s==="number"){wn(i,u)}else if(u===PS.CURRENT||u===PS.DEFAULT){i.rgb=u}else{return un(e+".rgb property invalid")}}else if(s==="undefined"||t===PS.CURRENT){i.rgb=PS.CURRENT}else if(t===PS.DEFAULT){i.rgb=PS.DEFAULT}else{return un(e+"color argument invalid")}return i}function xn(e){var t,n,r,i;t=$.bead_size;e.glyph.x=Math.round(t/2);r=e.glyph.scale;if(r<100){n=Math.round(t*r/100)}else{n=t}e.glyph.size=i=Math.round(n/2);e.glyph.font=i+"px 'Droid'";e.glyph.y=Math.round((t-i)/2+i/2)}function Tn(e){var t;jt(I.bead,e);t={};jt(I.bead.color,t);e.planes=[{height:0,color:t}];xn(e);ln(e.fader);ln(e.borderFader);ln(e.glyphFader)}function Nn(e,t){var n,r,i,s,o,u;n=e.planes;if(t<1){r=n[0];return r.color}i=n.length;for(s=1;s<i;s+=1){r=n[s];if(r.height===t){return r.color}}u=I.bead.color;o={rgb:u.rgb,r:u.r,g:u.g,b:u.b,a:0};if(e.active){s=0;while(s<i){r=n[s];if(r.height>t){break}s+=1}n.splice(s,0,{height:t,color:o})}return o}function Cn(e){if(e.glyph.code>0){return e.border.gmax}return e.border.max}function kn(e,t){e.border.equal=true;e.border.width=t;e.border.top=t;e.border.left=t;e.border.bottom=t;e.border.right=t}function Ln(e){var t,n,r,i,s,o,u;t=$.bead_size;if(e.scale<100){n=Math.floor(t*e.scale/100);r=t-n;if(r>0&&r%2){n+=1}}else{n=t;e.margin=0;e.senseLeft=e.left;e.senseRight=e.right;e.senseTop=e.top;e.senseBottom=e.bottom}e.size=n;if(n!==t){e.margin=i=Math.floor((t-n)/2);e.senseLeft=e.left+i;e.senseRight=e.right-i;e.senseTop=e.top+i;e.senseBottom=e.bottom-i}u=e.border;u.max=Math.floor((n-8)/2);u.gmax=Math.floor((n-e.glyph.size)/2);s=Cn(e);if(u.equal){if(u.width>s){kn(e,s)}}else{o=u.top;if(o>s){u.top=s}o=u.left;if(o>s){u.left=s}o=u.bottom;if(o>s){u.bottom=s}o=u.right;if(o>s){u.right=s}}}function An(e){var t;t=e.data;if(t===null){t=0}return t}function On(e){var t,n;if(e.active){n=false;t=An(e);if(e.exec){try{e.exec(e.x,e.y,t,L);n=true}catch(r){return on("Bead "+e.x+", "+e.y+" function failed ["+r.message+"]",r)}}if(PS.touch){try{PS.touch(e.x,e.y,t,L);n=true}catch(i){return on("PS.touch() failed ["+i.message+"]",i)}}if(n){Yt()}}return PS.DONE}function Mn(e){var t;if(e.active){if(PS.release){t=An(e);try{PS.release(e.x,e.y,t,L);Yt()}catch(n){return on("PS.release() failed ["+n.message+"]",n)}}}return PS.DONE}function _n(e){var t;xt=true;if(e.active){if(PS.enter){t=An(e);try{PS.enter(e.x,e.y,t,L);Yt()}catch(n){return on("PS.enter() failed ["+n.message+"]",n)}}}return PS.DONE}function Dn(e){var t;if(e.active){if(PS.exit){t=An(e);try{PS.exit(e.x,e.y,t,L);Yt()}catch(n){return on("PS.exit() failed ["+n.message+"]",n)}}}return PS.DONE}function Pn(){xt=false;if(PS.exitGrid){try{PS.exitGrid(L);Yt()}catch(e){return on("PS.exitGrid() failed ["+e.message+"]",e)}}return PS.DONE}function Hn(){Tt=-1}function Bn(e,t){var n,r,i,s;n=$.canvas;e+=document.body.scrollLeft+document.documentElement.scrollLeft-n.offsetLeft-$.padLeft;t+=document.body.scrollTop+document.documentElement.scrollTop-n.offsetTop-$.padRight;if(e>=$.left&&e<$.right&&t>=$.top&&t<$.bottom){i=0;while(i<$.count){r=J[i];if(t>=r.top&&t<r.bottom){for(s=0;s<$.x;s+=1){if(e>=r.senseLeft&&e<r.senseRight&&t>=r.senseTop&&t<r.senseBottom){return r}i+=1;r=J[i]}return null}i+=$.x}}return null}function jn(e){var t,n,r;if(e.x&&e.y){t=e.x;n=e.y}else{t=e.clientX;n=e.clientY}r=Bn(t,n);if(r){On(r)}return Ft(e)}function Fn(e){var t,n,r;if(e.x&&e.y){t=e.x;n=e.y}else{t=e.clientX;n=e.clientY}r=Bn(t,n);if(r){Mn(r)}return Ft(e)}function In(e){var t,n,r,i;if(e.x&&e.y){t=e.x;n=e.y}else{t=e.clientX;n=e.clientY}r=Bn(t,n);if(r){if(r.index!==Tt){if(Tt>=0){i=J[Tt];Dn(i)}_n(r);Tt=r.index}}else if(Tt>=0){i=J[Tt];Dn(i);Tt=-1}return Ft(e)}function qn(n){var r,i;if(Tt>=0){r=J[Tt];Dn(r);Tt=-1}i=n.relatedTarget;if(i){i=i.id;if(i&&(i===e||i===t||i.length<1)){Pn()}}return Ft(n)}function Rn(e){var t,n,r,i;if(Et!==_){return Ft(e)}r=e.changedTouches[0];Et=r.identifier;t=r.pageX;n=r.pageY;i=Bn(t,n);if(i){xt=true;St=i.index;On(i)}else{St=_;xt=false}return Ft(e)}function Un(e){var t,n,r,i,s,o,u;t=e.changedTouches.length;for(n=0;n<t;n+=1){r=e.changedTouches[n];i=r.identifier;if(i===Et){Et=_;St=_;xt=false;s=r.pageX;o=r.pageY;u=Bn(s,o);if(u){Mn(u)}break}}return Ft(e)}function zn(e){var t,n,r,i,s,o,u,a;t=e.changedTouches.length;for(n=0;n<t;n+=1){r=e.changedTouches[n];i=r.identifier;if(i===Et){s=r.pageX;o=r.pageY;u=Bn(s,o);if(u){xt=true;if(St!==u.index){if(St!==_){a=J[St];Dn(a)}St=u.index;_n(u)}}else{if(St!==_){a=J[St];Dn(a)}St=_;if(xt){Pn()}}break}}return Ft(e)}function Wn(){var e;ht.length=0;pt=false;dt=false;for(e=0;e<256;e+=1){ct[e]=0}}function Xn(e,t){var n;n=e;if(n>=65&&n<=90){if(!t){n+=32}}else{n=at[n];if(t&&n<256){n=ft[n]}}return n}function Vn(e){return e>=32||e===13||e===8||e===9||e===27}function $n(e){var t,n,r,i,s,o;t="[_keyDown] ";n=false;if(Ct){return true}if(PS.keyDown){pt=e.shiftKey;dt=e.ctrlKey;if(!e.which){r=e.keyCode}else{r=e.which}i=Xn(r,pt);if(Vn(i)){if(!ct[i]){ct[i]=1;if(i!==r&&ct[r]){ct[r]=0;o=ht.indexOf(r);if(o>=0){ht.splice(o,1)}}if(ht.length<1){mt=yt}if(ht.indexOf(i)<0){ht.push(i)}try{PS.keyDown(i,pt,dt,L);n=true}catch(u){on(t+"PS.keyDown failed ["+u.message+"]",u)}}}else if(i===O){s=ht.length;for(o=0;o<s;o+=1){i=r=ht[o];if(r>=97&&r<=122){i-=32}else if(r<256){i=ft[r]}if(i!==r){ct[r]=0;ct[i]=1;ht[o]=i;try{PS.keyDown(i,true,dt,L);n=true}catch(a){on(t+"PS.keyDown failed ["+a.message+"]",a)}}}}if(n){Yt()}}return Ft(e)}function Jn(e){var t,n,r,i,s,o,u,a;t="[_keyUp] ";n=false;if(Ct){return true}if(PS.keyUp){r=pt=e.shiftKey;i=dt=e.ctrlKey;if(!e.which){s=e.keyCode}else{s=e.which}o=Xn(s,pt);if(Vn(o)){ct[o]=0;u=ht.indexOf(o);if(u>=0){ht.splice(u,1)}if(ht.length<1){mt=0;pt=false;dt=false}try{PS.keyUp(o,r,i,L);n=true}catch(f){on(t+"PS.keyUp failed ["+f.message+"]",f)}}else if(o===O){a=ht.length;for(u=0;u<a;u+=1){o=s=ht[u];if(s<256){o=lt[s]}if(o!==s){ct[s]=0;ct[o]=1;ht[u]=o;try{PS.keyDown(o,false,i,L);n=true}catch(l){on(t+"PS.keyDown failed ["+l.message+"]",l)}}}}if(n){Yt()}}return Ft(e)}function Kn(e){var t;if(!xt){return true}if(PS.input){if(!e){e=window.event}t=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail));if(t>=1){t=PS.WHEEL_FORWARD}else{t=PS.WHEEL_BACKWARD}try{PS.input({wheel:t},L);Yt()}catch(n){on("PS.input() failed ["+n.message+"]",n)}}return Ft(e)}function Qn(){if(!ut){document.addEventListener("keydown",$n,false);document.addEventListener("keyup",Jn,false);ut=true}}function Gn(){Wn();if(ut){document.removeEventListener("keydown",$n,false);document.removeEventListener("keyup",Jn,false);ut=false}}function Yn(){var e;e=$.canvas;e.style.display="block";e.addEventListener("mousedown",jn,false);e.addEventListener("mouseup",Fn,false);e.addEventListener("mousemove",In,false);e.addEventListener("mouseout",qn,false);Qn();window.addEventListener("DOMMouseScroll",Kn,false);window.addEventListener("mousewheel",Kn,false);if(bt){Et=_;St=_;document.addEventListener("touchmove",zn,false);document.addEventListener("touchstart",Rn,false);document.addEventListener("touchend",Un,false);document.addEventListener("touchcancel",Un,false)}}function Zn(e){var t,n,r,i,s,o;t=$.color;n=$.fader;r=e.rgb;if(r===PS.CURRENT){return t.rgb}if(r===null){i=e.r;if(i===PS.CURRENT){e.r=i=t.r}else if(i===PS.DEFAULT){e.r=i=I.grid.color.r}s=e.g;if(s===PS.CURRENT){e.g=s=t.g}else if(s===PS.DEFAULT){e.g=s=I.grid.color.g}o=e.b;if(o===PS.CURRENT){e.b=o=t.b}else if(o===PS.DEFAULT){e.b=o=I.grid.color.b}e.rgb=i*N+s*C+o}else if(r===PS.DEFAULT){jt(I.grid.color,e)}if(t.rgb!==e.rgb||n.rate>0&&n.rgb!==null&&n.rgb!==e.rgb){t.rgb=e.rgb;i=e.r;s=e.g;o=e.b;t.str=e.str=R[i]+U[s]+z[o];if(n.rate>0){if(n.rgb!==null){pn(n,n.r,n.g,n.b,255,i,s,o,255)}else if(!n.active){pn(n,t.r,t.g,t.b,255,i,s,o,255)}else{dn(n,i,s,o,255)}}else{Wt(e);Xt(e)}t.r=i;t.g=s;t.b=o}return t.rgb}function er(e,t){var n,r,i,s,o;n=$.shadow;r=t.rgb;if(r!==PS.CURRENT){if(r===null){i=t.r;if(i===PS.CURRENT){t.r=i=n.r}else if(i===PS.DEFAULT){t.r=i=I.grid.shadow.r}s=t.g;if(s===PS.CURRENT){t.g=s=n.g}else if(s===PS.DEFAULT){t.g=s=I.grid.shadow.g}o=t.b;if(o===PS.CURRENT){t.b=o=n.b}else if(o===PS.DEFAULT){t.b=o=I.grid.shadow.b}t.rgb=i*N+s*C+o}else if(r===PS.DEFAULT){jt(I.grid.shadow,t)}if(n.rgb!==t.rgb){n.rgb=t.rgb;i=t.r;s=t.g;o=t.b;n.str=t.str=R[i]+U[s]+z[o];n.r=i;n.g=s;n.b=o}}if(e!==PS.CURRENT){$.shadow.show=e}if($.shadow.show){Vt(n)}else{$.canvas.style.boxShadow="none"}return{show:$.shadow.show,rgb:n.rgb}}function tr(e,t){var n,r,i,s,o,u,a;fn();ln($.fader);ln(K.fader);$.plane=0;if(!$.ready||e!==$.x||t!==$.y){$.x=e;$.y=t;$.count=e*t;$.left=0;$.top=0;if(e>=t){n=Math.floor(x/e)}else{n=Math.floor(x/t)}$.bead_size=n;$.width=n*e;$.height=n*t;$.right=$.width;$.bottom=$.height;$.canvas.width=$.width;$.canvas.height=$.height;$.context.textAlign="center";$.context.textBaseline="middle";s=0;u=$.top;for(i=0;i<t;i+=1){o=$.left;for(r=0;r<e;r+=1){a=J[s];a.x=r;a.y=i;a.left=o;a.right=o+n;a.top=u;a.bottom=u+n;Tn(a);Ln(a);o+=n;s+=1}u+=n}while(s<k){a=J[s];a.visible=false;a.active=false;s+=1}}else{for(r=0;r<$.count;r+=1){a=J[r];Tn(a);Ln(a)}}Q=true;Zn({rgb:PS.DEFAULT});PS.statusColor(PS.DEFAULT);Yt();Hn();$.ready=true}function nr(e,t){if(Ht(e)!=="number"){return un(t+"x argument not a number")}e=Math.floor(e);if(e<0){return un(t+"x argument negative")}if(e>=$.x){return un(t+"x argument exceeds grid width")}return e}function rr(e,t){if(Ht(e)!=="number"){return un(t+"y argument not a number")}e=Math.floor(e);if(e<0){return un(t+"y argument negative")}if(e>=$.y){return un(t+"y argument exceeds grid height")}return e}function ir(e,t,n,r,i,s,o,u){var a,f,l;if(n===PS.ALL){if(r===PS.ALL){for(f=0;f<$.y;f+=1){for(a=0;a<$.x;a+=1){l=t(a,f,i,s,o,u);if(l===PS.ERROR){break}}}return l}r=rr(r,e);if(r===PS.ERROR){return PS.ERROR}for(a=0;a<$.x;a+=1){l=t(a,r,i,s,o,u);if(l===PS.ERROR){break}}return l}if(r===PS.ALL){n=nr(n,e);if(n===PS.ERROR){return PS.ERROR}for(f=0;f<$.y;f+=1){l=t(n,f,i,s,o,u);if(l===PS.ERROR){break}}return l}n=nr(n,e);if(n===PS.ERROR){return PS.ERROR}r=rr(r,e);if(r===PS.ERROR){return PS.ERROR}l=t(n,r,i,s,o,u);return l}function sr(e,t,n){var r,i,s,o,u,a,f,l,c;r=t*$.x+e;i=J[r];s=I.bead.color;o=Nn(i,$.plane);u=i.fader;a=n.rgb;if(!i.active||a===PS.CURRENT){return o.rgb}if(a===null){f=n.r;if(f===PS.CURRENT){n.r=f=o.r}else if(f===PS.DEFAULT){n.r=f=s.r}l=n.g;if(l===PS.CURRENT){n.g=l=o.g}else if(l===PS.DEFAULT){n.g=l=s.g}c=n.b;if(c===PS.CURRENT){n.b=c=o.b}else if(c===PS.DEFAULT){n.b=c=s.b}n.rgb=f*N+l*C+c}else if(a===PS.DEFAULT){jt(s,n)}if(o.rgb!==n.rgb||u.rate>0&&u.rgb!==null&&u.rgb!==n.rgb){o.rgb=n.rgb;o.r=n.r;o.g=n.g;o.b=n.b;yn(i)}return o.rgb}function or(e,t,n){var r,i,s;r=t*$.x+e;i=J[r];s=Nn(i,$.plane);if(i.active&&n!==PS.CURRENT&&n!==s.a){s.a=n;yn(i)}return s.a}function ur(e,t){var n,r,i,s,o,u,a;n=Ht(t);if(n==="undefined"||t===PS.CURRENT){return{rgb:PS.CURRENT,r:0,g:0,b:0,onStep:PS.CURRENT,onEnd:PS.CURRENT,params:PS.CURRENT}}if(t===PS.DEFAULT){return{rgb:PS.DEFAULT,r:0,g:0,b:0,onStep:PS.DEFAULT,onEnd:PS.DEFAULT,params:PS.DEFAULT}}if(n!=="object"){return un(e+"options argument invalid")}r=t.rgb;if(r!==PS.CURRENT&&r!==PS.DEFAULT){n=Ht(r);if(n==="undefined"||r===null){t.rgb=PS.CURRENT}else if(n==="number"){r=Math.floor(r);if(r<=PS.COLOR_BLACK){r=PS.COLOR_BLACK;i=0;o=0;s=0}else if(r>=PS.COLOR_WHITE){r=PS.COLOR_WHITE;i=255;o=255;s=255}else{i=r/N;i=Math.floor(i);u=i*N;o=(r-u)/C;o=Math.floor(o);a=o*C;s=r-u-a}t.rgb=r;t.r=i;t.g=o;t.b=s}else{return un(e+"options.rgb property invalid")}}else{t.r=0;t.g=0;t.b=0}r=t.onStep;if(r!==PS.CURRENT&&r!==PS.DEFAULT){n=Ht(r);if(n==="undefined"||r===null){t.onStep=PS.CURRENT}else if(n!=="function"){return un(e+"options.onStep property invalid")}}r=t.onEnd;if(r!==PS.CURRENT&&r!==PS.DEFAULT){n=Ht(r);if(n==="undefined"||r===null){t.onEnd=PS.CURRENT}else if(n!=="function"){return un(e+"options.onEnd property invalid")}}r=t.params;if(r!==PS.CURRENT&&r!==PS.DEFAULT){n=Ht(r);if(n==="undefined"||r===null){t.params=PS.CURRENT}else if(n!=="array"){return un(e+"options.params property invalid")}}return t}function ar(e,t,n,r){var i,s,o,u,a,f,l;i=t*$.x+e;s=J[i];o=s.color;u=s.fader;a=u.rate;if(s.active){if(n===PS.CURRENT){f=a}else if(n===PS.DEFAULT){f=I.fader.rate}else{f=n}l=r.rgb;if(l!==PS.CURRENT){if(l===PS.DEFAULT){u.rgb=I.fader.rgb}else{u.rgb=l}u.r=r.r;u.g=r.g;u.b=r.b}l=r.onStep;if(l!==PS.CURRENT){if(l===PS.DEFAULT){u.onStep=I.fader.onStep}else{u.onStep=l}}l=r.onEnd;if(l!==PS.CURRENT){if(l===PS.DEFAULT){u.onEnd=I.fader.onEnd}else{u.onEnd=l}}l=r.params;if(l!==PS.CURRENT){if(l===PS.DEFAULT){u.params=I.fader.params}else{u.params=l}}if(a!==f){u.rate=f;if(f<1){u.active=false;u.kill=true}else if(u.active){dn(u,o.r,o.g,o.b,255)}}}return{rate:u.rate,rgb:u.rgb,onStep:u.onStep,onEnd:u.onEnd,params:u.params}}function fr(e,t,n){var r,i;r=t*$.x+e;i=J[r];if(i.active&&n!==PS.CURRENT&&i.scale!==n){i.scale=n;Ln(i);Gt(i)}return i.scale}function lr(e,t,n){var r,i,s;r=t*$.x+e;i=J[r];if(i.active&&n!==PS.CURRENT&&i.radius!==n){i.radius=n;if(!i.border.equal&&n>0){s=Math.max(i.border.top,i.border.left,i.border.bottom,i.border.right);kn(i,s)}Gt(i)}return i.radius}function cr(e,t,n){var r,i,s,o,u,a,f,l;r=t*$.x+e;i=J[r];s=I.bead.bgColor;o=i.bgColor;u=n.rgb;if(!i.active||u===PS.CURRENT){return o.rgb}if(u===null){a=n.r;if(a===PS.CURRENT){n.r=a=o.r}else if(a===PS.DEFAULT){n.r=a=s.r}f=n.g;if(f===PS.CURRENT){n.g=f=o.g}else if(f===PS.DEFAULT){n.g=f=s.g}l=n.b;if(l===PS.CURRENT){n.b=l=o.b}else if(l===PS.DEFAULT){n.b=l=s.b}n.rgb=a*N+f*C+l}else if(u===PS.DEFAULT){jt(s,n)}if(o.rgb!==n.rgb){o.rgb=n.rgb;o.r=a=n.r;o.g=f=n.g;o.b=l=n.b;o.str=R[a]+U[f]+U[l]+W[o.a];if(i.active&&(i.scale<100||i.radius>0)){Gt(i)}}return o.rgb}function hr(e,t,n){var r,i,s;r=t*$.x+e;i=J[r];s=i.bgColor;if(n!==PS.CURRENT&&n!==s.a){s.a=n;s.str=R[s.r]+U[s.g]+U[s.b]+W[n];if(i.active&&(i.scale<100||i.radius>0)){Gt(i)}}return s.a}function pr(e,t,n){var r,i;r=t*$.x+e;i=J[r];if(i.active&&n!==PS.CURRENT){if(n===null){i.data=I.bead.data;i.fader.data=i.data;i.borderFader.data=i.data;i.glyphFader.data=i.data}else{i.data=n;i.fader.data=n;i.borderFader.data=n;i.glyphFader.data=n}}return i.data}function dr(e,t,n){var r,i;r=t*$.x+e;i=J[r];if(i.active&&n!==PS.CURRENT){i.exec=n}return i.exec}function vr(e,t,n){var r,i;r=t*$.x+e;i=J[r];if(i.active&&n!==PS.CURRENT&&i.visible!==n){i.visible=n;if(!n){i.fader.kill=true;i.borderFader.kill=true;i.glyphFader.kill=true}Gt(i)}return i.visible}function mr(e,t,n){var r,i;r=t*$.x+e;i=J[r];if(n!==PS.CURRENT){i.active=n}return i.active}function gr(e,t,n){var r,i,s,o,u,a,f,l,c;r=t*$.x+e;i=J[r];if(i.active&&n!==PS.CURRENT){s=Cn(i);if(Ht(n)==="number"){if(n>s){n=s}if(n!==i.border.width){kn(i,n);Gt(i)}}else{u=false;a=n.top;if(a===PS.CURRENT){a=i.border.top}else{if(a>s){a=s}if(a!==i.border.top){i.border.top=a;u=true}}f=n.left;if(f===PS.CURRENT){f=i.border.left}else{if(f>s){f=s}if(f!==i.border.left){i.border.left=f;u=true}}l=n.bottom;if(l===PS.CURRENT){l=i.border.bottom}else{if(l>s){l=s}if(l!==i.border.bottom){i.border.bottom=l;u=true}}c=n.right;if(c===PS.CURRENT){c=i.border.right}else{if(c>s){c=s}if(c!==i.border.right){i.border.right=c;u=true}}if(a===f&&a===c&&a===l){kn(i,a);if(u){Gt(i)}}else if(i.radius>0){s=Math.max(a,f,l,c);kn(i,s);Gt(i)}else{i.border.equal=false;if(u){Gt(i)}}}}o={top:i.border.top,left:i.border.left,bottom:i.border.bottom,right:i.border.right,equal:i.border.equal};if(!i.border.equal){i.border.width=Math.max(o.top,o.left,o.bottom,o.right)}o.width=i.border.width;return o}function yr(e,t,n){var r,i,s,o,u,a,f,l,c;r=t*$.x+e;i=J[r];s=i.border.color;o=i.borderFader;u=n.rgb;if(i.active&&u!==PS.CURRENT){if(u===null){a=n.r;if(a===PS.CURRENT){n.r=a=s.r}else if(a===PS.DEFAULT){n.r=a=I.bead.border.color.r}f=n.g;if(f===PS.CURRENT){n.g=f=s.g}else if(f===PS.DEFAULT){n.g=f=I.bead.border.color.g}l=n.b;if(l===PS.CURRENT){n.b=l=s.b}else if(l===PS.DEFAULT){n.b=l=I.bead.border.color.b}n.rgb=a*N+f*C+l}else if(u===PS.DEFAULT){jt(I.bead.border.color,n)}if(s.rgb!==n.rgb||o.rate>0&&o.rgb!==null&&o.rgb!==n.rgb){s.rgb=n.rgb;a=n.r;f=n.g;l=n.b;n.a=c=s.a;s.str=n.str=R[a]+U[f]+U[l]+W[c];if(i.visible){if(o.rate>0){if(o.rgb!==null){pn(o,o.r,o.g,o.b,c,a,f,l,c)}else if(!o.active){pn(o,s.r,s.g,s.b,c,a,f,l,c)}else{dn(o,a,f,l,c)}}else{Gt(i)}}s.r=a;s.g=f;s.b=l}}return s.rgb}function br(e,t,n){var r,i,s,o,u,a,f;r=t*$.x+e;i=J[r];s=i.border.color;if(i.active&&n!==PS.CURRENT&&n!==s.a){o=s.r;u=s.g;a=s.b;s.str=R[o]+U[u]+U[a]+W[n];if(i.visible){f=i.borderFader;if(f.rate>0){if(!f.active){if(f.rgb!==null){pn(f,f.r,f.g,f.b,s.a,o,u,a,n)}else{pn(f,o,u,a,s.a,o,u,a,n)}}else{dn(f,o,u,a,n)}}else{Gt(i)}}s.a=n}return s.a}function wr(e,t,n,r){var i,s,o,u,a,f,l;i=t*$.x+e;s=J[i];u=s.border.color;o=s.borderFader;a=o.rate;if(s.active){if(n===PS.CURRENT){f=a}else if(n===PS.DEFAULT){f=I.fader.rate}else{f=n}l=r.rgb;if(l!==PS.CURRENT){if(l===PS.DEFAULT){o.rgb=I.fader.rgb}else{o.rgb=l}o.r=r.r;o.g=r.g;o.b=r.b}l=r.onStep;if(l!==PS.CURRENT){if(l===PS.DEFAULT){o.onStep=I.fader.onStep}else{o.onStep=l}}l=r.onEnd;if(l!==PS.CURRENT){if(l===PS.DEFAULT){o.onEnd=I.fader.onEnd}else{o.onEnd=l}}l=r.params;if(l!==PS.CURRENT){if(l===PS.DEFAULT){o.params=I.fader.params}else{o.params=l}}if(a!==f){o.rate=f;if(f<1){o.active=false;o.kill=true}else if(o.active){dn(o,u.r,u.g,u.b,255)}}}return{rate:o.rate,rgb:o.rgb,onStep:o.onStep,onEnd:o.onEnd,params:o.params}}function Er(e,t,n){var r,i,s;r=t*$.x+e;i=J[r];if(i.active&&n!==PS.CURRENT&&i.glyph.code!==n){i.glyph.code=n;if(n<1){s=""}else{s=String.fromCodePoint(n)}i.glyph.str=s;Gt(i)}return i.glyph.code}function Sr(e,t,n){var r,i,s,o,u,a,f,l,c;r=t*$.x+e;i=J[r];s=i.glyph.color;o=i.glyphFader;u=n.rgb;if(i.active&&u!==PS.CURRENT){if(u===null){a=n.r;if(a===PS.CURRENT){n.r=a=s.r}else if(a===PS.DEFAULT){n.r=a=I.bead.glyph.color.r}f=n.g;if(f===PS.CURRENT){n.g=f=s.g}else if(f===PS.DEFAULT){n.g=f=I.bead.glyph.color.g}l=n.b;if(l===PS.CURRENT){n.b=l=s.b}else if(l===PS.DEFAULT){n.b=l=I.bead.glyph.color.b}n.rgb=a*N+f*C+l}else if(u===PS.DEFAULT){jt(I.bead.glyph.color,n)}if(s.rgb!==n.rgb||o.rate>0&&o.rgb!==null&&o.rgb!==n.rgb){s.rgb=n.rgb;a=n.r;f=n.g;l=n.b;n.a=c=s.a;s.str=n.str=R[a]+U[f]+U[l]+W[c];if(i.visible){if(o.rate>0){if(o.rgb!==null){pn(o,o.r,o.g,o.b,c,a,f,l,c)}if(!o.active){pn(o,s.r,s.g,s.b,c,a,f,l,c)}else{dn(o,a,f,l,c)}}else{Gt(i)}}s.r=a;s.g=f;s.b=l}}return s.rgb}function xr(e,t,n){var r,i,s,o,u,a,f;r=t*$.x+e;i=J[r];s=i.glyph.color;if(i.active&&n!==PS.CURRENT&&n!==s.a){o=s.r;u=s.g;a=s.b;s.str=R[o]+U[u]+U[a]+W[n];if(i.visible){f=i.glyphFader;if(f.rate>0){if(!f.active){pn(f,o,u,a,s.a,o,u,a,n)}else{dn(f,o,u,a,n)}}else{Gt(i)}}s.a=n}return s.a}function Tr(e,t,n){var r,i,s;r=t*$.x+e;i=J[r];s=i.glyph.scale;if(i.active&&n!==PS.CURRENT&&n!==s){i.glyph.scale=n;if(i.visible){xn(i);Gt(i)}}return i.glyph.scale}function Nr(e,t,n,r){var i,s,o,u,a,f,l;i=t*$.x+e;s=J[i];o=s.glyph.color;u=s.glyphFader;a=u.rate;if(s.active){if(n===PS.CURRENT){f=a}else if(n===PS.DEFAULT){f=I.fader.rate}else{f=n}l=r.rgb;if(l!==PS.CURRENT){if(l===PS.DEFAULT){u.rgb=I.fader.rgb}else{u.rgb=l}u.r=r.r;u.g=r.g;u.b=r.b}l=r.onStep;if(l!==PS.CURRENT){if(l===PS.DEFAULT){u.onStep=I.fader.onStep}else{u.onStep=l}}l=r.onEnd;if(l!==PS.CURRENT){if(l===PS.DEFAULT){u.onEnd=I.fader.onEnd}else{u.onEnd=l}}l=r.params;if(l!==PS.CURRENT){if(l===PS.DEFAULT){u.params=I.fader.params}else{u.params=l}}if(a!==f){u.rate=f;if(f<1){u.active=false;u.kill=true}else if(u.active){dn(u,o.r,o.g,o.b,255)}}}return{rate:u.rate,rgb:u.rgb,onStep:u.onStep,onEnd:u.onEnd,params:u.params}}function Cr(e){var t,n,r,i,s;t=e.getAttribute("data-id");n=Y.length;for(r=0;r<n;r+=1){i=Y[r];if(i.id===t){s=i.exec;Y.splice(r,1);break}}try{s(PS.ERROR)}catch(o){on("[PS.imageLoad] .exec function failed ["+o.message+"]",o)}un("[PS.imageLoad] Error loading "+e.src)}function kr(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m;n="[_imageExtract] ";r=e.width;if(Ht(r)!=="number"||r<1){return un(n+"image width invalid")}r=Math.floor(r);i=e.height;if(Ht(i)!=="number"||i<1){return un(n+"image height invalid")}i=Math.floor(i);try{G.width=r;G.height=i;s=G.getContext("2d");s.drawImage(e,0,0,r,i,0,0,r,i)}catch(g){return on(n+"image extraction failed @ 1 ["+g.message+"]",g)}try{o=s.getImageData(0,0,r,i)}catch(y){return on(n+"image extraction failed @ 2 ["+y.message+"]",y)}u={width:o.width,height:o.height};a=o.data;f=a.length;l=[];h=c=0;if(t===1){l.length=f/4;while(c<f){p=a[c];d=a[c+1];v=a[c+2];l[h]=p*N+d*C+v;c+=4;h+=1}}else if(t===2){l.length=f/2;while(c<f){p=a[c];d=a[c+1];v=a[c+2];m=a[c+3];l[h]=p*N+d*C+v;l[h+1]=m;c+=4;h+=2}}else if(t===3){l.length=f/4*3;while(c<f){p=a[c];d=a[c+1];v=a[c+2];l[h]=p;l[h+1]=d;l[h+2]=v;c+=4;h+=3}}else{l.length=f;while(c<f){l[c]=a[c];c+=1;l[c]=a[c];c+=1;l[c]=a[c];c+=1;l[c]=a[c];c+=1}}u.pixelSize=t;u.data=l;return u}function Lr(e){var t,n,r,i,s,o,u,a;t=e.getAttribute("data-id");n=Y.length;for(r=0;r<n;r+=1){i=Y[r];if(i.id===t){s=i.exec;o=i.format;u=i.source;Y.splice(r,1);break}}a=kr(e,o);if(a!==PS.ERROR){try{a.source=u;a.id=t;s(a)}catch(f){on("[PS.imageLoad] .exec function failed ["+f.message+"]",f)}}}function Ar(e,t){var n,r,i,s,o,u,a,f;if(Ht(t)!=="object"){return un(e+"image argument not an object")}n=t.width;if(Ht(n)!=="number"){return un(e+"image.width not a number")}n=Math.floor(n);if(n<1){return un(e+"image.width < 1")}t.width=n;r=t.height;if(Ht(r)!=="number"){return un(e+"image.height not a number")}r=Math.floor(r);if(r<1){return un(e+"image.height < 1")}t.height=r;i=t.pixelSize;if(Ht(i)!=="number"){return un(e+"image.pixelSize not a number")}i=Math.floor(i);if(i<1&&i>4){return un(e+"image.pixelSize is not 1, 2, 3 or 4")}t.pixelSize=i;o=t.data;if(Ht(o)!=="array"){return un(e+"image.data is not an array")}u=o.length;s=n*r*i;if(u!==s){return un(e+"image.data length invalid")}for(a=0;a<u;a+=1){f=o[a];if(Ht(f)!=="number"){return un(e+"image.data["+a+"] not a number")}if(f<0){return un(e+"image.data["+a+"] negative")}if(i<3){if(f>16777215){return un(e+"image.data["+a+"] > 0xFFFFFF")}}else if(f>255){return un(e+"image.data["+a+"] > 255")}}return true}function Or(e,t){var n,r;n=e.toString(16).toUpperCase();if(t){r=n.length;while(r<t){n="0"+n;r+=1}}return"0x"+n}function Mr(e,t,n,r,i,s,o){var u;if(e<3){u="";if(t){u+=Or(n,6)}else{u+=n}if(e===2){if(t){u+=", "+Or(o,2)}else{u+=", "+o}}}else{if(t){u=Or(r,2)+", "+Or(i,2)+", "+Or(s,2)}else{u=r+", "+i+", "+s}if(e===4){if(t){u+=", "+Or(o,2)}else{u+=", "+o}}}return u}function _r(){var e;e={id:w+tt,placed:false,visible:true,x:0,y:0,ax:0,ay:0,image:null,color:null,collide:null,width:0,height:0,plane:-1};tt+=1;et.push(e);return e}function Dr(e,t){var n,r,i;if(typeof e!=="string"||e.length<1){return un(t+"sprite argument invalid")}n=et.length;for(r=0;r<n;r+=1){i=et[r];if(i.id===e){return i}}return un(t+"sprite id '"+e+"' does not exist")}function Pr(e,t,n,r,i){var s,o,u,a,f,l,c,h,p;if(t===undefined){t=e.x;n=e.y;r=e.width;i=e.height}s=$.x;t-=e.ax;if(t>=s){return}if(t<0){r+=t;if(r<1){return}t=0}if(t+r>s){r=s-t}u=t+r;o=$.y;n-=e.ay;if(n>=o){return}if(n<0){i+=n;if(i<1){return}n=0}if(n+i>o){i=o-n}a=n+i;for(l=n;l<a;l+=1){for(f=t;f<u;f+=1){h=f+l*s;c=J[h];if(c.active){p=Nn(c,e.plane);p.r=255;p.g=255;p.b=255;p.a=0;p.rgb=16777215;yn(c)}}}}function Hr(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S;t=e.width;n=e.height;if(t<1||n<1){return}r=$.x;f=0;s=e.x-e.ax;if(s>=r){return}if(s<0){t+=s;if(t<1){return}s=0;f=e.width-t}if(s+t>r){t=r-s}u=s+t;i=$.y;l=0;o=e.y-e.ay;if(o>=i){return}if(o<0){n+=o;if(n<1){return}o=0;l=e.height-n}if(o+n>i){n=i-o}a=o+n;c=e.color;if(c){for(p=o;p<a;p+=1){for(h=s;h<u;h+=1){v=h+p*r;d=J[v];if(d.active){m=Nn(d,e.plane);m.rgb=c.rgb;m.r=c.r;m.g=c.g;m.b=c.b;m.a=c.a;yn(d)}}}}else{g=e.image.data;for(p=o;p<a;p+=1){y=(l*e.width+f)*4;for(h=s;h<u;h+=1){v=h+p*r;d=J[v];if(d.active){b=g[y];w=g[y+1];E=g[y+2];S=g[y+3];m=Nn(d,e.plane);m.rgb=b*N+w*C+E;m.r=b;m.g=w;m.b=E;m.a=S;yn(d)}y+=4}l+=1}}}function Br(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b;n="[_collisionCheck] ";s=e.x-e.ax;o=e.y-e.ay;u=e.width;a=e.height;f=e.collide;r=et.length;for(i=0;i<r;i+=1){l=et[i];c=l.id;if(c!==t&&l.visible&&l.placed){h=l.x-l.ax;p=l.y-l.ay;d=l.width;v=l.height;m=l.collide;if(h>s){g=h-s}else{g=s-h}if(p>o){y=p-o}else{y=o-p}b=null;if(s===h-u||s===h+d){if(o<=p&&y<=a||o>=p&&y<=v){b=PS.SPRITE_TOUCH}}else if(o===p-a||o===p+v){if(s<=h&&g<=u||s>=h&&g<=d){b=PS.SPRITE_TOUCH}}else if(s>=h&&s<h+d){if(o<=p&&y<a||o>=p&&y<v){b=PS.SPRITE_OVERLAP}}else if(h>=s&&h<s+u){if(p<=o&&y<v||p>=o&&y<a){b=PS.SPRITE_OVERLAP}}if(b){if(f){try{f(t,e.plane,c,l.plane,b)}catch(w){on(n+t+" collide function failed ["+w.message+"]",w);return}}if(m){try{m(c,l.plane,t,e.plane,b)}catch(E){on(n+c+" collide function failed ["+E.message+"]",E);return}}}}}}function jr(e){this.content=[];this.scoreFunction=e}function Fr(e,t,n,r){var i,s,o,u,a,f,l;if(n>e){i=n-e}else{i=e-n}if(r>t){s=r-t}else{s=t-r}if(e<n){o=1}else{o=-1}if(t<r){u=1}else{u=-1}a=i-s;l=[];while(e!==n||t!==r){f=a*2;if(f>-s){a-=s;e+=o}if(e===n&&t===r){l.push([e,t]);break}if(f<i){a+=i;t+=u}l.push([e,t])}return l}function Ir(e,t,n,r,i,s){var o,u,a,f,l,c,h,p,d;if(i>n){o=i-n}else{o=n-i}if(s>r){u=s-r}else{u=r-s}if(n<i){a=1}else{a=-1}if(r<s){f=1}else{f=-1}l=o-u;h=[];while(n!==i||r!==s){c=l*2;if(c>-u){l-=u;n+=a}if(n===i&&r===s){h.push([n,r]);return h}if(c<o){l+=o;r+=f}d=r*t+n;p=e[d];if(!p.value){return null}h.push([n,r])}return h}function qr(e,t,n,r){var i,s,o;if(n>e){i=n-e}else{i=e-n}if(r>t){s=r-t}else{s=t-r}if(i>s){o=s*P+(i-s)}else{o=i*P+(s-i)}return o}function Rr(e,t,n,r,i,s){var o,u,a,f,l,c,h,p,d,v,m,g,y,b,w;o=[];u=r.x;a=r.y;f=t-1;l=n-1;p=a*t;c=(a-1)*t;h=(a+1)*t;g=false;y=false;b=false;w=false;if(u>0){d=u-1;v=p+d;m=e[v];if(!m.value){w=true}else if(!m.closed){m.cost=m.value;o.push(m)}}if(u<f){d=u+1;v=p+d;m=e[v];if(!m.value){b=true}else if(!m.closed){m.cost=m.value;o.push(m)}}if(a>0){v=c+u;m=e[v];if(!m.value){g=true}else if(!m.closed){m.cost=m.value;o.push(m)}}if(a<l){v=h+u;m=e[v];if(!m.value){y=true}else if(!m.closed){m.cost=m.value;o.push(m)}}if(!i){if(u>0){d=u-1;if(a>0&&(s||!w&&!g)){v=c+d;m=e[v];if(m.value&&!m.closed){m.cost=m.value*P;o.push(m)}}if(a<l&&(s||!w&&!y)){v=h+d;m=e[v];if(m.value&&!m.closed){m.cost=m.value*P;o.push(m)}}}if(u<f){d=u+1;if(a>0&&(s||!g&&!b)){v=c+d;m=e[v];if(m.value&&!m.closed){m.cost=m.value*P;o.push(m)}}if(a<l&&(s||!y&&!b)){v=h+d;m=e[v];if(m.value&&!m.closed){m.cost=m.value*P;o.push(m)}}}}return o}function Ur(e){return e.f}function zr(e,t,n,r,i,s,o){var u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S;if(t===r&&n===i){return[]}u=e.width;a=e.height;f=e.nodes;l=n*u+t;c=f[l];if(!c.value){return[]}l=i*u+r;c=f[l];if(!c.value){return[]}if(!s){h=Ir(f,u,t,n,r,i);if(h){return h}}p=f.length;for(y=0;y<p;y+=1){c=f[y];c.f=0;c.g=0;c.h=0;c.cost=0;c.closed=false;c.visited=false;c.parent=null}h=[];d=new jr(Ur);l=n*u+t;c=f[l];d.push(c);while(d.size()>0){v=d.pop();if(v.x===r&&v.y===i){S=v;while(S.parent){h.push([S.x,S.y]);S=S.parent}h.reverse();break}v.closed=true;m=Rr(f,u,a,v,s,o);g=m.length;for(y=0;y<g;y+=1){b=m[y];w=v.g+b.cost;E=b.visited;if(!E||w<b.g){b.visited=true;b.parent=v;b.h=b.h||qr(b.x,b.y,r,i);b.g=w;b.f=b.g+b.h;if(!E){d.push(b)}else{d.rescore(b)}}}}return h}function Wr(e,t,n,r,i,s){var o,u,a,f,l,c,h,p;o=[];o.length=r*i;u=e.nodes;a=n+i;h=0;for(c=n;c<a;c+=1){f=c*e.width+t;for(l=0;l<r;l+=1){p=u[f];if(s!==PS.CURRENT){if(s===PS.DEFAULT){p.value=p.ovalue}else{p.value=s}}o[h]=p.value;h+=1;f+=1}}return o}function Xr(e,t,n){var r,i,s,o,u,a,f,l;i=n.length;r=[];r.length=i;s=0;for(u=0;u<t;u+=1){for(o=0;o<e;o+=1){f=n[s];a={x:o,y:u,value:f,ovalue:f,f:0,g:0,h:0,cost:0,parent:null,closed:false,visited:false};r[s]=a;s+=1}}l={id:E+Ot,width:e,height:t,nodes:r};Ot+=1;At.push(l);return l}function Vr(e){var t,n,r;t=At.length;for(n=0;n<t;n+=1){r=At[n];if(r.id===e){return r}}return null}function $r(e){var t,n,r,i,s;t=At.length;for(n=0;n<t;n+=1){r=At[n];if(r.id===e){i=r.nodes;t=i.length;for(s=0;s<t;s+=1){i[s]=null}r.nodes=null;At.splice(n,1);return true}}return false}function Jr(e,t,n,r,i){var s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x;s=e.nodes;o=e.width;u=e.height;a=1;while(a<o){f=[];l=r-a;h=r+a;c=i-a;p=i+a;d=l;if(d<0){d=0}v=h+1;if(v>=o){v=o}if(c>=0){m=c*o+d;for(g=d;g<v;g+=1){y=s[m];if(y.value){f.push([y.x,y.y])}m+=1}}if(p<u){m=p*o+d;for(g=d;g<v;g+=1){y=s[m];if(y.value){f.push([y.x,y.y])}m+=1}}d=c+1;if(d<0){d=0}v=p;if(v>=u){v=u}if(l>=0){m=d*o+l;for(g=d;g<v;g+=1){y=s[m];if(y.value){f.push([y.x,y.y])}m+=o}}if(h<o){m=d*o+h;for(g=d;g<v;g+=1){y=s[m];if(y.value){f.push([y.x,y.y])}m+=o}}b=f.length;if(b){if(b===1){return f[0]}w=o+u;for(g=0;g<b;g+=1){x=f[g];S=qr(t,n,x[0],x[1]);if(S<w){w=S;E=g}}return f[E]}a+=1}return[t,n]}function Kr(e){K.inputP.style.display="none";Qn();K.statusNode.nodeValue=K.text=e;K.statusP.style.display="block"}function Qr(e){var t,n,r;t=e.which;if(!t){t=e.keyCode}if(t===PS.KEY_ENTER){n=K.input.value;r=K.exec;if(typeof r==="function"){try{r(n)}catch(i){on("PS.statusInput() function failed ["+i.message+"]",i)}}K.input.removeEventListener("keydown",Qr,false);Kr(K.text);return Ft(e)}return true}function Gr(e,t){var n;K.statusP.style.display="none";K.label=n=e;if(n.length<1){n=">"}K.inputNode.nodeValue=n;K.exec=t;K.input.value="";Gn();K.input.addEventListener("keydown",Qr,false);K.inputP.style.display="block";K.input.focus()}function Yr(){try{document.createEvent("TouchEvent");return true}catch(e){return false}}function Zr(){var e,t,n,r,i;e=window.navigator.userAgent.toLowerCase();t=window.navigator.platform.toLowerCase();if(/firefox/.test(e)){n="Firefox";if(/fennec/.test(e)){n+=" Mobile"}i=/firefox\/[\.\d]+/.exec(e)[0].split("/")[1]}else if(/chrome/.test(e)){n="Chrome";i=/chrome\/[\d\.]+/.exec(e)[0].split("/")[1]}else if(/safari/.test(e)){n="Safari";if(/iphone/.test(e)||/ipad/.test(e)||/ipod/.test(e)){r="iOS"}}else if(/msie/.test(e)){n="Internet Explorer";if(/iemobile/.test(e)){n+=" Mobile"}i=/msie \d+[.]\d+/.exec(e)[0].split(" ")[1]}else if(/trident/.test(e)){n="Internet Explorer";i=/rv\:\d+[.]\d+/.exec(e)[0].split(":")[1]}else if(/opera/.test(e)){n="Opera";if(/mini/.test(e)){n+=" Mini"}else if(/mobile/.test(e)){n+=" Mobile"}}else if(/android/.test(e)){n="Android";r=/android\s[\.\d]+/.exec(e)}if(!i){try{i=/version\/[\.\d]+/.exec(e);if(i){i=i[0].split("/")[1]}else{i=/opera\/[\.\d]+/.exec(e)[0].split("/")[1]}}catch(s){console.error("Problem detecting browser: "+s.message);i=""}}if(t==="win32"||t==="win64"){r="Windows"}else if(t==="macintel"||t==="macppc"){r="Mac OS X ";r+=/10[\.\_\d]+/.exec(e)[0];if(/[\_]/.test(r)){r=r.split("_").join(".")}}if(!r){if(/linux/.test(t)){r="Linux"}else if(/windows/.test(e)){r="Windows"}}q.host.app=n;if(i){q.host.version=i}q.host.os=r}var e="outer";var t="main";var n="init";var r="debug";var i="stsp";var s="inp";var o="inlabel";var u="inspan";var a="inbox";var f="grid";var l="footer";var c="monitor";var h="login";var p="login_em";var d="login_pw1";var v="login_pw2";var m="login_but";var g="login_su";var y="login_re";var b="image_";var w="sprite_";var E="pathmap_";var S="timer_";var x=512;var T=1/255;var N=256*256;var C=256;var k=1024;var L={};var A=6;var O=16;var M=17;var _=-1;var D=4;var P=1.4142;var H=16;var B=["a0","bb0","b0","c1","db1","d1","eb1","e1","f1","gb1","g1","ab1","a1","bb1","b1","c2","db2","d2","eb2","e2","f2","gb2","g2","ab2","a2","bb2","b2","c3","db3","d3","eb3","e3","f3","gb3","g3","ab3","a3","bb3","b3","c4","db4","d4","eb4","e4","f4","gb4","g4","ab4","a4","bb4","b4","c5","db5","d5","eb5","e5","f5","gb5","g5","ab5","a5","bb5","b5","c6","db6","d6","eb6","e6","f6","gb6","g6","ab6","a6","bb6","b6","c7","db7","d7","eb7","e7","f7","gb7","g7","ab7","a7","bb7","b7","c8"];var j=["a2","bb2","b2","c3","db3","d3","eb3","e3","f3","gb3","g3","ab3","a3","bb3","b3","c4","db4","d4","eb4","e4","f4","gb4","g4","ab4","a4","bb4","b4","c5","db5","d5","eb5","e5","f5","gb5","g5","ab5","a5","bb5","b5","c6","db6","d6","eb6","e6","f6","gb6","g6","ab6","a6","bb6","b6","c7","db7","d7","eb7","e7","f7"];var F=["a4","bb4","b4","c5","db5","d5","eb5","e5","f5","gb5","g5","ab5","a5","bb5","b5","c6","db6","d6","eb6","e6","f6","gb6","g6","ab6","a6","bb6","b6","c7","db7","d7","eb7","e7","f7","gb7","g7","ab7","a7","bb7","b7"];var I={grid:{x:8,y:8,max:32,plane:0,color:{r:255,g:255,b:255,a:255,rgb:16777215,str:"rgba(255,255,255,1)"},shadow:{show:false,r:192,g:192,b:192,a:255,rgb:12632256,str:"rgba(192,192,192,1)",params:"0px 0px 64px 8px "},padLeft:0,padRight:0,ready:false},status:{text:"",label:"",exec:null,color:{r:0,g:0,b:0,a:255,rgb:0,str:"rgba(0,0,0,1)"}},fader:{active:false,kill:false,r:0,g:0,b:0,rgb:null,tr:0,tg:0,tb:0,trgb:0,tstr:null,step:0,rate:0,onStep:null,onEnd:null,params:null},bead:{dirty:true,active:true,visible:true,planes:null,color:{r:255,g:255,b:255,a:255,rgb:16777215,str:"rgba(255,255,255,1)"},bgColor:{r:255,g:255,b:255,a:0,rgb:16777215,str:"rgba(255,255,255,0)"},radius:0,scale:100,data:0,exec:null,border:{width:1,equal:true,top:1,left:1,bottom:1,right:1,color:{r:128,g:128,b:128,a:255,rgb:8421504,str:"rgba(128,128,128,1)"}},glyph:{str:"",code:0,scale:100,size:0,x:0,y:0,font:null,color:{r:0,g:0,b:0,a:255,rgb:0,str:"rgba(0,0,0,1)"}}},audio:{volume:.5,max_volume:1,path:"http://alpheus.wpi.edu/~bmoriarty/ps/audio/",loop:false,error_sound:"fx_uhoh"}};var q={engine:"Perlenspiel",major:3,minor:1,revision:6,audio:null,host:{app:"",version:"",os:""},inputs:{touch:false}};var R,U,z,W;var X=null;var V=null;var $;var J;var K;var Q=false;var G;var Y;var Z;var et;var tt;var nt;var rt;var it;var st;var ot;var ut;var at;var ft;var lt;var ct;var ht;var pt;var dt;var vt;var mt;var gt;var yt;var bt;var wt;var Et;var St;var xt;var Tt=-1;var Nt;var Ct;var kt;var Lt;var At;var Ot;var Mt=null;var _t=50;var Dt=1;var zt={rgb:0,r:0,g:0,b:0,str:""};var tn=true;var nn=false;var gn={rgb:0,r:0,g:0,b:0,str:""};var En={rgb:0,r:null,g:null,b:null,str:""};jr.prototype={push:function(e){this.content.push(e);this.bubbleUp(this.content.length-1)},pop:function(){var e,t;e=this.content[0];t=this.content.pop();if(this.content.length>0){this.content[0]=t;this.sinkDown(0)}return e},remove:function(e){var t,n,r;t=this.content.length;for(n=0;n<t;n+=1){if(this.content[n]===e){r=this.content.pop();if(n!==t-1){this.content[n]=r;this.bubbleUp(n);this.sinkDown(n)}break}}},size:function(){var e;e=this.content.length;return e},bubbleUp:function(e){var t,n,r,i;t=this.content[e];n=this.scoreFunction(t);while(e>0){r=Math.floor((e+1)/2)-1;i=this.content[r];if(n>=this.scoreFunction(i)){break}this.content[r]=t;this.content[e]=i;e=r}},sinkDown:function(e){var t,n,r,i,s,o,u,a,f,l;t=this.content.length;n=this.content[e];r=this.scoreFunction(n);while(true){s=(e+1)*2;i=s-1;o=null;if(i<t){u=this.content[i];a=this.scoreFunction(u);if(a<r){o=i}}if(s<t){f=this.content[s];l=this.scoreFunction(f);if(l<(o===null?r:a)){o=s}}if(o===null){break}this.content[e]=this.content[o];this.content[o]=n;e=o}},rescore:function(e){this.sinkDown(this.content.indexOf(e))}};PS={ALL:"PS.ALL",CURRENT:"PS.CURRENT",DONE:"PS.DONE",DEFAULT:"PS.DEFAULT",ERROR:"PS.ERROR",EMPTY:"PS.EMPTY",UNEQUAL:"PS.UNEQUAL",GRID:"PS.GRID",STATUS:"PS.STATUS",HTML5_AUDIO:"PS.HTML5_AUDIO",WEB_AUDIO:"PS.WEB_AUDIO",SPRITE_TOUCH:"PS.SPRITE_TOUCH",SPRITE_OVERLAP:"PS.SPRITE_OVERLAP",COLOR_BLACK:0,COLOR_WHITE:16777215,COLOR_GRAY_LIGHT:12632256,COLOR_GRAY:8421504,COLOR_GRAY_DARK:4210752,COLOR_RED:16711680,COLOR_ORANGE:16744448,COLOR_YELLOW:16776960,COLOR_GREEN:65280,COLOR_BLUE:255,COLOR_INDIGO:4194559,COLOR_VIOLET:8388863,COLOR_MAGENTA:16711935,COLOR_CYAN:65535,ALPHA_OPAQUE:255,ALPHA_TRANSPARENT:0,KEY_ENTER:13,KEY_TAB:9,KEY_ESCAPE:27,KEY_PAGE_UP:1001,KEY_PAGE_DOWN:1002,KEY_END:1003,KEY_HOME:1004,KEY_ARROW_LEFT:1005,KEY_ARROW_UP:1006,KEY_ARROW_RIGHT:1007,KEY_ARROW_DOWN:1008,KEY_INSERT:1009,KEY_DELETE:1010,KEY_PAD_0:96,KEY_PAD_1:97,KEY_PAD_2:98,KEY_PAD_3:99,KEY_PAD_4:100,KEY_PAD_5:101,KEY_PAD_6:102,KEY_PAD_7:103,KEY_PAD_8:104,KEY_PAD_9:105,KEY_F1:112,KEY_F2:113,KEY_F3:114,KEY_F4:115,KEY_F5:116,KEY_F6:117,KEY_F7:118,KEY_F8:119,KEY_F9:120,KEY_F10:121,WHEEL_FORWARD:"PS.WHEEL_FORWARD",WHEEL_BACKWARD:"PS.WHEEL_BACKWARD",FINDER_ASTAR:"PS.FINDER_ASTAR",FINDER_BREADTH_FIRST:"PS.FINDER_BREADTH_FIRST",FINDER_BEST_FIRST:"PS.FINDER_BEST_FIRST",FINDER_DIJKSTRA:"PS.FINDER_DIJKSTRA",FINDER_BI_ASTAR:"PS.FINDER_BI_ASTAR",FINDER_BI_BEST_FIRST:"PS.FINDER_BI_BEST_FIRST",FINDER_BI_DIJKSTRA:"PS.FINDER_BI_DIJKSTRA",FINDER_BI_BREADTH_FIRST:"PS.FINDER_BI_BREADTH_FIRST",FINDER_JUMP_POINT:"PS.FINDER_JUMP_POINT",_lastTick:0,_clock:function(){if(nt){window.requestAnimationFrame(PS._clock);mn()}},_sys:function(){var h,p,d,v,m,g,y,b,w,E,S,N,C,O,M,_,D,P,H;h="[PS.sys] ";if(!String.fromCodePoint){String.fromCodePoint=It}R=[];R.length=256;U=[];U.length=256;z=[];z.length=256;W=[];W.length=256;for(p=0;p<256;p+=1){R[p]="rgba("+p+",";U[p]=p+",";z[p]=p+",1)";M=Math.floor(T*p*1e3)/1e3;W[p]=M+")"}Zr();wt=screen.width/document.documentElement.clientWidth;bt=Yr();q.inputs.touch=bt;document.body.id="body";document.body.style.backgroundColor=I.grid.color.str;V=document.getElementById(n);if(V){V.parentNode.removeChild(V)}d=document.createElement("div");d.id=e;document.body.appendChild(d);X=document.createElement("div");X.id=t;d.appendChild(X);PS._mainLeft=X.offsetLeft;PS._mainTop=X.offsetTop;m=document.createElement("p");m.id=i;m.style.whiteSpace="nowrap";m.style.display="block";g=document.createTextNode(".");m.appendChild(g);X.appendChild(m);y=document.createElement("p");y.id=s;y.style.display="none";w=document.createElement("span");w.id=o;b=document.createTextNode("");w.appendChild(b);y.appendChild(w);w=document.createElement("span");w.id=u;E=document.createElement("input");E.id=a;E.type="text";E.tabindex=0;E.wrap="soft";w.appendChild(E);y.appendChild(w);X.appendChild(y);K={statusP:m,statusNode:g,inputP:y,inputNode:b,input:E,fader:cn(i,$t,null)};jt(I.status,K);Kr("Perlenspiel 3.1");S=document.createElement("canvas");if(!S){window.alert(h+"HTML5 canvas not supported.");return}S.id=f;S.width=x;S.style.backgroundColor=I.grid.color.str;S.style.boxShadow="none";xt=false;Hn();X.appendChild(S);N=document.createElement("p");N.id=l;N.style.opacity="1.0";N.innerHTML="Loading Perlenspiel";X.appendChild(N);kt=N;v=document.createElement("div");v.id=r;X.appendChild(v);C=document.createElement("textarea");C.id=c;C.rows=8;C.wrap="soft";C.readonly="readonly";C.onfocus=function(){Ct=true};C.onblur=function(){Ct=false};v.appendChild(C);Nt=false;Ct=false;ut=false;ct=[];at=[];ft=[];lt=[];for(p=0;p<256;p+=1){ct[p]=0;at[p]=p;ft[p]=p;lt[p]=p}ht=[];pt=false;dt=false;vt=true;gt=A;yt=A*5;at[33]=PS.KEY_PAGE_UP;at[34]=PS.KEY_PAGE_DOWN;at[35]=PS.KEY_END;at[36]=PS.KEY_HOME;at[37]=PS.KEY_ARROW_LEFT;at[38]=PS.KEY_ARROW_UP;at[39]=PS.KEY_ARROW_RIGHT;at[40]=PS.KEY_ARROW_DOWN;at[45]=PS.KEY_INSERT;at[46]=PS.KEY_DELETE;at[188]=44;at[190]=46;at[191]=47;at[192]=96;at[219]=91;at[220]=92;at[221]=93;at[222]=39;ft[96]=126;ft[49]=33;ft[50]=64;ft[51]=35;ft[52]=36;ft[53]=37;ft[54]=94;ft[55]=38;ft[56]=42;ft[57]=40;ft[48]=41;ft[45]=95;ft[61]=43;ft[91]=123;ft[93]=125;ft[92]=124;ft[59]=58;ft[39]=34;ft[44]=60;ft[46]=62;ft[47]=63;for(p=65;p<91;p+=1){lt[p]=p+32}lt[126]=96;lt[33]=49;lt[64]=50;lt[35]=51;lt[36]=52;lt[37]=53;lt[94]=54;lt[38]=55;lt[42]=56;lt[40]=57;lt[41]=48;lt[95]=45;lt[43]=51;lt[123]=91;lt[125]=93;lt[124]=92;lt[58]=59;lt[34]=39;lt[60]=44;lt[62]=46;lt[63]=47;window.onblur=Wn();O=S.getContext("2d");if(!O.constructor.prototype.fillRoundedRect){O.constructor.prototype.fillRoundedRect=function(e,t,n,r,i,s,o){if(i===undefined){i=5}this.beginPath();if(q.host.app==="Opera"){this.moveTo(e+n-i,t);this.arcTo(e+i,t,e,t+i,i);this.arcTo(e,t+r-i,e+i,t+r,i);this.arcTo(e+n-i,t+r,e+n,t+r-i,i);this.arcTo(e+n,t+i,e+n-i,t,i)}else{this.moveTo(e+i,t);this.arcTo(e+n,t,e+n,t+r,i);this.arcTo(e+n,t+r,e,t+r,i);this.arcTo(e,t+r,e,t,i);this.arcTo(e,t,e+n,t,i)}this.closePath();if(o){this.stroke()}if(s||s===undefined){this.fill()}}}$={canvas:S,context:O,fader:cn(f,Wt,Xt)};jt(I.grid,$);var B=window.getComputedStyle($.canvas,null);$.padLeft=parseInt(B.getPropertyValue("padding-top").replace("px",""),10);$.padRight=parseInt(B.getPropertyValue("padding-left").replace("px",""),10);J=[];J.length=M=k;for(p=0;p<M;p+=1){_={index:p,fader:cn(p,Jt,null),borderFader:cn(p,Kt,null),glyphFader:cn(p,Qt,null)};Tn(_);J[p]=_}et=[];tt=0;At=[];Ot=0;D=null;if(q.host.os!=="iOS"){D=AQ.init({defaultPath:I.audio.path,defaultFileTypes:["ogg","mp3","wav"],onAlert:PS.debug,stack:true,forceHTML5:true});if(D===PS.ERROR||D.status===AQ.ERROR){return}q.audio=D;Lt=null;P=PS.audioLoad(I.audio.error_sound,{path:I.audio.path,lock:true});if(P===PS.ERROR){en("Error sound '"+I.audio.error_sound+"' not loaded")}else{Lt=I.audio.error_sound}}G=document.createElement("canvas");O=G.getContext("2d");O.imageSmoothingEnabled=false;O.mozImageSmoothingEnabled=false;O.webkitImageSmoothingEnabled=false;Y=[];Z=0;H="() event function undefined";if(typeof PS.init!=="function"){PS.init=null;en("PS.init"+H)}if(typeof PS.touch!=="function"){PS.touch=null;en("PS.touch"+H)}if(typeof PS.release!=="function"){PS.release=null;en("PS.release"+H)}if(typeof PS.enter!=="function"){PS.enter=null;en("PS.enter"+H)}if(typeof PS.exit!=="function"){PS.exit=null;en("PS.exit()"+H)}if(typeof PS.exitGrid!=="function"){PS.exitGrid=null;en("PS.exitGrid"+H)}if(typeof PS.keyDown!=="function"){PS.keyDown=null;en("PS.keyDown"+H)}if(typeof PS.keyUp!=="function"){PS.keyUp=null;en("PS.keyUp"+H)}if(typeof PS.input!=="function"){PS.input=null;en("PS.input"+H)}H="PS "+q.major+"."+q.minor+"."+q.revision+" | ";if(D){H+=D.engine+" "+D.major+"."+D.minor+"."+D.revision+" | "}H+=q.host.os+" "+q.host.app+" "+q.host.version;if(bt){H+=" | Touch "}N.innerHTML=H;tr(I.grid.x,I.grid.y);fn();vn();nt=true;PS._clock();Yn();Mt=PS.timerStart(6,Pt);if(PS.init){try{PS.init(q,L);Yt()}catch(j){on("PS.init() failed ["+j.message+"]",j)}}},gridSize:function(e,t){var n,r,i,s;n="[PS.gridSize] ";if(arguments.length>2){return un(n+"Too many arguments")}r=e;i=t;s=I.grid.max;if(r===PS.DEFAULT){r=I.grid.x}else if(r===PS.CURRENT){r=$.x}else if(Ht(r)==="number"){r=Math.floor(r);if(r<1){r=1}else if(r>s){r=s}}else{return un(n+"x argument invalid")}if(i===PS.DEFAULT){i=I.grid.y}else if(i===PS.CURRENT){i=$.y}else if(Ht(i)==="number"){i=Math.floor(i);if(i<1){i=1}else if(i>s){i=s}}else{return un(n+"y argument invalid")}tr(r,i);return{width:$.x,height:$.y}},gridPlane:function(e){var t,n,r;t="[PS.gridPlane] ";if(arguments.length>1){return un(t+"Too many arguments")}n=e;r=Ht(n);if(r!=="undefined"&&n!==PS.CURRENT){if(n===PS.DEFAULT){n=0}else if(r==="number"){n=Math.floor(n);if(n<1){n=0}}else{return un(t+"plane argument invalid")}$.plane=n}return $.plane},gridColor:function(e,t,n){var r,i;r="[PS.gridColor] ";if(arguments.length>3){return un(r+"Too many arguments")}i=Sn(r,e,t,n);if(i===PS.ERROR){return PS.ERROR}return Zn(i)},gridFade:function(e,t){var n,r,i,s,o,u,a,f;n="[PS.gridFade] ";if(arguments.length>2){return un(n+"Too many arguments")}i=$.color;r=$.fader;s=r.rate;a=Ht(e);if(a==="undefined"||e===PS.CURRENT){o=s}else if(e===PS.DEFAULT){o=I.fader.rate}else if(a==="number"){o=Math.floor(e);if(o<0){o=0}}else{return un(n+"rate argument invalid")}u=ur(n,t);if(u===PS.ERROR){return PS.ERROR}f=u.rgb;if(f!==PS.CURRENT){if(f===PS.DEFAULT){r.rgb=I.fader.rgb}else{r.rgb=f}r.r=u.r;r.g=u.g;r.b=u.b}f=u.onStep;if(f!==PS.CURRENT){if(f===PS.DEFAULT){r.onStep=I.fader.onStep}else{r.onStep=f}}f=u.onEnd;if(f!==PS.CURRENT){if(f===PS.DEFAULT){r.onEnd=I.fader.onEnd}else{r.onEnd=f}}f=u.params;if(f!==PS.CURRENT){if(f===PS.DEFAULT){r.params=I.fader.params}else{r.params=f}}if(s!==o){r.rate=o;if(o<1){r.active=false;r.kill=true}else if(r.active){dn(r,i.r,i.g,i.b,255)}}return{rate:r.rate,rgb:r.rgb,onStep:r.onStep,onEnd:r.onEnd,params:r.params}},gridShadow:function(e,t,n,r){var i,s,o;i="[PS.gridShadow] ";if(arguments.length>4){return un(i+"Too many arguments")}s=e;if(s!==true&&s!==false&&s!==PS.CURRENT){if(s===null||s===PS.DEFAULT){s=false}else if(Ht(s)==="number"){s=s!==0}else{return un(i+"First argument invalid")}}o=Sn(i,t,n,r);if(o===PS.ERROR){return PS.ERROR}return er(s,o)},color:function(e,t,n,r,i){var s,o,u;s="[PS.color] ";o=arguments.length;if(o<2){return un(s+"Missing argument(s)")}if(o>5){return un(s+"Too many arguments")}u=Sn(s,n,r,i);if(u===PS.ERROR){return PS.ERROR}return ir(s,sr,e,t,u)},alpha:function(e,t,n){var r,i,s,o;r="[PS.alpha] ";i=arguments.length;if(i<2){return un(r+"Missing argument(s)")}if(i>3){return un(r+"Too many arguments")}s=n;if(s!==PS.CURRENT){o=Ht(s);if(o==="undefined"){s=PS.CURRENT}else if(o==="number"){s=Math.floor(s);if(s<0){s=0}else if(s>255){s=255}}else if(s===PS.DEFAULT){s=I.bead.color.a}else{return un(r+"alpha argument invalid")}}return ir(r,or,e,t,s)},fade:function(e,t,n,r){var i,s,o,u,a;i="[PS.fade] ";s=arguments.length;if(s<2){return un(i+"Missing argument(s)")}if(s>4){return un(i+"Too many arguments")}o=n;if(o!==PS.CURRENT&&o!==PS.DEFAULT){u=Ht(o);if(u==="undefined"){o=PS.CURRENT}else if(u==="number"){o=Math.floor(o);if(o<0){o=0}}else{return un(i+"rate argument invalid")}}a=ur(i,r);if(a===PS.ERROR){return PS.ERROR}return ir(i,ar,e,t,o,a)},scale:function(e,t,n){var r,i,s,o;r="[PS.scale] ";i=arguments.length;if(i<2){return un(r+"Missing argument(s)")}if(i>3){return un(r+"Too many arguments")}s=n;if(s!==PS.CURRENT){o=Ht(s);if(o==="undefined"){s=PS.CURRENT}else if(s===PS.DEFAULT){s=100}else if(o==="number"){s=Math.floor(s);if(s<50){s=50}else if(s>100){s=100}}else{return un(r+"scale parameter invalid")}}return ir(r,fr,e,t,s)},radius:function(e,t,n){var r,i,s,o;r="[PS.radius] ";i=arguments.length;if(i<2){return un(r+"Missing argument(s)")}if(i>3){return un(r+"Too many arguments")}s=n;if(s!==PS.CURRENT){o=Ht(s);if(o==="undefined"){s=PS.CURRENT}else if(s===PS.DEFAULT){s=0}else if(o==="number"){s=Math.floor(s);if(s<0){s=0}else if(s>50){s=50}}else{return un(r+"radius parameter invalid")}}return ir(r,lr,e,t,s)},bgColor:function(e,t,n,r,i){var s,o,u;s="[PS.bgColor] ";o=arguments.length;if(o<2){return un(s+"Missing argument(s)")}if(o>5){return un(s+"Too many arguments")}u=Sn(s,n,r,i);if(u===PS.ERROR){return PS.ERROR}return ir(s,cr,e,t,u)},bgAlpha:function(e,t,n){var r,i,s,o;r="[PS.bgAlpha] ";i=arguments.length;if(i<2){return un(r+"Missing argument(s)")}if(i>3){return un(r+"Too many arguments")}s=n;if(s!==PS.CURRENT){o=Ht(s);if(o==="undefined"){s=PS.CURRENT}else if(o==="number"){s=Math.floor(s);if(s<0){s=0}else if(s>255){s=255}}else if(s===PS.DEFAULT){s=I.bead.bgColor.a}else{return un(r+"alpha argument invalid")}}return ir(r,hr,e,t,s)},data:function(e,t,n){var r,i,s;r="[PS.data] ";i=arguments.length;if(i<2){return un(r+"Missing argument(s)")}if(i>3){return un(r+"Too many arguments")}s=n;if(s===undefined){s=PS.CURRENT}else if(s===PS.DEFAULT){s=null}return ir(r,pr,e,t,s)},exec:function(e,t,n){var r,i,s,o;r="[PS.exec] ";i=arguments.length;if(i<2){return un(r+"Missing argument(s)")}if(i>3){return un(r+"Too many arguments")}s=n;if(s!==PS.CURRENT){o=Ht(s);if(o==="undefined"){s=PS.CURRENT}else if(s===PS.DEFAULT){s=I.bead.exec}else if(o!=="function"){return un(r+"exec argument invalid")}}return ir(r,dr,e,t,s)},visible:function(e,t,n){var r,i,s;r="[PS.visible] ";i=arguments.length;if(i<2){return un(r+"Missing argument(s)")}if(i>3){return un(r+"Too many arguments")}s=Bt(n,PS.CURRENT,true,PS.CURRENT);if(s===PS.ERROR){return un(r+"show argument invalid")}return ir(r,vr,e,t,s)},active:function(e,t,n){var r,i,s;r="[PS.active] ";i=arguments.length;if(i<2){return un(r+"Missing argument(s)")}if(i>3){return un(r+"Too many arguments")}s=Bt(n,PS.CURRENT,true,PS.CURRENT);if(s===PS.ERROR){return un(r+"active argument invalid")}return ir(r,mr,e,t,s)},border:function(e,t,n){var r,i,s,o,u,a;r="[PS.border] ";i=arguments.length;if(i<2){return un(r+"Missing argument(s)")}if(i>3){return un(r+"Too many arguments")}s=I.bead.border;o=n;if(o!==PS.CURRENT){u=Ht(o);if(u==="undefined"){o=PS.CURRENT}else if(o===PS.DEFAULT){o=s.width}else if(u==="number"){o=Math.floor(o);if(o<0){o=0}}else if(u==="object"){a=o.top;if(a!==PS.CURRENT){u=Ht(a);if(u==="undefined"){o.top=PS.CURRENT}else if(u==="number"){a=Math.floor(a);if(a<0){a=0}o.top=a}else if(a===PS.DEFAULT){o.top=s.top}else{return un(r+".top property invalid")}}a=o.left;if(a!==PS.CURRENT){u=Ht(a);if(u==="undefined"){o.left=PS.CURRENT}else if(u==="number"){a=Math.floor(a);if(a<0){a=0}o.left=a}else if(a===PS.DEFAULT){o.left=s.left}else{return un(r+".left property invalid")}}a=o.bottom;if(a!==PS.CURRENT){u=Ht(a);if(u==="undefined"){o.bottom=PS.CURRENT}else if(u==="number"){a=Math.floor(a);if(a<0){a=0}o.bottom=a}else if(a===PS.DEFAULT){o.bottom=s.bottom}else{return un(r+".bottom property invalid")}}a=o.right;if(a!==PS.CURRENT){u=Ht(a);if(u==="undefined"){o.right=PS.CURRENT}else if(u==="number"){a=Math.floor(a);if(a<0){a=0}o.right=a}else if(a===PS.DEFAULT){o.right=s.right}else{return un(r+".right property invalid")}}}else{return un(r+"width argument invalid")}}return ir(r,gr,e,t,o)},borderColor:function(e,t,n,r,i){var s,o;s="[PS.borderColor] ";if(arguments.length<2){return un(s+"Missing argument(s)")}if(arguments.length>5){return un(s+"Too many arguments")}o=Sn(s,n,r,i);if(o===PS.ERROR){return PS.ERROR}return ir(s,yr,e,t,o)},borderAlpha:function(e,t,n){var r,i,s,o;r="[PS.borderAlpha] ";i=arguments.length;if(i<2){return un(r+"Missing argument(s)")}if(i>3){return un(r+"Too many arguments")}s=n;if(s!==PS.CURRENT){o=Ht(s);if(o==="undefined"){s=PS.CURRENT}else if(o==="number"){s=Math.floor(s);if(s<0){s=0}else if(s>255){s=255}}else if(s===PS.DEFAULT){s=I.bead.border.color.a}else{return un(r+"alpha argument invalid")}}return ir(r,br,e,t,s)},borderFade:function(e,t,n,r){var i,s,o,u,a;i="[PS.borderFade] ";s=arguments.length;if(s<2){return un(i+"Missing argument(s)")}if(s>4){return un(i+"Too many arguments")}o=n;if(o!==PS.CURRENT&&o!==PS.DEFAULT){u=Ht(o);if(u==="undefined"){o=PS.CURRENT}else if(u==="number"){o=Math.floor(o);if(o<0){o=0}}else{return un(i+"rate argument not a number")}}a=ur(i,r);if(a===PS.ERROR){return PS.ERROR}return ir(i,wr,e,t,o,a)},glyph:function(e,t,n){var r,i,s,o;r="[PS.glyph] ";i=arguments.length;if(i<2){return un(r+"Missing argument(s)")}if(i>3){return un(r+"Too many arguments")}s=n;if(s!==PS.CURRENT){o=Ht(s);if(o==="undefined"){s=PS.CURRENT}else if(s===PS.DEFAULT){s=0}else if(o==="string"){if(s.length>0){s=s.charCodeAt(0)}else{s=0}}else if(o==="number"){s=Math.floor(s);if(s<1){s=0}}else{return un(r+"glyph argument invalid")}}return ir(r,Er,e,t,s)},glyphColor:function(e,t,n,r,i){var s,o;s="[PS.glyphColor] ";if(arguments.length<2){return un(s+"Missing argument(s)")}if(arguments.length>5){return un(s+"Too many arguments")}o=Sn(s,n,r,i);if(o===PS.ERROR){return PS.ERROR}return ir(s,Sr,e,t,o)},glyphAlpha:function(e,t,n){var r,i,s,o;r="[PS.glyphAlpha] ";i=arguments.length;if(i<2){return un(r+"Missing argument(s)")}if(i>3){return un(r+"Too many arguments")}s=n;if(s!==PS.CURRENT){o=Ht(s);if(o==="undefined"){s=PS.CURRENT}else if(o==="number"){s=Math.floor(s);if(s<0){s=0}else if(s>255){s=255}}else if(s===PS.DEFAULT){s=I.bead.glyph.color.a}else{return un(r+"alpha argument invalid")}}return ir(r,xr,e,t,s)},glyphScale:function(e,t,n){var r,i,s,o;r="[PS.glyphScale] ";i=arguments.length;if(i<2){return un(r+"Missing argument(s)")}if(i>3){return un(r+"Too many arguments")}s=n;if(s!==PS.CURRENT){o=Ht(s);if(o==="undefined"){s=PS.CURRENT}else if(o==="number"){s=Math.floor(s);if(s<50){s=50}else if(s>100){s=100}}else if(s===PS.DEFAULT){s=I.bead.glyph.scale}else{return un(r+"scale argument invalid")}}return ir(r,Tr,e,t,s)},glyphFade:function(e,t,n,r){var i,s,o,u,a;i="[PS.glyphFade] ";s=arguments.length;if(s<2){return un(i+"Missing argument(s)")}if(s>4){return un(i+"Too many arguments")}o=n;if(o!==PS.CURRENT&&o!==PS.DEFAULT){u=Ht(o);if(u==="undefined"){o=PS.CURRENT}else if(u==="number"){o=Math.floor(o);if(o<0){o=0}}else{return un(i+"rate argument not a number")}}a=ur(i,r);if(a===PS.ERROR){return PS.ERROR}return ir(i,Nr,e,t,o,a)},statusText:function(e){var t,n,r;t="[PS.statusText] ";if(arguments.length>1){return un(t+"Too many arguments")}n=e;r=Ht(n);if(n!==PS.CURRENT&&r!=="undefined"){if(n===PS.DEFAULT){n=I.status.text}else if(r!=="string"){n=n.toString()}Kr(n)}return K.text},statusInput:function(e,t){var n,r,i,s;n="[PS.statusInput] ";if(arguments.length!==2){return un(n+"Expected 2 arguments")}if(typeof t!=="function"){return un(n+"2nd argument is not a function")}i=e;r=Ht(i);if(r!=="string"){i=i.toString()}s=i.length;if(s>H){i=i.substring(0,H)}Gr(i,t);return K.label},statusColor:function(e,t,n){var r,i,s,o,u,a,f,l;r="[PS.statusColor] ";if(arguments.length>3){return un(r+"Too many arguments")}i=Sn(r,e,t,n);if(i===PS.ERROR){return PS.ERROR}s=K.color;o=K.fader;u=i.rgb;if(u!==PS.CURRENT){if(u===null){a=i.r;if(a===PS.CURRENT){i.r=a=s.r}else if(a===PS.DEFAULT){i.r=a=I.status.color.r}f=i.g;if(f===PS.CURRENT){i.g=f=s.g}else if(f===PS.DEFAULT){i.g=f=I.status.color.g}l=i.b;if(l===PS.CURRENT){i.b=l=s.b}else if(l===PS.DEFAULT){i.b=l=I.status.color.b}i.rgb=a*N+f*C+l}else if(u===PS.DEFAULT){jt(I.status.color,i)}if(s.rgb!==i.rgb||o.rate>0&&o.rgb!==null&&o.rgb!==i.rgb){s.rgb=i.rgb;a=i.r;f=i.g;l=i.b;s.str=i.str=R[a]+U[f]+z[l];if(o.rate>0){if(o.rgb!==null){pn(o,o.r,o.g,o.b,255,a,f,l,255)}if(!o.active){pn(o,s.r,s.g,s.b,255,a,f,l,255)}else{dn(o,a,f,l,255)}}else{$t(s)}s.r=a;s.g=f;s.b=l}}return s.rgb},statusFade:function(e,t){var n,r,i,s,o,u,a,f;n="[PS.statusFade] ";if(arguments.length>2){return un(n+"Too many arguments")}i=K.color;r=K.fader;s=r.rate;u=Ht(e);if(u==="undefined"||e===PS.CURRENT){o=s}else if(e===PS.DEFAULT){o=I.fader.rate}else if(u==="number"){o=Math.floor(e);if(o<0){o=0}}else{return un(n+"rate argument invalid")}f=ur(n,t);if(f===PS.ERROR){return PS.ERROR}a=f.rgb;if(a!==PS.CURRENT){if(a===PS.DEFAULT){r.rgb=I.fader.rgb}else{r.rgb=a}r.r=f.r;r.g=f.g;r.b=f.b}a=f.onStep;if(a!==PS.CURRENT){if(a===PS.DEFAULT){r.onStep=I.fader.onStep}else{r.onStep=a}}a=f.onEnd;if(a!==PS.CURRENT){if(a===PS.DEFAULT){r.onEnd=I.fader.onEnd}else{r.onEnd=a}}a=f.params;if(a!==PS.CURRENT){if(a===PS.DEFAULT){r.params=I.fader.params}else{r.params=a}}if(s!==o){r.rate=o;if(o<1){r.active=false;r.kill=true}else if(r.active){dn(r,i.r,i.g,i.b,255)}}return{rate:r.rate,rgb:r.rgb,onStep:r.onStep,onEnd:r.onEnd,params:r.params}},timerStart:function(e,t){var n,r,i,s,o,u,a,f,l,c;n="[PS.timerStart] ";r=arguments.length;if(r<2){return un(n+"Argument(s) missing")}i=e;s=t;if(i===PS.DEFAULT){i=60}else{o=Ht(i);if(o!=="number"){return un(n+"ticks argument invalid")}i=Math.floor(i);if(i<1){return un(n+"ticks argument less than one (1)")}}if(typeof s!=="function"){return un(n+"exec argument not a function")}a=[];if(r>2){l=r-2;a.length=l;for(f=0;f<l;f+=1){a[f]=arguments[f+2]}}c=S+it;it+=1;u={id:c,delay:i,count:i,exec:s,arglist:a};rt.push(u);return c},timerStop:function(e){var t,n,r,i,s;t="[PS.timerStop] ";n=arguments.length;if(n<1){return un(t+"Argument missing")}if(typeof e!=="string"||e.length<1){return un(t+"id argument invalid")}i=rt.length;for(r=0;r<i;r+=1){s=rt[r];if(s.id===e){rt.splice(r,1);return e}}return un(t+"timer id '"+e+"' not found")},random:function(e){var t,n;t="[PS.random] ";if(arguments.length<1){return un(t+"Argument missing")}n=e;if(Ht(n)!=="number"){return un(t+"Argument not a number")}n=Math.floor(n);if(n<2){return 1}n=Math.random()*n;n=Math.floor(n)+1;return n},makeRGB:function(e,t,n){var r,i,s,o,u;r="[PS.makeRGB] ";i=arguments.length;if(i<3){return un(r+"Argument(s) missing")}if(i>3){return un(r+"Too many arguments")}s=e;o=t;u=n;if(Ht(s)!=="number"){return un(r+"r argument not a number")}s=Math.floor(s);if(s<0){s=0}else if(s>255){s=255}if(Ht(o)!=="number"){return un(r+"g argument not a number")}o=Math.floor(o);if(o<0){o=0}else if(o>255){o=255}if(Ht(u)!=="number"){return un(r+"b argument not a number")}u=Math.floor(u);if(u<0){u=0}else if(u>255){u=255}return s*N+o*C+u},unmakeRGB:function(e,t){var n,r,i,s,o,u,a,f,l,c;n="[PS.unmakeRGB] ";r=arguments.length;if(r<2){return un(n+"Missing argument(s)")}if(r>2){return un(n+"Too many arguments")}i=e;s=t;if(Ht(i)!=="number"){return un(n+"rgb argument not a number")}i=Math.floor(i);if(i<1){i=0;o=0;u=0;a=0}else if(i>=16777215){i=16777215;o=255;u=255;a=255}else{o=i/N;o=Math.floor(o);f=o*N;u=(i-f)/C;u=Math.floor(u);l=u*C;a=i-f-l}c=Ht(s);if(c==="object"){s.rgb=i;s.r=o;s.g=u;s.b=a}else if(c==="array"){if(s.length<3){s.length=3}s[0]=o;s[1]=u;s[2]=a}else{return un(n+"result argument not an array or object reference")}return s},applyRect:function(e,t,n,r,i){var s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E;s="[PS.applyRect] ";o=arguments.length;if(o<5){return un(s+"Argument(s) missing")}u=$.x;a=$.y;f=e;l=t;c=n;h=r;p=i;if(f===PS.DEFAULT){f=0}else if(Ht(f)==="number"){f=Math.floor(f);if(f>=u){return PS.DONE}if(f<0){f=0}}else{return un(s+"left argument invalid")}if(l===PS.DEFAULT){l=0}else if(Ht(l)==="number"){l=Math.floor(l);if(l>=a){return PS.DONE}if(l<0){l=0}}else{return un(s+"top argument invalid")}if(c===PS.DEFAULT){c=u-f}else if(Ht(c)==="number"){c=Math.floor(c);if(c<1){return PS.DONE}if(f+c>u){c=u-f}}else{return un(s+"width argument invalid")}d=f+c;if(h===PS.DEFAULT){h=a-l}else if(Ht(h)==="number"){h=Math.floor(h);if(h<1){return PS.DONE}if(l+h>a){h=a-l}}else{return un(s+"height argument invalid")}v=l+h;if(!p||typeof p!=="function"){return un(s+"exec argument not a function")}b=[0,0];if(o>5){w=o-5;for(E=0;E<w;E+=1){b.push(arguments[E+5])}}for(g=l;g<v;g+=1){b[1]=g;for(m=f;m<d;m+=1){b[0]=m;try{y=p.apply(L,b)}catch(S){y=on(s+"exec failed @"+m+", "+g+" ["+S.message+"]",S)}if(y===PS.ERROR){return PS.ERROR}}}return y},hex:function(e,t){var n,r,i,s,o;n="[PS.hex] ";r=e;i=Ht(r);if(i!=="number"){return un(n+"value argument invalid")}r=Math.floor(r);r=Math.abs(r);s=t;i=Ht(s);if(i==="undefined"||s===PS.DEFAULT){s=2}else if(i==="number"){s=Math.floor(s);if(s<1){s=1}}else{return un(n+"padding argument invalid")}o=Number(r).toString(16);while(o.length<s){o="0"+o}return"0x"+o},keyRepeat:function(e,t,n){var r,i,s,o,u;r="[PS.keyRepeat] ";s=Bt(e,vt,true,true);if(s===PS.ERROR){return un(r+"repeat argument invalid")}u=t;i=Ht(u);if(i==="undefined"||u===PS.DEFAULT){u=A*5}else if(u===PS.CURRENT){u=yt}else if(i==="number"){u=Math.floor(u);if(u<1){u=1}}else{return un(r+"init argument invalid")}o=n;i=Ht(o);if(i==="undefined"||o===PS.DEFAULT){o=A}else if(o===PS.CURRENT){o=gt}else if(i==="number"){o=Math.floor(o);if(o<1){o=1}}else{return un(r+"delay argument invalid")}vt=s;yt=u;gt=o;return{repeat:vt,init:yt,delay:gt}},imageLoad:function(e,t,n){var r,i,s,o,u,a,f,l,c;r="[PS.imageLoad] ";i=arguments.length;if(i<2){return un(r+"Missing argument(s)")}if(i>3){return un(r+"Too many argument(s)")}s=e;o=t;u=n;if(typeof s!=="string"||s.length<1){return un(r+"filename argument invalid")}a=s.substr(s.lastIndexOf(".")+1);a=a.toLowerCase();if(a!=="png"&&a!=="jpg"&&a!=="jpeg"&&a!=="bmp"){return un(r+"filename extension invalid")}if(typeof o!=="function"){return un(r+"exec argument invalid")}c=Ht(u);if(c==="undefined"||u===PS.DEFAULT){u=4}else{if(c!=="number"){return un(r+"format argument invalid")}u=Math.floor(u);if(u<1&&u>4){return un(r+"format argument is not 1, 2, 3 or 4")}}l=b+Z;Z+=1;Y.push({source:s,id:l,exec:o,format:u});try{f=new Image;f.setAttribute("data-id",l);f.onload=function(){Lr(f)};f.onerror=function(){Cr(f)};f.src=s}catch(h){return on(r+"Error loading "+s+" ["+h.message+"]",h)}return l},imageBlit:function(e,t,n,r){var i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U;i="[PS.imageBlit] ";s=arguments.length;if(s<3){return un(i+"Missing argument(s)")}if(s>4){return un(i+"Too many arguments")}o=$.x;u=$.y;a=e;f=t;l=n;c=r;if(Ar(i,a)===PS.ERROR){return PS.ERROR}h=a.width;p=a.height;d=a.pixelSize;v=a.data;m=Ht(f);if(m==="undefined"||f===PS.DEFAULT){f=0}else if(m==="number"){f=Math.floor(f)}else{return un(i+"xpos argument invalid")}m=Ht(l);if(m==="undefined"||l===PS.DEFAULT){l=0}else if(m==="number"){l=Math.floor(l)}else{return un(i+"ypos argument invalid")}if(f>=o||l>=u||f+h<1||l+p<1){return false}m=Ht(c);if(m==="undefined"||c===PS.DEFAULT){g=0;y=0;b=h;w=p}else if(m==="object"){y=c.left;m=Ht(y);if(m==="undefined"||y===PS.DEFAULT){y=0}else{if(m!=="number"){return un(i+"region.left invalid")}y=Math.floor(y);if(y<0){y=0}else if(y>=h){return un(i+"region.left outside image")}}g=c.top;m=Ht(g);if(m==="undefined"||g===PS.DEFAULT){g=0}else{if(m!=="number"){return un(i+"region.top invalid")}g=Math.floor(g);if(g<0){g=0}else if(g>=p){return un(i+"region.top outside image")}}b=c.width;m=Ht(b);if(m==="undefined"||b===PS.DEFAULT){b=h-y}else{if(m!=="number"){return un(i+"region.width invalid")}b=Math.floor(b);if(b<1){return false}if(y+b>h){b=h-y}}if(f+b<1){return false}w=c.height;m=Ht(w);if(m==="undefined"||w===PS.DEFAULT){w=p-g}else{if(m!=="number"){return un(i+"region.height invalid")}w=Math.floor(w);if(w<1){return false}if(g+w>p){w=p-g}}if(l+w<1){return false}}else{return un(i+"region argument invalid")}if(f<0){b+=f;if(b<1){return false}y-=f;f=0}S=f+b;if(S>o){b=o-f}if(b<1){return false}if(l<0){w+=l;if(w<1){return false}g-=l;l=0}S=l+w;if(S>u){w=u-l}if(w<1){return false}x=h*d;U=false;H=255;E=$.plane;T=g*x+y*d;A=l;for(O=0;O<w;O+=1){k=T;L=f;for(M=0;M<b;M+=1){I=L+A*o;q=J[I];if(q.active){U=true;if(d<3){B=v[k];_=B/N;_=Math.floor(_);j=_*N;D=(B-j)/C;D=Math.floor(D);F=D*C;P=B-j-F;if(d===2){H=v[k+1]}}else{_=v[k];D=v[k+1];P=v[k+2];B=_*N+D*C+P;if(d===4){H=v[k+3]}}R=Nn(q,E);R.r=_;R.g=D;R.b=P;R.a=H;R.rgb=B;yn(q)}L+=1;k+=d}A+=1;T+=x}if(U){Yt()}return true},imageCapture:function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,w,E,S,x,T,N;n="[PS.imageCapture] ";r=arguments.length;if(r>2){return un(n+"Too many arguments")}i=e;s=t;o=Ht(i);if(o==="undefined"||i===PS.DEFAULT){i=3}else{if(o!=="number"){return un(n+"format argument invalid")}i=Math.floor(i);if(i<1&&i>4){return un(n+"format argument is not 1, 2, 3 or 4")}}u=$.x;a=$.y;o=Ht(s);if(o==="undefined"||s===PS.DEFAULT){l=0;c=0;h=u;p=a}else if(o==="object"){c=s.left;o=Ht(c);if(o==="undefined"||c===PS.DEFAULT){c=0}else{if(o!=="number"){return un(n+"region.left not a number")}c=Math.floor(c);if(c<0){c=0}else if(c>=u){return un(n+"region.left outside grid")}}l=s.top;o=Ht(l);if(o==="undefined"||l===PS.DEFAULT){l=0}else{if(o!=="number"){return un(n+"region.top not a number")}l=Math.floor(l);if(l<0){l=0}else if(l>=a){return un(n+"region.top outside grid")}}h=s.width;o=Ht(h);if(o==="undefined"||h===PS.DEFAULT){h=u-c}else{if(o!=="number"){return un(n+"region.width not a number")}h=Math.floor(h);if(h<1||c+h>u){h=u-c}}p=s.height;o=Ht(p);if(o==="undefined"||p===PS.DEFAULT){p=a-l}else{if(o!=="number"){return un(n+"region.height not a number")}p=Math.floor(p);if(p<1||l+p>a){p=a-l}}}else{return un(n+"region argument invalid")}y=b+Z;Z+=1;v={source:PS.GRID,id:y,width:h,height:p,pixelSize:i,valid:true,data:[]};d=h*p;if(d<1){return v}f=v.data;f.length=d*i;m=c+h;g=l+p;w=0;for(S=l;S<g;S+=1){for(E=c;E<m;E+=1){x=E+S*u;T=J[x];N=T.color;if(i<3){f[w]=N.rgb;if(i===2){f[w+1]=N.a}}else{f[w]=N.r;f[w+1]=N.g;f[w+2]=N.b;if(i===4){f[w+3]=N.a}}w+=i}}return v},imageDump:function(e,t,n,r,i){var s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,k,L,A,O,M,_,D,P,H,B,j,F;s="[PS.imageDump] ";o=arguments.length;if(o<1){return un(s+"Missing argument(s)")}if(o>5){return un(s+"Too many arguments")}u=e;a=t;f=n;l=r;if(Ar(s,u)===PS.ERROR){return PS.ERROR}h=u.width;p=u.height;d=u.pixelSize;v=u.data;m=Ht(a);if(m==="undefined"||a===PS.DEFAULT){g=0;y=0;b=h;w=p}else if(m==="object"){y=a.left;m=Ht(y);if(m==="undefined"||y===PS.DEFAULT){y=0}else{if(m!=="number"){return un(s+"region.left invalid")}y=Math.floor(y);if(y<0){y=0}else if(y>=h){return un(s+"region.left outside grid")}}g=a.top;m=Ht(g);if(m==="undefined"||g===PS.DEFAULT){g=0}else{if(m!=="number"){return un(s+"region.top invalid")}g=Math.floor(g);if(g<0){g=0}else if(g>=p){return un(s+"region.top outside grid")}}b=a.width;m=Ht(b);if(m==="undefined"||b===PS.DEFAULT){b=h-y}else{if(m!=="number"){return un(s+"region.width invalid")}b=Math.floor(b);if(b<1||y+b>h){b=h-y}}w=a.height;m=Ht(w);if(m==="undefined"||w===PS.DEFAULT){w=p-g}else{if(m!=="number"){return un(s+"region.height invalid")}w=Math.floor(w);if(w<1||g+w>p){w=p-g}}}else{return un(s+"region argument invalid")}E=b*w;m=Ht(f);if(m==="undefined"||f===PS.DEFAULT){f=d}else{if(m!=="number"){return un(s+"format argument invalid")}f=Math.floor(f);if(f<1||f>4){return un(s+"format argument is not 1, 2, 3 or 4")}}m=Ht(l);if(m==="undefined"||l===PS.DEFAULT){l=b}else{if(m!=="number"){return un(s+"length argument invalid")}l=Math.floor(l);if(l<1){l=1}if(l>E){l=E}}c=Bt(i,PS.ERROR,true,true);if(c===PS.ERROR){return un(s+"hex argument invalid")}S="\nvar myImage = {\n	width : "+b+", height : "+w+", pixelSize : "+f+",\n	data : [";if(E<1){S+="]\n};\n";PS.debug(S);return PS.DONE}S+="\n	";L=255;k=T=0;x=h*d;A=g*x+y*d;for(M=0;M<w;M+=1){O=A;for(_=0;_<b;_+=1){if(d<3){B=v[O];if(B<1){D=P=H=0}else if(B>=16777215){D=P=H=255}else{D=B/N;D=Math.floor(D);j=D*N;P=(B-j)/C;P=Math.floor(P);F=P*C;H=B-j-F}if(d===2){L=v[O+1]}}else{D=v[O];P=v[O+1];H=v[O+2];B=D*N+P*C+H;if(d===4){L=v[O+3]}}S+=Mr(f,c,B,D,P,H,L);k+=1;if(k<E){S+=",";T+=1;if(T<l){S+=" "}else{T=0;S+="\n	"}}O+=d}A+=x}S+="\n	]\n};\n";PS.debug(S);return PS.DONE},spriteSolid:function(e,t){var n,r,i,s,o;n="[PS.spriteSolid] ";r=arguments.length;if(r<2){return un(n+"Missing argument(s)")}if(r>2){return un(n+"Too many argument(s)")}i=e;s=t;if(i===PS.DEFAULT){i=1}else if(Ht(i)==="number"){i=Math.floor(i);if(i<1){i=1}}else{return un(n+"width argument invalid")}if(s===PS.DEFAULT){s=1}else if(Ht(s)==="number"){s=Math.floor(s);if(s<1){s=1}}else{return un(n+"height argument invalid")}o=_r();o.width=i;o.height=s;o.color={rgb:0,r:0,g:0,b:0,a:255};return o.id},spriteSolidColor:function(e,t,n,r){var i,s,o,u,a,f,l,c,h;i="[PS.spriteSolidColor] ";s=arguments.length;if(s<1){return un(i+"Missing argument(s)")}if(s>4){return un(i+"Too many argument(s)")}o=Dr(e,i);if(o===PS.ERROR){return PS.ERROR}a=o.color;if(!a){return un(i+"Cannot set color of image sprite "+o.id)}u=Sn(i,t,n,r);if(u===PS.ERROR){return PS.ERROR}f=u.rgb;if(f!==PS.CURRENT){if(f===null){l=u.r;if(l===PS.CURRENT){u.r=l=a.r}else if(l===PS.DEFAULT){u.r=l=0}c=u.g;if(c===PS.CURRENT){u.g=c=a.g}else if(c===PS.DEFAULT){u.g=c=0}h=u.b;if(h===PS.CURRENT){u.b=h=a.b}else if(h===PS.DEFAULT){u.b=h=0}u.rgb=f=l*N+c*C+h}else if(f===PS.DEFAULT){u.rgb=f=0;u.r=0;u.g=0;u.b=0}if(a.rgb!==f){a.rgb=f;a.r=u.r;a.g=u.g;a.b=u.b;if(o.visible&&o.placed){Hr(o);Yt()}}}return a.rgb},spriteSolidAlpha:function(e,t){var n,r,i,s,o,u,a;n="[PS.spriteSolidAlpha] ";r=arguments.length;if(r<1){return un(n+"Missing argument(s)")}if(r>2){return un(n+"Too many argument(s)")}i=e;s=t;o=Dr(i,n);if(o===PS.ERROR){return PS.ERROR}u=o.color;if(!u){return un(n+"Cannot set alpha of image sprite "+o.id)}a=Ht(s);if(a!=="undefined"&&s!==PS.CURRENT){if(s===PS.DEFAULT){s=255}else if(a==="number"){s=Math.floor(s);if(s<0){s=0}else if(s>255){s=255}}else{return un(n+"alpha argument invalid")}if(u.a!==s){u.a=s;if(o.visible&&o.placed){Hr(o);Yt()}}}return u.a},spriteImage:function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,w,E,S,x,T,k,L,A,O;n="[PS.spriteImage] ";r=arguments.length;if(r<1){return un(n+"Missing argument(s)")}if(r>2){return un(n+"Too many argument(s)")}if(Ar(n,e)===PS.ERROR){return PS.ERROR}l=f=0;c=i=e.width;h=s=e.height;o=e.pixelSize;u=e.data;a=Ht(t);if(a!=="undefined"&&t!==PS.DEFAULT){if(a!=="object"){return un(n+"region argument invalid")}l=t.left;a=Ht(l);if(a==="undefined"||l===PS.DEFAULT){l=0}else{if(a!=="number"){return un(n+"region.left invalid")}l=Math.floor(l);if(l<0){l=0}else if(l>=i){return un(n+"region.left outside image")}}f=t.top;a=Ht(f);if(a==="undefined"||f===PS.DEFAULT){f=0}else{if(a!=="number"){return un(n+"region.top invalid")}f=Math.floor(f);if(f<0){f=0}else if(f>=s){return un(n+"region.top outside image")}}c=t.width;a=Ht(c);if(a==="undefined"||c===PS.DEFAULT){c=i-l}else{if(a!=="number"){return un(n+"region.width invalid")}c=Math.floor(c);if(c<1||l+c>i){c=i-l}}h=t.height;a=Ht(h);if(a==="undefined"||h===PS.DEFAULT){h=s-f}else{if(a!=="number"){return un(n+"region.height invalid")}h=Math.floor(h);if(h<1||f+h>s){h=s-f}}}p=[];p.length=c*h*4;k=255;d=i*o;v=f*d+l*o;w=0;for(y=0;y<h;y+=1){m=v;for(g=0;g<c;g+=1){if(o<3){E=u[m];if(E<1){E=S=x=T=0}else if(E>=16777215){E=16777215;S=x=T=255}else{S=E/N;S=Math.floor(S);L=S*N;x=(E-L)/C;x=Math.floor(x);A=x*C;T=E-L-A}if(o===2){k=u[m+1]}}else{S=u[m];x=u[m+1];T=u[m+2];if(o===4){k=u[m+3]}}p[w]=S;p[w+1]=x;p[w+2]=T;p[w+3]=k;m+=o;w+=4}v+=d}O=_r();O.width=c;O.height=h;O.image={id:b+Z,width:c,height:h,pixelSize:4,data:p};Z+=1;return O.id},spriteShow:function(e,t){var n,r,i,s,o;n="[PS.spriteShow] ";r=arguments.length;if(r<1){return un(n+"Missing argument(s)")}if(r>2){return un(n+"Too many argument(s)")}i=e;o=Dr(i,n);if(o===PS.ERROR){return PS.ERROR}s=Bt(t,PS.CURRENT,true,PS.CURRENT);if(s===PS.ERROR){return un(n+"show argument invalid")}if(s!==PS.CURRENT){if(o.visible!==s){o.visible=s;if(o.placed){if(s){Hr(o);Br(o,i)}else{Pr(o)}Yt()}}}return o.visible},spriteAxis:function(e,t,n){var r,i,s,o,u,a,f;r="[PS.spriteAxis] ";i=arguments.length;if(i<1){return un(r+"Missing argument(s)")}if(i>3){return un(r+"Too many argument(s)")}s=e;o=t;u=n;a=Dr(s,r);if(a===PS.ERROR){return PS.ERROR}f=Ht(o);if(f==="undefined"||o===PS.CURRENT){o=a.ax}else if(o===PS.DEFAULT){o=0}else if(f==="number"){o=Math.floor(o)}else{return un(r+"x argument invalid")}f=Ht(u);if(f==="undefined"||u===PS.CURRENT){u=a.ay}else if(u===PS.DEFAULT){u=0}else if(f==="number"){u=Math.floor(u)}else{return un(r+"y argument invalid")}if(o!==a.ax||u!==a.ay){a.ax=o;a.ay=u;if(a.visible&&a.placed){Hr(a);Br(a,s);Yt()}}return{x:a.ax,y:a.ay}},spritePlane:function(e,t){var n,r,i,s,o,u;n="[PS.spritePlane] ";r=arguments.length;if(r<1){return un(n+"Missing argument(s)")}if(r>2){return un(n+"Too many arguments")}i=e;s=t;o=Dr(i,n);if(o===PS.ERROR){return PS.ERROR}u=Ht(s);if(u!=="undefined"&&s!==PS.CURRENT){if(s===PS.DEFAULT){s=0}else if(u==="number"){s=Math.floor(s);if(s<1){s=0}}else{return un(n+"plane argument invalid")}if(o.plane!==s){if(o.visible&&o.placed){Pr(o)}o.plane=s;if(o.visible&&o.placed){Hr(o);Yt()}}}if(o.plane<0){return 0}return o.plane},spriteMove:function(e,t,n){var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y;r="[PS.spriteMove] ";i=arguments.length;if(i<1){return un(r+"Missing argument(s)")}if(i>3){return un(r+"Too many argument(s)")}s=e;o=t;u=n;a=Dr(s,r);if(a===PS.ERROR){return PS.ERROR}f=Ht(o);if(f==="undefined"||o===PS.CURRENT){o=a.x}else if(o===PS.DEFAULT){o=0}else if(f==="number"){o=Math.floor(o)}else{return un(r+"x argument invalid")}f=Ht(u);if(f==="undefined"||u===PS.CURRENT){u=a.y}else if(u===PS.DEFAULT){u=0}else if(f==="number"){u=Math.floor(u)}else{return un(r+"y argument invalid")}if(!a.placed||o!==a.x||u!==a.y){y=false;if(a.plane<0){a.plane=$.plane}if(a.visible&&a.placed){c=a.y;p=a.height;if(o>a.x){h=o-a.x;l=a.x}else if(a.x>o){h=a.x-o;l=a.x+a.width-h}else{h=0}if(h>=a.width){y=true;Pr(a)}else{d=a.x;m=a.width;if(u>a.y){g=u-a.y;v=a.y}else if(a.y>u){g=a.y-u;v=a.y+a.height-g}else{g=0}if(g>=a.height){y=true;Pr(a)}else if(g<1){y=true;Pr(a,l,c,h,p)}else if(m<1){y=true;Pr(a,d,v,m,g)}else{y=true;m-=h;if(o>a.x){d+=h}Pr(a,l,c,h,p);Pr(a,d,v,m,g)}}}a.x=o;a.y=u;a.placed=true;if(a.visible){y=true;Hr(a);Br(a,s)}if(y){Yt()}}return{x:a.x,y:a.y}},spriteCollide:function(e,t){var n,r,i,s,o;n="[PS.spriteCollide] ";r=arguments.length;if(r<1){return un(n+"Missing argument(s)")}if(r>2){return un(n+"Too many arguments")}i=Dr(e,n);if(i===PS.ERROR){return PS.ERROR}s=t;o=Ht(s);if(o!=="undefined"&&s!==PS.CURRENT){if(s===PS.DEFAULT){s=null}else if(o!=="function"){return un(n+"exec argument not a function")}if(i.collide!==s){i.collide=s;if(s&&i.visible&&i.placed){Br(i,e)}}}return i.collide},spriteDelete:function(e){var t,n,r,i,s;t="[PS.spriteDelete] ";n=arguments.length;if(n<1){return un(t+"Missing argument")}if(n>1){return un(t+"Too many arguments")}if(typeof e!=="string"||e.length<1){return un(t+"sprite argument invalid")}r=et.length;for(i=0;i<r;i+=1){s=et[i];if(s.id===e){Pr(s);et.splice(i,1);Yt();return PS.DONE}}return un(t+"sprite id '"+e+"' not found")},audioLoad:function(e,t){var n,r;n="[PS.audioLoad] ";if(arguments.length<1){return un(n+"Missing argument(s)")}if(arguments.length>2){return un(n+"Too many arguments")}r=AQ.load(e,t);if(r===AQ.ERROR){return PS.ERROR}return r.channel},audioPlay:function(e,t){var n,r,i,s,o,u;n="[PS.audioPlay] ";r=arguments.length;if(r<1){return un(n+"Missing argument(s)")}if(r>2){return un(n+"Too many arguments")}i=e;s=t;o=Ht(s);if(o==="undefined"){s={}}else if(o!=="object"){return un(n+"params argument invalid")}s.autoplay=true;u=AQ.load(i,s);if(u===AQ.ERROR){return PS.ERROR}return u.channel},audioPause:function(e){var t,n,r;t="[PS.audioPause] ";n=arguments.length;if(n<1){return un(t+"Missing argument(s)")}if(n>1){return un(t+"Too many arguments")}r=AQ.pause(e);if(r===AQ.ERROR){return PS.ERROR}return r},audioStop:function(e){var t,n,r;t="[PS.audioStop] ";n=arguments.length;if(n<1){return un(t+"Missing argument(s)")}if(n>1){return un(t+"Too many arguments")}r=AQ.stop(e);if(r===AQ.ERROR){return PS.ERROR}if(r===AQ.DONE){return PS.DONE}return r},piano:function(e,t){var n,r,i,s,o,u;n="[PS.piano] ";r=B.length;s=e;i=Ht(s);if(i!=="number"){return un(n+"index argument invalid")}s=Math.floor(s);if(s<1){s=1}else if(s>r){s=r}o=t;if(o!==true&&o!==false){i=Ht(o);if(i==="undefined"){o=false}else if(i!=="number"){return un(n+"flag argument invalid")}}u="piano_"+B[s-1];if(o){u="l_"+u}return u},harpsichord:function(e,t){var n,r,i,s,o,u;n="[PS.harpsichord] ";r=j.length;s=e;i=Ht(s);if(i!=="number"){return un(n+"index argument invalid")}s=Math.floor(s);if(s<1){s=1}else if(s>r){s=r}o=t;if(o!==true&&o!==false){i=Ht(o);if(i==="undefined"){o=false}else if(i!=="number"){return un(n+"flag argument invalid")}}u="hchord_"+j[s-1];if(o){u="l_"+u}return u},xylophone:function(e){var t,n,r,i,s;t="[PS.xylophone] ";n=F.length;i=e;r=Ht(i);if(r!=="number"){return un(t+"index argument invalid")}i=Math.floor(i);if(i<1){i=1}else if(i>n){i=n}s="xylo_"+F[i-1];return s},debug:function(e){var t,n,r,i;t="[PS.debug] ";if(arguments.length>1){return un(t+"Too many arguments")}n=e;r=Ht(n);if(r==="undefined"){n=""}else if(r!=="string"){n=n.toString()}Zt();if(n.length>0){i=document.getElementById(c);i.value+=n;i.scrollTop=i.scrollHeight}an();return PS.DONE},debugClose:function(){var e,t;e="[PS.debugClose] ";if(arguments.length>0){return un(e+"Too many arguments")}t=document.getElementById(r);t.style.display="none";Nt=false;return PS.DONE},debugClear:function(){var e,t;e="[PS.debugClear] ";if(arguments.length>0){return un(e+"Too many arguments")}t=document.getElementById(c);t.value="";return PS.DONE},line:function(e,t,n,r){var i,s,o,u,a,f,l;i="[PS.line] ";s=arguments.length;if(s<4){return un(i+"Missing argument(s)")}if(s>4){return un(i+"Too many arguments")}o=e;u=t;a=n;f=r;if(Ht(o)==="number"){o=Math.floor(o)}else{return un(i+"x1 argument not a number")}if(Ht(u)==="number"){u=Math.floor(u)}else{return un(i+"y1 argument not a number")}if(Ht(a)==="number"){a=Math.floor(a)}else{return un(i+"x2 argument not a number")}if(Ht(f)==="number"){f=Math.floor(f)}else{return un(i+"y2 argument not a number")}l=Fr(o,u,a,f);return l},pathMap:function(e){var t,n,r;t="[PS.pathMap] ";n=arguments.length;if(n<1){return un(t+"Missing argument(s)")}if(n>1){return un(t+"Too many arguments")}if(Ar(t,e)===PS.ERROR){return PS.ERROR}if(e.pixelSize!==1){return un(t+"image is not format 1")}r=Xr(e.width,e.height,e.data);return r.id},pathFind:function(e,t,n,r,i,s){var o,u,a,f,l,c,h,p,d,v,m,g,y,b;o="[PS.pathFind] ";u=arguments.length;if(u<5){return un(o+"Missing argument(s)")}if(u>6){return un(o+"Too many arguments")}a=e;f=t;l=n;c=r;h=i;p=s;if(typeof a!=="string"||a.length<1){return un(o+"pathmap argument invalid")}d=Vr(a);if(!d){return un(o+a+" not found")}if(Ht(f)==="number"){f=Math.floor(f);if(f<0||f>=d.width){return un(o+"x1 argument is outside "+a)}}else{return un(o+"x1 argument not a number")}if(Ht(l)==="number"){l=Math.floor(l);if(l<0||l>=d.height){return un(o+"y1 argument is outside "+a)}}else{return un(o+"y1 argument not a number")}if(Ht(c)==="number"){c=Math.floor(c);if(c<0||c>=d.width){return un(o+"x2 argument is outside "+a)}}else{return un(o+"x2 argument not a number")}if(Ht(h)==="number"){h=Math.floor(h);if(h<0||h>=d.height){return un(o+"y2 argument is outside "+a)}}else{return un(o+"y2 argument not a number")}y=false;b=false;v=Ht(p);if(v!=="undefined"&&p!==PS.DEFAULT){if(v!=="object"){return un(o+"options argument invalid")}g=p.no_diagonals;if(g===true||g===false){y=g}else{v=Ht(g);if(v==="undefined"||g===PS.DEFAULT){y=false}else if(v==="number"){y=g!==0}else{return un(o+"options.no_diagonals invalid")}}g=p.cut_corners;if(g===true||g===false){b=g}else{v=Ht(g);if(v==="undefined"||g===PS.DEFAULT){b=false}else if(v==="number"){b=g!==0}else{return un(o+"options.cut_corners invalid")}}}m=zr(d,f,l,c,h,y,b);return m},pathData:function(e,t,n,r,i,s){var o,u,a,f,l,c,h,p,d,v,m,g;o="[PS.pathData] ";u=arguments.length;if(u<5){return un(o+"Missing argument(s)")}if(u>6){return un(o+"Too many arguments")}a=e;f=t;l=n;c=r;h=i;p=s;if(typeof a!=="string"||a.length<1){return un(o+"pathmap argument invalid")}d=Vr(a);if(!d){return un(o+a+" not found")}if(Ht(f)==="number"){f=Math.floor(f);if(f<0||f>=d.width){return un(o+"left argument is outside "+a)}}else{return un(o+"left argument not a number")}if(Ht(l)==="number"){l=Math.floor(l);if(l<0||l>=d.height){return un(o+"top argument is outside "+a)}}else{return un(o+"top argument not a number")}if(c===PS.DEFAULT){c=1}else if(Ht(c)==="number"){c=Math.floor(c);if(c<1){c=1}else{v=d.width-f;if(c>v){c=v}}}else{return un(o+"width argument not a number")}if(h===PS.DEFAULT){h=1}else if(Ht(h)==="number"){h=Math.floor(h);if(h<1){h=1}else{v=d.height-l;if(h>v){h=v}}}else{return un(o+"height argument not a number")}if(p!==PS.DEFAULT&&p!==PS.CURRENT){m=Ht(p);if(m==="undefined"){p=PS.CURRENT}else if(m==="number"){if(p<0){return un(o+"data argument < 0")}}else{return un(o+"data argument not a number")}}g=Wr(d,f,l,c,h,p);return g},pathDelete:function(e){var t,n;t="[PS.pathDelete] ";n=arguments.length;if(n<1){return un(t+"Missing argument")}if(typeof e!=="string"||e.length<1){return un(t+"pathmap argument invalid")}if(!$r(e)){return un(t+e+" not found")}return PS.DONE},pathNear:function(e,t,n,r,i){var s,o,u,a;s="[PS.pathNear] ";o=arguments.length;if(o<5){return un(s+"Missing argument(s)")}if(o>5){return un(s+"Too many arguments")}if(typeof e!=="string"||e.length<1){return un(s+"pathmap argument invalid")}u=Vr(e);if(!u){return un(s+e+" not found")}a=Jr(u,t,n,r,i);return a}}})();(function(){"use strict";var e,t,n,r;e=0;t=["webkit","moz","ms","o"];for(n=0;n<t.length&&!window.requestAnimationFrame;n+=1){r=t[n];window.requestAnimationFrame=window[r+"RequestAnimationFrame"];window.cancelAnimationFrame=window[r+"CancelAnimationFrame"]||window[r+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(t,n){var r,i,s;r=(new Date).getTime();i=Math.max(0,16-(r-e));s=window.setTimeout(function(){t(r+i)},i);e=r+i;return s}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(e){window.clearTimeout(e)}}})()
