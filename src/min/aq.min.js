/*! Perlenspiel 3.1.6 2014-05-30 */
var AQ;!function(){"use strict";function a(a){var b;return b=typeof a,"number"===b?isNaN(a)&&(b="NaN"):"object"===b&&(a?a instanceof Array&&(b="array"):b="null"),b}function b(a){return a.stopPropagation?a.stopPropagation():a.cancelBubble=!0,a.preventDefault(),!1}function c(a){var b;if(b=D,b&&"function"==typeof b)try{b(a+"\n")}catch(c){window.alert("AQ DEBUG: "+a+" ["+c.message+"]\n")}}function d(a){var b,c,d;return b="",-1!==a.search(".js")&&(c=a.lastIndexOf("/")+1,d=a.substr(c).replace(/^[\s\(\)]+|[\s\(\)]+$/g,""),3===d.split(":").length&&(d=d.substr(0,d.lastIndexOf(":"))),""!==d&&(b+="    "+d+"\n")),b}function e(a){var b,c,e,f;if(console&&console.log&&console.log(a),!a.split)return a;for(b=a.split("\n"),e="",f=b.length,c=0;f>c;c+=1)e+=d(b[c]);return e}function f(a,b){var c;if(B=!0,("string"!=typeof a||a.length<1)&&(a="???"),a="AQ ERROR: "+a+"\n",E&&b&&(a+=e(b.stack)+"\n"),c=D,c&&"function"==typeof c)try{c(a)}catch(d){window.alert(a+" ["+b.message+"]\n")}return AQ.ERROR}function g(a){try{throw new Error("AQ ERROR")}catch(b){return f(a,b)}}function h(b,c){var d,e,f,h,i;if(d=a(c),"undefined"===d||null===c||c===AQ.DEFAULT)return H;if("array"!==d)return g(b+".fileTypes not an array");if(e=c.length,1>e)return g(b+".fileTypes array empty");for(h=[],f=0;e>f;f+=1){if(i=c[f],!i||"string"!=typeof i||i.length<1)return g(b+"Invalid .fileType entry @ "+f);i=i.toLowerCase(),H.indexOf(i)>=0&&h.indexOf(i)<0&&h.push(i)}return h.length<1?g(b+"No playable audio types listed"):h}function i(b,c,d){var e,f;if(e=a(d),!d||"undefined"===e)return AQ.DONE;if("object"!==e)return g(b+"params not an object");if(f=d.path,e=a(f),"undefined"!==e){if(f===AQ.DEFAULT)f=r.path;else if("string"!==e||f.length<1)return g(b+".path property not a valid string");c.path=f}if(f=h(b,d.fileTypes),f===AQ.ERROR)return AQ.ERROR;if(f&&(c.fileTypes=f),f=d.autoplay,e=a(f),"undefined"!==e){if(f!==!0&&f!==!1)if(f===AQ.DEFAULT)f=r.autoplay;else if(null===f)f=!1;else{if("number"!==e)return g(b+".autoplay property invalid");f=0!==f}c.autoplay=f}if(f=d.lock,e=a(f),"undefined"!==e){if(f!==!0&&f!==!1)if(f===AQ.DEFAULT)f=r.lock;else if(null===f)f=!1;else{if("number"!==e)return g(b+".lock property invalid");f=0!==f}c.lock=f}if(f=d.volume,e=a(f),"undefined"!==e){if(f===AQ.DEFAULT)f=r.volume;else{if("number"!==e)return g(b+".volume property not a number");f>p?f=p:0>f&&(f=0)}c.volume=f}if(f=d.loop,e=a(f),"undefined"!==e){if(f!==!0&&f!==!1)if(f===AQ.DEFAULT)f=r.loop;else if(null===f)f=!1;else{if("number"!==e)return g(b+".loop property invalid");f=0!==f}c.loop=f}if(f=d.start,e=a(f),"undefined"!==e){if(f===AQ.DEFAULT)f=r.start;else{if("number"!==e)return g(b+".start property not a number");f=Math.floor(f),0>f&&(f=0)}c.start=f}if(f=d.end,e=a(f),"undefined"!==e){if(f===AQ.DEFAULT)f=r.end;else{if("number"!==e)return g(b+".end property not a number");f=Math.floor(f),0>f&&(f=0)}c.end=f}if(f=d.onLoad,e=a(f),"undefined"!==e){if(f===AQ.DEFAULT)f=r.onLoad;else if("function"!==e)return g(b+".onLoad property not a function");c.onLoad=f}if(f=d.onPlay,e=a(f),"undefined"!==e){if(f===AQ.DEFAULT)f=r.onPlay;else if("function"!==e)return g(b+".onPlay property not a function");c.onPlay=f}if(f=d.onEnd,e=a(f),"undefined"!==e){if(f===AQ.DEFAULT)f=r.onEnd;else if("function"!==e)return g(b+".onEnd property not a function");c.onEnd=f}return f=d.data,e=a(f),"undefined"!==e&&(f===AQ.DEFAULT&&(f=r.data),c.data=f),AQ.DONE}function j(a){return{name:a,path:C,fileTypes:H,lock:r.loop,volume:r.volume,start:r.start,end:r.end,loop:r.loop,autoplay:r.autoplay,onLoad:r.onLoad,onPlay:r.onPlay,onEnd:r.onEnd,data:r.data}}var k="AQ",l=1,m=0,n=7,o=!1,p=1,q=32,r={path:"",fileTypes:["ogg","mp3","wav"],autoplay:!1,volume:.5,start:0,end:-1,loop:!1,lock:!1,onLoad:null,onPlay:null,onEnd:null,data:0},s="bf_",t="ch_",u="EMPTY",v="LOADING",w="READY",x="PLAYING",y="PAUSED",z=3,A=!1,B=!1,C="",D=null,E=!1,F=!1,G=!1,H=null,I={ogg:{ok:!1,type:'audio/ogg; codecs="vorbis"'},mp3:{ok:!1,type:'audio/mpeg; codecs="mp3"'},wav:{ok:!1,type:'audio/wav; codecs="1"'},aac:{ok:!1,type:'audio/mp4; codecs="mp4a.40.2"'},webm:{ok:!1,type:'audio/webm; codecs="vorbis"'},opus:{ok:!1,type:'audio/ogg; codecs="opus"'}},J=[],K=0,L=0,M=null,N={context:null,buffers:[],bufferID:0,stopChannel:function(a){var b,d;return b="[AQ._web.stopChannel] ",B?AQ.ERROR:(o&&c(b+a.id),d=a.source,d&&d.playbackState!==z&&(a.thandle&&window.clearTimeout(a.thandle),void 0!==d.stop?d.stop(0):d.noteOff(0),a.status=w),AQ.DONE)},assignChannel:function(){var a;return L+=1,a=t+L},playBuffer:function(a,b){var d,e,h,i,j,k,l,m,n,p;if(d="[AQ._web.playBuffer] ",B)return AQ.ERROR;if(e=N.context,h=e.createBufferSource(),!h)return g(d+"Invalid bufferSource");if(h.buffer=a.audio,i=void 0!==e.createGain?e.createGain():e.createGainNode(),!i)return g(d+"Invalid gainNode");if(h.connect(i),i.connect(e.destination),i.gain.value=a.params.volume,void 0===b&&(b=0),j=a.audio.duration-b,k=Math.floor(1e3*j),a.channel_id||(a.channel_id=N.assignChannel()),l=a.channel_id,m={id:l,buffer:a,source:h,gainNode:i,startTime:e.currentTime-b,pauseTime:0,endTime:-1,status:x},m.thandle=window.setTimeout(function(){var a,b,e;for(a=J.length,b=0;a>b;b+=1)if(m=J[b],m.id===l){if(o&&c(d+"Ending "+l+": "+n.pathname),e=m.buffer,n=e.params,p=n.onEnd,p&&"function"==typeof p){o&&c(d+"Calling user .onEnd on "+l+": "+n.pathname);try{p({channel:e.channel_id,name:n.name,path:n.pathname,duration:e.duration,data:n.data})}catch(h){f(d+"User .onEnd failed on "+l+": "+n.pathname+" ["+h.message+"]",h)}}return N.stopChannel(m),J.splice(b,1),void(n.loop&&N.playBuffer(e,0))}g(d+"Channel "+l+" not found")},k),J.push(m),void 0!==h.start?h.start(0,b,j):h.noteGrainOn(0,b,j),n=a.params,p=n.onPlay,p&&"function"==typeof p){o&&c(d+"Calling user .onPlay for "+a.channel_id+": "+n.pathname);try{p({channel:a.channel_id,name:n.name,path:n.pathname,duration:a.duration,data:n.data})}catch(q){f(d+"User .onPlay failed on "+a.channel_id+": "+n.pathname+" ["+q.message+"]",q)}}return l},load:function(a){var b,d,e,h,i,j;if(b="[AQ._web.load] ",B)return AQ.ERROR;for(d=N.buffers.length,e=0;d>e;e+=1)if(h=N.buffers[e],h.params.pathname===a.pathname)return o&&c(b+a.pathname+" found in "+h.id),h.channel_id;if(N.bufferID+=1,i=s+N.bufferID,h={id:i,channel_id:N.assignChannel(),audio:null,duration:0,params:a},o&&c(b+"Creating "+h.id+" for "+a.pathname),j=new XMLHttpRequest,!j)return g(b+"XMLHttpRequest error");j.open("GET",a.pathname,!0),j.responseType="arraybuffer",j.onload=function(){o&&c(b+"Loaded "+a.pathname+" into "+h.id),N.context.decodeAudioData(j.response,function(d){var e;if(h.audio=d,h.duration=Math.floor(1e3*d.duration),N.buffers.push(h),o&&c(b+"Decoded "+a.pathname+" in "+h.id+" ("+h.duration+" ms)"),e=a.onLoad,e&&"function"==typeof e){a.onLoad=null,o&&c(b+"Calling user .onLoad for "+h.channel_id+": "+a.pathname);try{e({channel:h.channel_id,name:a.name,path:a.pathname,duration:h.duration,data:a.data})}catch(g){f(b+"User .onLoad failed on "+h.channel_id+": "+a.pathname+" ["+g.message+"]",g)}}h.params.autoplay&&(o&&c(b+"Autoplaying "+h.id+" :"+a.pathname),N.playBuffer(h))},function(){g(b+"Error loading "+a.pathname)})};try{j.send()}catch(k){return f(b+"XMLHttpRequest failed: "+a.pathname+" ["+k.message+"]",k)}return h.channel_id},play:function(a){var b,d,e,f;if(b="[AQ._web.play] ",B)return AQ.ERROR;for(d=N.buffers.length,e=0;d>e;e+=1)if(f=N.buffers[e],f.params.pathname===a.pathname)return o&&c(b+"Found "+a.pathname),N.playBuffer(f);return o&&c(b+a.pathname+" unavailable; loading"),a.autoplay=!0,N.load(a)},playChannel:function(a){var b,c,d,e;if(b="[AQ._web.playChannel] ",B)return AQ.ERROR;for(c=N.buffers.length,d=0;c>d;d+=1)if(e=N.buffers[d],e.channel_id===a)return N.playBuffer(e);return g(b+a+" not found")},pause:function(a){var b,d,e,f,g,h,i;if(b="[AQ._web.pause] ",B)return AQ.ERROR;for(d=J.length,e=0;d>e;e+=1)if(f=J[e],f.id===a)return g=f.buffer,h=f.source,i=f.pauseTime,i>0&&f.status===y?(J.splice(e,1),N.playBuffer(g,i)):(f.thandle&&(window.clearTimeout(f.thandle),f.thandle=null),h&&h.playbackState!==z?(i=N.context.currentTime-f.startTime,i%=g.audio.duration,f.pauseTime=i,f.status=y,void 0!==h.stop?h.stop(0):h.noteOff(0)):J.splice(e,1),a);return o&&c(b+a+" not found"),AQ.ERROR},stop:function(a){var b,d,e,f;if(b="[AQ._web.stop] ",B)return AQ.ERROR;for(d=J.length,e=0;d>e;e+=1)if(f=J[e],f.id===a)return N.stopChannel(f),J.splice(e,1),AQ.DONE;return o&&c(b+a+" not found"),AQ.ERROR},init:function(){return B?AQ.ERROR:(N.buffers=[],N.bufferID=0,AQ.WEB_AUDIO)}},O={onError:function(a){var c,d,e,f,h,i;switch(c="[AQ._html.onError] ",d=a.currentTarget,e=d.getAttribute("data-channel"),e=parseInt(e,10),f=J[e],h=a.target.error.code){case 1:i="Playback aborted";break;case 2:i="Network failure";break;case 3:i="Source decode failed";break;case 4:i="Invalid source file";break;default:i="Unknown"}return g(c+i+" @ "+f.id+": "+f.params.pathname),b(a)},onStalled:function(a){var d,e,f,g;return d="[AQ._html.onStalled] ",o&&(e=a.currentTarget,f=e.getAttribute("data-channel"),f=parseInt(f,10),g=J[f],c(d+g.id+": "+g.params.pathname)),b(a)},startChannel:function(b,d){var e,f,g,h;return e="[AQ._html.startChannel] ",B?AQ.ERROR:(o&&c(e+"Playing "+b.id),b.status=x,f=b.audio,h=a(d),"object"===h&&(g=d.volume,h=a(g),"undefined"!==h&&(b.params.volume=g,f.volume=g),g=d.loop,h=a(g),"undefined"!==h&&(b.params.loop=g,f.loop=g),g=d.onDone,h=a(g),"undefined"!==h&&(b.params.onDone=g),g=d.userData,h=a(g),"undefined"!==h&&(b.params.userData=g),g=d.lock,h=a(g),"undefined"!==h&&(b.params.lock=g)),f.play(),AQ.DONE)},onLoad:function(a){var d,e,g,h,i,j,k;if(d="[AQ._html.onLoad] ",e=a.currentTarget,g=e.getAttribute("data-channel"),g=parseInt(g,10),h=J[g],h.status=w,i=h.params,o&&c(d+h.id+": "+i.pathname),j=h.audio,j.removeEventListener("canplaythrough",O.onLoad,!1),h.duration=Math.floor(1e3*j.duration),k=i.onLoad,k&&"function"==typeof k){i.onLoad=null,o&&c(d+"Calling user .onLoad on "+h.id+": "+i.pathname);try{k({channel:h.id,name:i.name,path:i.pathname,duration:h.duration,data:i.data})}catch(l){return f(d+"User .onLoad failed on "+h.id+": "+i.pathname+" ["+l.message+"]",l),b(a)}}return i.autoplay&&(o&&c(d+"Autoplaying "+h.id),i.autoplay=!1,O.startChannel(h,i)),b(a)},onPlay:function(a){var d,e,g,h,i,j;if(d="[AQ._html.onPlay] ",e=a.currentTarget,g=e.getAttribute("data-channel"),g=parseInt(g,10),h=J[g],i=h.params,o&&c(d+h.id+": "+i.pathname+" ("+h.duration+"ms)"),j=i.onPlay,j&&"function"==typeof j){o&&c(d+"Calling user .onPlay on "+h.id+": "+i.pathname);try{j({channel:h.id,name:i.name,path:i.pathname,duration:h.duration,data:i.data})}catch(k){f(d+"User .onPlay failed on "+h.id+": "+i.pathname+" ["+k.message+"]",k)}}return b(a)},onEnd:function(a){var d,e,g,h,i,j;if(d="[AQ._html.onEnd] ",e=a.currentTarget,g=e.getAttribute("data-channel"),g=parseInt(g,10),h=J[g],i=h.params,o&&c(d+h.id+": "+i.pathname),h.status=w,j=i.onEnd,j&&"function"==typeof j){o&&c(d+"Calling user .onEnd on "+h.id+": "+i.pathname);try{j({channel:h.id,name:i.name,path:i.pathname,duration:h.duration,data:i.data})}catch(k){f(d+"User .onEnd failed on "+h.id+": "+i.pathname+" ["+k.message+"]",k)}}return b(a)},loadChannel:function(a,b){var d,e;return d="[AQ._html.loadChannel] ",B?AQ.ERROR:(a.params=b,a.status=v,e=a.audio,e.addEventListener("canplaythrough",O.onLoad,!1),e.preload="auto",e.volume=b.volume,e.loop=b.loop,o&&c(d+a.id+": "+b.pathname),e.setAttribute("src",b.pathname),AQ.DONE)},load:function(a){var b,d,e,f;if(b="[AQ._html.load] ",B)return AQ.ERROR;for(d=0;K>d;d+=1)if(e=J[d],e.params.pathname===a.pathname&&e.status===w)return o&&c(b+e.id+" ready: "+a.pathname),e.audio.currentTime=0,a.autoplay&&O.startChannel(e,a),e.id;for(d=0;q>d;d+=1)if(e=J[d],e.status===u)return o&&c(b+e.id+" available"),f=d+1,f>K&&(K=f),O.loadChannel(e,a),e.id;for(d=0;K>d;d+=1)if(e=J[d],!e.params.lock&&e.status===w)return o&&c(b+e.id+" hijacked: "+a.pathname),e.audio.currentTime=0,O.loadChannel(e,a),e.id;return o&&c(b+"No channel available: "+a.pathname),AQ.ERROR},play:function(a){var b,d,e;if(b="[AQ._html.play] ",B)return AQ.ERROR;for(d=0;K>d;d+=1)if(e=J[d],e.params.pathname===a.pathname&&e.status===w)return o&&c(b+e.id+" ready: "+a.pathname),e.audio.currentTime=0,O.startChannel(e,a),e.id;return o&&c(b+a.pathname+" unavailable; loading"),a.autoplay=!0,O.load(a)},playChannel:function(a){var b,d,e;if(b="[AQ._html.playChannel] ",B)return AQ.ERROR;for(d=0;K>d;d+=1)if(e=J[d],e.id===a)return o&&c(b+"Found "+a),e.status!==w?g(b+a+" not ready"):(e.audio.currentTime=0,O.startChannel(e),e.id);return g(b+a+" not found")},pause:function(a){var b,d,e;if(b="[AQ._html.pause] ",B)return AQ.ERROR;for(d=0;K>d;d+=1)if(e=J[d],e.id===a)return e.status===y?O.startChannel(e):e.status===x&&(e.status=y,e.audio.pause()),a;return o&&c(b+a+" not found"),AQ.ERROR},stop:function(a){var b,d,e,f;if(b="[AQ._html.stop] ",B)return AQ.ERROR;for(d=0;K>d;d+=1)if(e=J[d],e.id===a)return e.params.autoplay=!1,f=e.status,(f===x||f===y)&&(e.status=w,e.audio.pause(),e.audio.currentTime=0),AQ.DONE;return o&&c(b+a+" not found"),AQ.ERROR},init:function(){var a,b,c;if(a="[AQ._html.init] ",B)return AQ.ERROR;for(J.length=q,b=0;q>b;b+=1){if(c=document.createElement("audio"),!c)return g(a+"element init failed");c.setAttribute("data-channel",b.toString()),c.addEventListener("error",O.onError,!1),c.addEventListener("stalled",O.onStalled,!1),c.addEventListener("play",O.onPlay,!1),c.addEventListener("ended",O.onEnd,!1),document.body.appendChild(c),J[b]={id:t+(b+1),audio:c,duration:0,params:null,status:u}}return AQ.HTML5_AUDIO}};AQ={ERROR:"AQ.ERROR",DONE:"AQ.DONE",DEFAULT:"AQ.DEFAULT",HTML5_AUDIO:"AQ.HTML5_AUDIO",WEB_AUDIO:"AQ.WEB_AUDIO",init:function(b){var d,e,f,g,i,j,p,q,s,t,u;if(d="[AQ.init] ",e={engine:k,major:l,minor:m,revision:n,status:AQ.ERROR,fileTypes:[]},A=!1,B=!1,C=r.path,D=null,E=!1,G=!1,f=document.createElement("audio"),g=f.canPlayType,!g)return window.alert(d+"Audio codec testing not available\n"),e;H=[];for(i in I)I.hasOwnProperty(i)&&(j=I[i],p=f.canPlayType(j.type),"probably"===p&&(j.ok=!0,H.push(i)));if(f=null,H.length<1)return window.alert(d+"No common audio filetypes supported\n"),e;if(b){if("object"!=typeof b)return window.alert(d+"Invalid parameter\n"),e;if(q=b.onAlert,s=a(q),"undefined"!==s){if(null===q||q===AQ.DEFAULT)q=null;else if("function"!==s)return window.alert(d+".onAlert property not a function"),e;D=q}if(q=b.stack,s=a(q),"undefined"!==s){if(q&&q!==AQ.DEFAULT){if(q!==!0&&"number"===s)return window.alert(d+".stack property not a boolean"),e;q=!0}else q=!1;E=q}if(q=b.forceHTML5,s=a(q),"undefined"!==s){if(q!==!0&&q!==!1)if(q===AQ.DEFAULT)q=!1;else{if("number"!==s)return window.alert(d+".forceHTML5 property invalid"),e;q=0!==q}o&&c("_forceHTML5 = "+q),G=q}if(q=b.defaultPath,s=a(q),"undefined"!==s){if(null===q||q===AQ.DEFAULT)q=r.path;else if("string"!==s)return window.alert(d+".defaultPath property not a valid string"),e;C=q}if(q=h(d,b.defaultFileTypes),q===AQ.ERROR)return e;q&&(H=q)}if(J.length=0,K=0,L=0,N.context=null,F=!1,!G&&(u=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.oAudioContext||window.msAudioContext)){if(N.context=new u,!N.context)return window.alert(d+"AudioContext init failed"),e;F=!0}if(F)M=N;else{if(!g)return window.alert(d+"HTML5 Audio not supported"),e;M=O}return t=M.init(),t!==AQ.ERROR&&(A=!0),o&&c(d+"status = "+t),e.status=AQ.DONE,e.fileTypes=H,e},load:function(a,b){var d,e,f;return A?(d="[AQ.load] ",!a||"string"!=typeof a||a.length<1?g(d+"name parameter invalid"):(e=j(a),i(d,e,b)===AQ.ERROR?AQ.ERROR:(e.pathname=e.path+e.name+"."+e.fileTypes[0],f=M.load(e),o&&c(d+"Loaded "+e.pathname+", result = "+f),f))):AQ.ERROR},play:function(a,b){var d,e,f;return A?(d="[AQ.play] ",!a||"string"!=typeof a||a.length<1?g(d+"name parameter invalid"):(e=j(a),i(d,e,b)===AQ.ERROR?AQ.ERROR:(e.pathname=e.path+e.name+"."+e.fileTypes[0],f=M.play(e),o&&c(d+"Played "+e.pathname+", result = "+f),f))):AQ.ERROR},playChannel:function(a){var b,d;return A?(b="[AQ.playChannel] ",!a||"string"!=typeof a||a.length<1?g(b+"Invalid channel id"):(d=M.playChannel(a),o&&c(b+"Played "+a+", result = "+d),d)):AQ.ERROR},pause:function(a){var b,d;return A?(b="[AQ.pause] ",!a||"string"!=typeof a||a.length<1?g(b+"Invalid channel id"):(d=M.pause(a),o&&c(b+"Paused "+a+", result = "+d),d)):AQ.ERROR},stop:function(a){var b,d;return A?(b="[AQ.stop] ",!a||"string"!=typeof a||a.length<1?g(b+"Invalid channel id"):(d=M.stop(a),o&&c(b+"Stopped "+a+", result = "+d),d)):AQ.ERROR}}}();